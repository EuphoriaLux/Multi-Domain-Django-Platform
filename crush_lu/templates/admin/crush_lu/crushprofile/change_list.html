{% extends "admin/change_list.html" %}
{% load i18n admin_list %}

{% block extrahead %}
{{ block.super }}
<style>
    /* Quick filter tabs */
    .crush-quick-filters {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
        flex-wrap: wrap;
        padding: 10px 0;
    }

    .crush-quick-filters a {
        padding: 8px 16px;
        border-radius: 20px;
        text-decoration: none;
        font-size: 13px;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .crush-quick-filters a .count {
        background: rgba(0, 0, 0, 0.1);
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 11px;
        font-weight: bold;
    }

    .crush-quick-filters a.all {
        background: #f8f9fa;
        color: #333;
        border: 1px solid #ddd;
    }

    .crush-quick-filters a.approved {
        background: #28a74522;
        color: #28a745;
        border: 1px solid #28a745;
    }
    .crush-quick-filters a.approved .count {
        background: #28a74533;
    }

    .crush-quick-filters a.awaiting-review {
        background: #17a2b822;
        color: #17a2b8;
        border: 1px solid #17a2b8;
    }
    .crush-quick-filters a.awaiting-review .count {
        background: #17a2b833;
    }

    .crush-quick-filters a.incomplete {
        background: #ffc10722;
        color: #856404;
        border: 1px solid #ffc107;
    }
    .crush-quick-filters a.incomplete .count {
        background: #ffc10744;
    }

    .crush-quick-filters a.incomplete-verified {
        background: #6f42c122;
        color: #6f42c1;
        border: 1px solid #6f42c1;
    }
    .crush-quick-filters a.incomplete-verified .count {
        background: #6f42c133;
    }

    .crush-quick-filters a.incomplete-unverified {
        background: #dc354522;
        color: #dc3545;
        border: 1px solid #dc3545;
    }
    .crush-quick-filters a.incomplete-unverified .count {
        background: #dc354533;
    }

    /* New production-informed filter styles */
    .crush-quick-filters a.unverified-email {
        background: #dc354522;
        color: #dc3545;
        border: 1px solid #dc3545;
    }
    .crush-quick-filters a.unverified-email .count {
        background: #dc354533;
    }

    .crush-quick-filters a.high-privacy {
        background: #6c757d22;
        color: #495057;
        border: 1px solid #6c757d;
    }
    .crush-quick-filters a.high-privacy .count {
        background: #6c757d33;
    }

    .crush-quick-filters a.never-submitted {
        background: #fd7e1422;
        color: #fd7e14;
        border: 1px solid #fd7e14;
    }
    .crush-quick-filters a.never-submitted .count {
        background: #fd7e1433;
    }

    .crush-quick-filters a:hover {
        transform: translateY(-2px);
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .crush-quick-filters a.active {
        font-weight: bold;
        box-shadow: 0 0 0 2px rgba(155, 89, 182, 0.3);
    }

    /* Section headers */
    .crush-filter-section {
        width: 100%;
        font-size: 11px;
        font-weight: bold;
        text-transform: uppercase;
        color: #999;
        margin-top: 10px;
        padding-top: 10px;
        border-top: 1px solid #e0e0e0;
    }
</style>
{% endblock %}

{% block search %}
<!-- Quick Filter Tabs with counts - Production-Informed Priorities -->
<div class="crush-quick-filters">
    <!-- Core Status Filters -->
    <a href="?" class="all {% if not request.GET.is_approved__exact and not request.GET.completion_status__in and not request.GET.email_verification %}active{% endif %}">
        ğŸ“Š All Profiles
        <span class="count">{{ filter_counts.total }}</span>
    </a>
    <a href="?is_approved__exact=1" class="approved {% if request.GET.is_approved__exact == '1' %}active{% endif %}">
        âœ… Approved
        <span class="count">{{ filter_counts.approved }}</span>
    </a>
    <a href="?is_approved__exact=0&completion_status__in=completed,submitted" class="awaiting-review {% if request.GET.is_approved__exact == '0' and request.GET.completion_status__in == 'completed,submitted' %}active{% endif %}">
        ğŸ“ Awaiting Review
        <span class="count">{{ filter_counts.awaiting_review }}</span>
    </a>

    <!-- Section Header: Critical Bottlenecks -->
    <span class="crush-filter-section">âš ï¸ Critical Bottlenecks</span>

    <!-- PRIORITY 0: Users without profiles (signed in but never started) -->
    <a href="{% url 'crush_admin:auth_user_changelist' %}?has_profile=no" class="unverified-email" target="_blank">
        ğŸš« Never Started Profile
        <span class="count">{{ filter_counts.users_without_profile }}</span>
    </a>

    <!-- PRIORITY 1: Email Verification (58% unverified in production) -->
    <a href="?email_verification=unverified" class="unverified-email {% if request.GET.email_verification == 'unverified' %}active{% endif %}">
        âŒ Email Not Verified
        <span class="count">{{ filter_counts.unverified_email }}</span>
    </a>

    <!-- PRIORITY 3: Never Submitted (57% in production) -->
    <a href="?submission_history=never_submitted" class="never-submitted {% if request.GET.submission_history == 'never_submitted' %}active{% endif %}">
        ğŸ“ Never Submitted for Review
        <span class="count">{{ filter_counts.never_submitted }}</span>
    </a>

    <!-- Section Header: User Segmentation -->
    <span class="crush-filter-section">ğŸ‘¥ User Segments</span>

    <!-- PRIORITY 2: Privacy-Conscious Users (95% in production) -->
    <a href="?privacy_settings=name_hidden" class="high-privacy {% if request.GET.privacy_settings == 'name_hidden' %}active{% endif %}">
        ğŸ‘¤ Name Privacy
        <span class="count">{{ filter_counts.name_privacy }}</span>
    </a>

    <!-- Completion Workflow -->
    <a href="?completion_status__in=not_started,step1,step2,step3" class="incomplete {% if request.GET.completion_status__in == 'not_started,step1,step2,step3' and not request.GET.phone_verified__exact %}active{% endif %}">
        â³ Incomplete Profile
        <span class="count">{{ filter_counts.incomplete }}</span>
    </a>

    <!-- Engagement (for approved users) -->
    <a href="?connection_activity=no_connections&is_approved__exact=1" class="incomplete-unverified {% if request.GET.connection_activity == 'no_connections' and request.GET.is_approved__exact == '1' %}active{% endif %}">
        ğŸš« No Connections (Approved)
        <span class="count">{{ filter_counts.no_connections }}</span>
    </a>
</div>
{{ block.super }}
{% endblock %}