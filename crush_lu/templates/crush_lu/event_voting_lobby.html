{% extends 'crush_lu/base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Event Voting Lobby" %} - {{ event.title }} - Crush.lu{% endblock %}

{% block extra_css %}
{# Styles moved to static/crush_lu/css/pages/voting.css #}
{% endblock %}

{% block content %}
<!-- Hidden data for JavaScript -->
<div id="event-id-data" class="hidden" data-event-id="{{ event.id }}" data-results-url="{% url 'crush_lu:event_voting_results' event.id %}"></div>

<div class="flex justify-center">
    <div class="w-full max-w-4xl px-4">
        <a href="{% url 'crush_lu:event_detail' event.id %}" class="inline-flex items-center gap-2 px-4 py-2 mb-4 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 font-medium rounded-lg transition-colors">
            {% include "shared/icons/arrow-left.html" with class="w-4 h-4" %} {% trans "Back to Event" %}
        </a>

        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm dark:shadow-gray-900/20 mb-4">
            <div class="p-8">
                <div class="text-center mb-4">
                    <h1 class="display-4 dark:text-white">{{ event.title }}</h1>
                    <p class="text-lg text-gray-500 dark:text-gray-400">{% trans "Activity Voting Lobby" %}</p>
                    <span id="voting-status-badge" class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300">{% trans "Waiting to Start" %}</span>
                </div>

                {% if user_vote %}
                <div class="bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-700 text-green-800 dark:text-green-300 rounded-lg p-4 mb-4">
                    <h5 class="font-semibold">{% trans "âœ“ You've Already Voted!" %}</h5>
                    <p class="mb-2">{% blocktrans with choice=user_vote.selected_option.display_name %}Your choice: <strong>{{ choice }}</strong>{% endblocktrans %}</p>
                    <a href="{% url 'crush_lu:event_voting_results' event.id %}" class="inline-flex items-center px-3 py-1 bg-green-600 text-white text-sm font-medium rounded-lg hover:bg-green-700 transition-colors mt-2">
                        {% trans "View Results" %}
                    </a>
                </div>
                {% else %}
                <div class="voting-status-card mb-4">
                    {% if voting_session.is_voting_open %}
                    <h2 class="dark:text-white">{% trans "Voting is Now Open!" %}</h2>
                    <div class="countdown-timer" id="time-remaining">
                        {{ voting_session.time_remaining|floatformat:0 }}s
                    </div>
                    <p class="mb-3 dark:text-gray-300">{% trans "Time remaining to vote" %}</p>
                    <a href="{% url 'crush_lu:event_activity_vote' event.id %}" class="inline-flex items-center px-6 py-3 bg-white dark:bg-gray-700 text-gray-800 dark:text-white font-semibold rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors text-lg">
                        {% trans "Cast Your Vote Now" %}
                    </a>
                    {% else %}
                    <h2 class="dark:text-white">{% trans "Voting Starts In:" %}</h2>
                    <div class="countdown-timer" id="time-until-start">
                        {{ voting_session.time_until_start|floatformat:0 }}s
                    </div>
                    <p class="mb-0 dark:text-gray-300">{% trans "Get ready to choose your favorite activity!" %}</p>
                    {% endif %}
                </div>
                {% endif %}

                <hr class="my-4 border-gray-200 dark:border-gray-700">

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div class="text-center">
                        <h3 class="text-crush-purple">{{ total_attendees }}</h3>
                        <p class="text-gray-500 dark:text-gray-400">{% trans "Attendees" %}</p>
                    </div>
                    <div class="text-center">
                        <h3 class="text-crush-purple" id="total-votes-count">{{ voting_session.total_votes }}</h3>
                        <p class="text-gray-500 dark:text-gray-400">{% trans "Votes Cast" %}</p>
                    </div>
                    <div class="text-center">
                        <h3 class="text-crush-purple">30</h3>
                        <p class="text-gray-500 dark:text-gray-400">{% trans "Minutes to Vote" %}</p>
                    </div>
                </div>

                <h3 class="mb-3 dark:text-white">{% trans "Activity Options Preview" %}</h3>
                <p class="text-gray-500 dark:text-gray-400 mb-4">
                    {% trans "Here's what you'll be voting on. The winning activity will determine how the event flows!" %}
                </p>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- Speed Dating -->
                    <div class="activity-preview-card">
                        <div class="activity-icon text-center">ðŸ’•</div>
                        <h5 class="text-center mb-2 dark:text-white">{% trans "Speed Dating" %}</h5>
                        <p class="text-gray-500 dark:text-gray-400 text-sm text-center">
                            {% trans "Choose from random order, alphabetic, or by hair color variants. Quick 3-5 minute conversations in organized formats." %}
                        </p>
                    </div>

                    <!-- Presentation Round -->
                    <div class="activity-preview-card">
                        <div class="activity-icon text-center">ðŸŽ¤</div>
                        <h5 class="text-center mb-2 dark:text-white">{% trans "90 Second Presentations" %}</h5>
                        <p class="text-gray-500 dark:text-gray-400 text-sm text-center">
                            {% trans "Everyone introduces themselves creatively. Options include favorite music, predefined questions, or sharing a favorite photo story." %}
                        </p>
                    </div>

                    <!-- Mystery Event -->
                    <div class="activity-preview-card">
                        <div class="activity-icon text-center">ðŸŽ­</div>
                        <h5 class="text-center mb-2 dark:text-white">{% trans "Mystery Event" %}</h5>
                        <p class="text-gray-500 dark:text-gray-400 text-sm text-center">
                            {% trans "Trust the coaches! A surprise activity designed to help you connect in unexpected ways." %}
                        </p>
                    </div>
                </div>

                <div class="bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-700 text-blue-800 dark:text-blue-300 rounded-lg p-4 mt-4">
                    <h5 class="font-semibold mb-2">{% trans "How It Works:" %}</h5>
                    <ol class="list-decimal list-inside space-y-1">
                        <li>{% trans "Voting opens <strong>15 minutes after the event starts</strong>" %}</li>
                        <li>{% trans "You have <strong>30 minutes</strong> to cast your vote" %}</li>
                        <li>{% trans "Choose your favorite activity format" %}</li>
                        <li>{% trans "The option with the most votes wins!" %}</li>
                        <li>{% trans "We'll announce the winner and the event continues with that activity" %}</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'crush_lu/js/event-voting.js' %}"></script>
{% endblock %}
