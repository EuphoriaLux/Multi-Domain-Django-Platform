{% extends 'crush_lu/base.html' %}
{% load static %}

{% block title %}Event Voting Lobby - {{ event.title }} - Crush.lu{% endblock %}

{% block extra_css %}
<style>
    .countdown-timer {
        font-size: 4rem;
        font-weight: bold;
        color: #9B59B6;
        text-align: center;
        margin: 2rem 0;
    }

    .activity-preview-card {
        border: 2px solid #e9ecef;
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        transition: all 0.3s ease;
    }

    .activity-preview-card:hover {
        border-color: #9B59B6;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(155, 89, 182, 0.15);
    }

    .activity-icon {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
    }

    .status-card {
        background: linear-gradient(135deg, #9B59B6 0%, #FF6B9D 100%);
        color: white;
        border-radius: 15px;
        padding: 2rem;
        text-align: center;
    }
</style>
{% endblock %}

{% block content %}
<!-- Hidden data for JavaScript -->
<div id="event-id-data" data-event-id="{{ event.id }}" style="display: none;"></div>

<div class="row justify-content-center">
    <div class="col-lg-10">
        <a href="{% url 'crush_lu:event_detail' event.id %}" class="btn btn-outline-secondary mb-3">
            ‚Üê Back to Event
        </a>

        <div class="card mb-4">
            <div class="card-body p-5">
                <div class="text-center mb-4">
                    <h1 class="display-4">{{ event.title }}</h1>
                    <p class="lead text-muted">Activity Voting Lobby</p>
                    <span id="voting-status-badge" class="badge bg-warning fs-6">Waiting to Start</span>
                </div>

                {% if user_vote %}
                <div class="alert alert-success mb-4">
                    <h5>‚úì You've Already Voted!</h5>
                    <p class="mb-0">Your choice: <strong>{{ user_vote.selected_option.display_name }}</strong></p>
                    <a href="{% url 'crush_lu:event_voting_results' event.id %}" class="btn btn-sm btn-success mt-2">
                        View Results
                    </a>
                </div>
                {% else %}
                <div class="status-card mb-4">
                    {% if voting_session.is_voting_open %}
                    <h2>Voting is Now Open!</h2>
                    <div class="countdown-timer" id="time-remaining">
                        {{ voting_session.time_remaining|floatformat:0 }}s
                    </div>
                    <p class="mb-3">Time remaining to vote</p>
                    <a href="{% url 'crush_lu:event_activity_vote' event.id %}" class="btn btn-light btn-lg">
                        Cast Your Vote Now
                    </a>
                    {% else %}
                    <h2>Voting Starts In:</h2>
                    <div class="countdown-timer" id="time-until-start">
                        {{ voting_session.time_until_start|floatformat:0 }}s
                    </div>
                    <p class="mb-0">Get ready to choose your favorite activity!</p>
                    {% endif %}
                </div>
                {% endif %}

                <hr class="my-4">

                <div class="row mb-4">
                    <div class="col-md-4 text-center">
                        <h3 class="text-primary">{{ total_attendees }}</h3>
                        <p class="text-muted">Attendees</p>
                    </div>
                    <div class="col-md-4 text-center">
                        <h3 class="text-primary" id="total-votes-count">{{ voting_session.total_votes }}</h3>
                        <p class="text-muted">Votes Cast</p>
                    </div>
                    <div class="col-md-4 text-center">
                        <h3 class="text-primary">30</h3>
                        <p class="text-muted">Minutes to Vote</p>
                    </div>
                </div>

                <h3 class="mb-3">Activity Options Preview</h3>
                <p class="text-muted mb-4">
                    Here's what you'll be voting on. The winning activity will determine how the event flows!
                </p>

                <div class="row">
                    <!-- Speed Dating -->
                    <div class="col-md-4 mb-3">
                        <div class="activity-preview-card">
                            <div class="activity-icon text-center">üíï</div>
                            <h5 class="text-center mb-2">Speed Dating</h5>
                            <p class="text-muted small text-center">
                                Choose from random order, alphabetic, or by hair color variants.
                                Quick 3-5 minute conversations in organized formats.
                            </p>
                        </div>
                    </div>

                    <!-- Presentation Round -->
                    <div class="col-md-4 mb-3">
                        <div class="activity-preview-card">
                            <div class="activity-icon text-center">üé§</div>
                            <h5 class="text-center mb-2">90 Second Presentations</h5>
                            <p class="text-muted small text-center">
                                Everyone introduces themselves creatively. Options include favorite music,
                                predefined questions, or sharing a favorite photo story.
                            </p>
                        </div>
                    </div>

                    <!-- Mystery Event -->
                    <div class="col-md-4 mb-3">
                        <div class="activity-preview-card">
                            <div class="activity-icon text-center">üé≠</div>
                            <h5 class="text-center mb-2">Mystery Event</h5>
                            <p class="text-muted small text-center">
                                Trust the coaches! A surprise activity designed to help you connect
                                in unexpected ways.
                            </p>
                        </div>
                    </div>
                </div>

                <div class="alert alert-info mt-4">
                    <h5>How It Works:</h5>
                    <ol class="mb-0">
                        <li>Voting opens <strong>15 minutes after the event starts</strong></li>
                        <li>You have <strong>30 minutes</strong> to cast your vote</li>
                        <li>Choose your favorite activity format</li>
                        <li>The option with the most votes wins!</li>
                        <li>We'll announce the winner and the event continues with that activity</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'crush_lu/js/event-voting.js' %}"></script>
{% endblock %}
