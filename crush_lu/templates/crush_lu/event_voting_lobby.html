{% extends 'crush_lu/base.html' %}
{% load static %}

{% block title %}Event Voting Lobby - {{ event.title }} - Crush.lu{% endblock %}

{% block extra_css %}
{# Styles moved to static/crush_lu/css/pages/voting.css #}
{% endblock %}

{% block content %}
<!-- Hidden data for JavaScript -->
<div id="event-id-data" data-event-id="{{ event.id }}" style="display: none;"></div>

<div class="flex justify-center">
    <div class="w-full max-w-4xl px-4">
        <a href="{% url 'crush_lu:event_detail' event.id %}" class="inline-flex items-center gap-2 px-4 py-2 mb-4 border border-gray-300 text-gray-700 hover:bg-gray-50 font-medium rounded-lg transition-colors">
            {% include "crush_lu/icons/arrow-left.html" with class="w-4 h-4" %} Back to Event
        </a>

        <div class="bg-white rounded-xl shadow-sm mb-4">
            <div class="p-8">
                <div class="text-center mb-4">
                    <h1 class="display-4">{{ event.title }}</h1>
                    <p class="lead text-muted">Activity Voting Lobby</p>
                    <span id="voting-status-badge" class="badge bg-warning fs-6">Waiting to Start</span>
                </div>

                {% if user_vote %}
                <div class="bg-green-50 border border-green-200 text-green-800 rounded-lg p-4 mb-4">
                    <h5 class="font-semibold">âœ“ You've Already Voted!</h5>
                    <p class="mb-2">Your choice: <strong>{{ user_vote.selected_option.display_name }}</strong></p>
                    <a href="{% url 'crush_lu:event_voting_results' event.id %}" class="inline-flex items-center px-3 py-1 bg-green-600 text-white text-sm font-medium rounded-lg hover:bg-green-700 transition-colors mt-2">
                        View Results
                    </a>
                </div>
                {% else %}
                <div class="status-card mb-4">
                    {% if voting_session.is_voting_open %}
                    <h2>Voting is Now Open!</h2>
                    <div class="countdown-timer" id="time-remaining">
                        {{ voting_session.time_remaining|floatformat:0 }}s
                    </div>
                    <p class="mb-3">Time remaining to vote</p>
                    <a href="{% url 'crush_lu:event_activity_vote' event.id %}" class="inline-flex items-center px-6 py-3 bg-white text-gray-800 font-semibold rounded-lg hover:bg-gray-100 transition-colors text-lg">
                        Cast Your Vote Now
                    </a>
                    {% else %}
                    <h2>Voting Starts In:</h2>
                    <div class="countdown-timer" id="time-until-start">
                        {{ voting_session.time_until_start|floatformat:0 }}s
                    </div>
                    <p class="mb-0">Get ready to choose your favorite activity!</p>
                    {% endif %}
                </div>
                {% endif %}

                <hr class="my-4">

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div class="text-center">
                        <h3 class="text-crush-purple">{{ total_attendees }}</h3>
                        <p class="text-gray-500">Attendees</p>
                    </div>
                    <div class="text-center">
                        <h3 class="text-crush-purple" id="total-votes-count">{{ voting_session.total_votes }}</h3>
                        <p class="text-gray-500">Votes Cast</p>
                    </div>
                    <div class="text-center">
                        <h3 class="text-crush-purple">30</h3>
                        <p class="text-gray-500">Minutes to Vote</p>
                    </div>
                </div>

                <h3 class="mb-3">Activity Options Preview</h3>
                <p class="text-muted mb-4">
                    Here's what you'll be voting on. The winning activity will determine how the event flows!
                </p>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- Speed Dating -->
                    <div class="activity-preview-card">
                        <div class="activity-icon text-center">ðŸ’•</div>
                        <h5 class="text-center mb-2">Speed Dating</h5>
                        <p class="text-gray-500 text-sm text-center">
                            Choose from random order, alphabetic, or by hair color variants.
                            Quick 3-5 minute conversations in organized formats.
                        </p>
                    </div>

                    <!-- Presentation Round -->
                    <div class="activity-preview-card">
                        <div class="activity-icon text-center">ðŸŽ¤</div>
                        <h5 class="text-center mb-2">90 Second Presentations</h5>
                        <p class="text-gray-500 text-sm text-center">
                            Everyone introduces themselves creatively. Options include favorite music,
                            predefined questions, or sharing a favorite photo story.
                        </p>
                    </div>

                    <!-- Mystery Event -->
                    <div class="activity-preview-card">
                        <div class="activity-icon text-center">ðŸŽ­</div>
                        <h5 class="text-center mb-2">Mystery Event</h5>
                        <p class="text-gray-500 text-sm text-center">
                            Trust the coaches! A surprise activity designed to help you connect
                            in unexpected ways.
                        </p>
                    </div>
                </div>

                <div class="bg-blue-50 border border-blue-200 text-blue-800 rounded-lg p-4 mt-4">
                    <h5 class="font-semibold mb-2">How It Works:</h5>
                    <ol class="list-decimal list-inside space-y-1">
                        <li>Voting opens <strong>15 minutes after the event starts</strong></li>
                        <li>You have <strong>30 minutes</strong> to cast your vote</li>
                        <li>Choose your favorite activity format</li>
                        <li>The option with the most votes wins!</li>
                        <li>We'll announce the winner and the event continues with that activity</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'crush_lu/js/event-voting.js' %}"></script>
{% endblock %}
