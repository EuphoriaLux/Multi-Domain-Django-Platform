{% load static %}
{% load i18n %}
{% load analytics %}
{% load seo_tags %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE|default:'en' }}">
<head>
    {% analytics_head %}
    {% if user.is_authenticated %}{% appinsights_head %}{% endif %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Crush.lu - Meet New People{% endblock %}</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{% static 'crush_lu/crush_favicon.ico' %}">

    <!-- Performance: Resource Hints -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="https://js.monitor.azure.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- SEO: Canonical URL (self-referencing - each language version is its own canonical) -->
    <link rel="canonical" href="{% block canonical_url %}{% canonical_url %}{% endblock %}">

    <!-- SEO: Hreflang tags for multi-language support (en, de, fr) -->
    {% block hreflang_tags %}
    {% hreflang_tags %}
    {% endblock %}

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="{% block og_type %}website{% endblock %}">
    <meta property="og:url" content="https://crush.lu{{ request.path }}">
    <meta property="og:title" content="{% block og_title %}Crush.lu - Meet New People in Luxembourg{% endblock %}">
    <meta property="og:description" content="{% block og_description %}Privacy-first dating platform for Luxembourg. Meet real people at organized events - no endless swiping, just authentic connections.{% endblock %}">
    <meta property="og:image" content="{% block og_image %}{{ social_preview_image_url }}{% endblock %}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:locale" content="{% og_locale %}">
    <meta property="og:site_name" content="Crush.lu">
    <meta property="fb:app_id" content="1170910678282435">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://crush.lu{{ request.path }}">
    <meta property="twitter:title" content="{% block twitter_title %}Crush.lu - Meet New People in Luxembourg{% endblock %}">
    <meta property="twitter:description" content="{% block twitter_description %}Privacy-first dating platform for Luxembourg. Meet real people at organized events - no endless swiping, just authentic connections.{% endblock %}">
    <meta property="twitter:image" content="{% block twitter_image %}{{ social_preview_image_url }}{% endblock %}">

    <!-- Additional SEO -->
    <meta name="description" content="{% block meta_description %}Privacy-first dating platform for Luxembourg. Coach-curated profiles and event-based meetups for authentic connections.{% endblock %}">
    <meta name="keywords" content="{% block meta_keywords %}dating luxembourg, meetups luxembourg, singles events, crush.lu, dating events, speed dating luxembourg, singles events luxembourg{% endblock %}">
    <meta name="robots" content="{% block meta_robots %}index, follow{% endblock %}">
    <meta name="author" content="Crush.lu">
    <meta name="geo.region" content="LU">
    <meta name="geo.placename" content="Luxembourg">

    <!-- Schema.org Organization Structured Data (JSON-LD) -->
    {% block structured_data %}
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "Crush.lu",
        "alternateName": "Crush Luxembourg",
        "url": "https://crush.lu",
        "logo": "https://crush.lu{% static 'crush_lu/icons/android-launchericon-512-512.png' %}",
        "description": "Privacy-first dating platform for Luxembourg. Meet real people at organized events - no endless swiping, just authentic connections.",
        "foundingDate": "2025",
        "areaServed": {
            "@type": "Country",
            "name": "Luxembourg"
        },
        "sameAs": [{% for link in social_links %}"{{ link.url }}"{% if not forloop.last %}, {% endif %}{% endfor %}],
        "contactPoint": {
            "@type": "ContactPoint",
            "contactType": "customer service",
            "email": "love@crush.lu",
            {% if whatsapp_enabled and whatsapp_number %}"url": "https://wa.me/{{ whatsapp_number }}",{% endif %}
            "availableLanguage": ["English", "German", "French"]
        }
    }
    </script>
    {% endblock %}

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#9B59B6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Crush.lu">
    <meta name="mobile-web-app-capable" content="yes">
    {% url 'pwa_manifest' as manifest_url %}{% if manifest_url %}<link rel="manifest" href="{{ manifest_url }}">{% endif %}

    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'crush_lu/icons/ios/180.png' %}">
    <link rel="apple-touch-icon" sizes="167x167" href="{% static 'crush_lu/icons/ios/167.png' %}">
    <link rel="apple-touch-icon" sizes="152x152" href="{% static 'crush_lu/icons/ios/152.png' %}">
    <link rel="apple-touch-icon" sizes="144x144" href="{% static 'crush_lu/icons/ios/144.png' %}">
    <link rel="apple-touch-icon" sizes="120x120" href="{% static 'crush_lu/icons/ios/120.png' %}">
    <link rel="apple-touch-icon" sizes="114x114" href="{% static 'crush_lu/icons/ios/114.png' %}">
    <link rel="apple-touch-icon" sizes="76x76" href="{% static 'crush_lu/icons/ios/76.png' %}">
    <link rel="apple-touch-icon" sizes="72x72" href="{% static 'crush_lu/icons/ios/72.png' %}">
    <link rel="apple-touch-icon" sizes="60x60" href="{% static 'crush_lu/icons/ios/60.png' %}">
    <link rel="apple-touch-icon" sizes="57x57" href="{% static 'crush_lu/icons/ios/57.png' %}">
    <link rel="apple-touch-icon" href="{% static 'crush_lu/icons/ios/180.png' %}">

    <!-- Theme Manager - MUST load before CSS to prevent flash of wrong theme -->
    <script src="{% static 'crush_lu/js/theme-manager.js' %}"></script>

    <!-- Critical CSS - Inlined for fastest FCP/LCP (above-the-fold styles) -->
    <style>
        /* Critical CSS for Crush.lu - prevents FOUC and enables fast first paint */
        :root{--crush-pink:#FF6B9D;--crush-purple:#9B59B6;--crush-dark:#2C3E50;--crush-light:#F8F9FA;--bg-primary:#F8F9FA;--bg-secondary:#FFFFFF;--text-primary:#2C3E50;--text-secondary:#64748b;--border-color:#e2e8f0}
        html.dark{--bg-primary:#0f172a;--bg-secondary:#1e293b;--text-primary:#f1f5f9;--text-secondary:#94a3b8;--border-color:#334155;--crush-purple:#A78BFA;--crush-pink:#FB7185}
        [x-cloak]{display:none!important}
        *,::before,::after{box-sizing:border-box}
        body{margin:0;font-family:Inter,system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg-primary);color:var(--text-primary);-webkit-font-smoothing:antialiased;transition:background-color 0.3s ease,color 0.3s ease}
        .container{max-width:1200px;margin-inline:auto;padding-inline:1rem}
        .crush-navbar{background:linear-gradient(135deg,#9B59B6,#FF6B9D);box-shadow:0 2px 10px rgba(0,0,0,.08)}
        html.dark .crush-navbar{background:linear-gradient(135deg,#6D28D9,#BE185D);box-shadow:0 2px 10px rgba(0,0,0,.5)}
        .navbar-brand{color:#fff;font-weight:700;font-size:1.5rem;text-decoration:none}
        .nav-link{display:inline-flex;align-items:center;gap:.375rem;color:rgba(255,255,255,.9);padding:.5rem .75rem;text-decoration:none;font-weight:500}
        #page-loading-overlay{position:fixed;inset:0;background:linear-gradient(135deg,#9B59B6 0%,#FF6B9D 100%);display:none;align-items:center;justify-content:center;z-index:9999}
        #page-loading-overlay.show{display:flex}
        .loading-content{text-align:center;color:#fff}
        .loading-ghost{margin:0 auto 1rem;display:flex;justify-content:center}
        .hidden{display:none}
        .lg\:hidden{display:none}
        @media(max-width:1023px){.lg\:hidden{display:block}}
        .flex{display:flex}.items-center{align-items:center}.justify-between{justify-content:space-between}
        .py-3{padding-top:.75rem;padding-bottom:.75rem}
        .text-white{color:#fff}
        /* Hero section critical styles for LCP optimization */
        .hero-section{background:linear-gradient(135deg,#9B59B6 0%,#FF6B9D 100%);color:#fff;padding:5rem 1rem;width:100vw;margin-left:calc(-50vw + 50%);margin-top:-2rem!important;position:relative;overflow:hidden;border-radius:0 0 50px 50px}
        html.dark .hero-section{background:linear-gradient(135deg,#581C87 0%,#9F1239 100%)}
        .hero-content{position:relative;z-index:1;max-width:1200px;margin:0 auto}
        .hero-title{font-size:clamp(2.5rem,6vw,4.5rem);font-weight:800;margin-bottom:1.5rem;line-height:1.2}
        .hero-subtitle{font-size:clamp(1.1rem,2.5vw,1.5rem);opacity:.95;margin-bottom:2.5rem;max-width:700px}
        .hero-emoji{font-size:clamp(8rem,20vw,15rem);display:inline-block}
        .hero-ghost-svg{width:clamp(8rem,20vw,15rem);height:auto;display:inline-block;filter:drop-shadow(0 10px 30px rgba(0,0,0,.15))}
        .hero-cta{display:flex;gap:1rem;flex-wrap:wrap;justify-content:center;align-items:center}
        .btn-hero-primary{background:#fff;color:#9B59B6;font-weight:600;padding:1rem 2.5rem;border-radius:50px;border:none;font-size:1.1rem;box-shadow:0 8px 20px rgba(0,0,0,.2);text-decoration:none;display:inline-block}
        html.dark .btn-hero-primary{background:#1e293b;color:#fff;box-shadow:0 8px 20px rgba(0,0,0,.5)}
        .btn-hero-secondary{background:rgba(255,255,255,.2);color:#fff;font-weight:600;padding:1rem 2.5rem;border-radius:50px;border:2px solid #fff;font-size:1.1rem;text-decoration:none;display:inline-block}
        html.dark .btn-hero-secondary{background:rgba(255,255,255,.15);border-color:rgba(255,255,255,.6)}
        @media(max-width:767px){.hero-section{padding:3rem 1rem}.hero-cta{flex-direction:column}.hero-cta .btn-hero-primary,.hero-cta .btn-hero-secondary{width:100%;max-width:300px;text-align:center}}
    </style>

    <!-- Tailwind CSS (all styles bundled) -->
    {% if debug %}
        {% now "U" as ts %}
        <link rel="stylesheet" href="{% static 'crush_lu/css/tailwind.css' %}?v={{ ts }}">
    {% else %}
        <link rel="stylesheet" href="{% static 'crush_lu/css/tailwind.css' %}">
    {% endif %}
    
    <!-- HTMX Configuration -->
    <meta name="htmx-config" content='{"defaultSwapStyle":"innerHTML","globalViewTransitions":true}'>

    {% block extra_css %}{% endblock %}
</head>
<body class="{% block body_class %}{% endblock %}">
    {# HTMX CSRF Token - Read from hidden input for reliable cross-language support #}
    {# This works correctly when CSRF_COOKIE_HTTPONLY=True #}
    <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}" id="csrf-token-input">
    {# External script for CSP compliance - runs synchronously before HTMX #}
    <script src="{% static 'crush_lu/js/htmx-csrf.js' %}"></script>
    {% include "includes/staging_banner.html" %}
    {% analytics_body %}
    <!-- Skip to main content link for keyboard/screen reader users -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:bg-white dark:focus:bg-gray-800 focus:text-crush-purple dark:focus:text-purple-400 focus:px-4 focus:py-2 focus:rounded-lg focus:shadow-lg focus:font-semibold">
        Skip to main content
    </a>
    <!-- Loading Overlay -->
    <div id="page-loading-overlay" role="status" aria-live="polite" aria-label="Loading">
        <div class="loading-content">
            <div class="loading-ghost" aria-hidden="true">
                {% include "crush_lu/includes/ghost-logo-animated.html" with class="w-20 h-20" %}
            </div>
            <div class="loading-text">{% trans "Loading..." %}</div>
            <div class="loading-subtext">{% trans "Just a moment" %}</div>
        </div>
    </div>

    <!-- Navigation (Alpine.js powered) -->
    <nav class="crush-navbar" x-data="navbar">
        <div class="container">
            <div class="flex justify-between items-center py-3">
                <!-- Brand -->
                {% if user.is_authenticated %}
                    <a class="navbar-brand flex items-center gap-2" href="{% url 'crush_lu:dashboard' %}">{% include "crush_lu/includes/ghost-logo.html" with class="w-7 h-7" %}<span>Crush.lu</span></a>
                {% else %}
                    <a class="navbar-brand flex items-center gap-2" href="{% url 'crush_lu:home' %}">{% include "crush_lu/includes/ghost-logo.html" with class="w-7 h-7" %}<span>Crush.lu</span></a>
                {% endif %}

                <!-- Mobile menu button -->
                <button type="button"
                        @click="toggleMobile"
                        class="lg:hidden text-white p-3 rounded-lg hover:bg-white/10 transition-colors focus-ring-white"
                        aria-label="Toggle navigation menu"
                        x-bind:aria-expanded="mobileMenuAriaExpanded"
                        aria-controls="mobile-nav-menu">
                    <!-- Hamburger icon -->
                    <svg x-show="mobileMenuClosed" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                    </svg>
                    <!-- Close icon -->
                    <svg x-show="mobileMenuOpen" x-cloak class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>

                <!-- Desktop Navigation -->
                <nav class="desktop-nav items-center space-x-1" role="navigation" aria-label="Main navigation">
                    {% if user.is_authenticated %}
                        {# Check if user is a coach #}
                        {% if user.crushcoach and user.crushcoach.is_active %}
                            {# COACH NAVIGATION #}
                            <a class="nav-link" href="{% url 'crush_lu:coach_dashboard' %}">
                                {% include "shared/icons/chart-bar.html" with class="w-4 h-4" %}
                                <span>{% trans "Coach Dashboard" %}</span>
                                {% if pending_screening_count > 0 %}
                                    <span class="badge badge-warning">{{ pending_screening_count }}</span>
                                {% endif %}
                            </a>
                            {% if has_special_journey %}
                            <a class="nav-link special-journey" href="{% url 'crush_lu:journey_map' %}">
                                {% include "shared/icons/star.html" with class="w-4 h-4 text-yellow-400" %}
                                <span>{% trans "Special Journey" %}</span>
                                {% if not journey_started %}
                                    <span class="badge badge-warning">{% trans "New!" %}</span>
                                {% endif %}
                            </a>
                            {% endif %}
                            <a class="nav-link" href="{% url 'crush_lu:coach_sessions' %}">
                                {% include "shared/icons/calendar.html" with class="w-4 h-4" %}
                                <span>{% trans "My Sessions" %}</span>
                            </a>
                            <a class="nav-link" href="{% url 'crush_lu:event_list' %}">
                                {% include "shared/icons/calendar.html" with class="w-4 h-4" %}
                                <span>{% trans "Events" %}</span>
                            </a>
                            <a class="nav-link" href="{% url 'crush_lu:dashboard' %}?user_view=1">
                                {% include "shared/icons/home.html" with class="w-4 h-4" %}
                                <span>{% trans "My Profile" %}</span>
                            </a>

                            <!-- Coach Tools Dropdown -->
                            <div class="dropdown" @click.away="closeCoachTools">
                                <button type="button" @click="toggleCoachTools" class="nav-link" aria-haspopup="true" x-bind:aria-expanded="coachToolsAriaExpanded">
                                    {% include "shared/icons/cog.html" with class="w-4 h-4" %}
                                    <span>{% trans "Coach Tools" %}</span>
                                    {% include "shared/icons/chevron-down.html" with class="w-3 h-3" %}
                                </button>
                                <div x-show="coachToolsOpen"
                                     x-transition:enter="transition ease-out duration-100"
                                     x-transition:enter-start="opacity-0 scale-95"
                                     x-transition:enter-end="opacity-100 scale-100"
                                     x-transition:leave="transition ease-in duration-75"
                                     x-transition:leave-start="opacity-100 scale-100"
                                     x-transition:leave-end="opacity-0 scale-95"
                                     x-cloak
                                     class="dropdown-menu">
                                    <a class="dropdown-item" href="{% url 'crush_lu:coach_dashboard' %}">
                                        {% include "shared/icons/clipboard.html" with class="w-4 h-4 inline mr-2" %}
                                        {% trans "Review Queue" %}
                                        {% if pending_screening_count > 0 %}
                                            <span class="badge badge-warning ml-2">{{ pending_screening_count }}</span>
                                        {% endif %}
                                    </a>
                                    <a class="dropdown-item" href="{% url 'crush_lu:coach_journey_dashboard' %}">
                                        {% include "shared/icons/map-pin.html" with class="w-4 h-4 inline mr-2" %}
                                        {% trans "Journey Management" %}
                                    </a>
                                    <div class="dropdown-divider"></div>
                                    <a class="dropdown-item" href="{% url 'crush_lu:coach_sessions' %}">
                                        {% include "shared/icons/chat-bubble-left-right.html" with class="w-4 h-4 inline mr-2" %}
                                        {% trans "All Sessions" %}
                                    </a>
                                    <a class="dropdown-item" href="{% url 'crush_lu:event_list' %}">
                                        {% include "shared/icons/calendar.html" with class="w-4 h-4 inline mr-2" %}
                                        {% trans "Manage Events" %}
                                    </a>
                                </div>
                            </div>

                            <!-- Coach Profile Dropdown -->
                            <div class="dropdown" @click.away="closeCoachProfile">
                                <button type="button" @click="toggleCoachProfile" class="nav-link" aria-haspopup="true" x-bind:aria-expanded="coachProfileAriaExpanded">
                                    {% include "shared/icons/user-circle.html" with class="w-4 h-4" %}
                                    <span>{{ user.first_name|default:user.username }}</span>
                                    {% include "shared/icons/chevron-down.html" with class="w-3 h-3" %}
                                </button>
                                <div x-show="coachProfileOpen"
                                     x-transition:enter="transition ease-out duration-100"
                                     x-transition:enter-start="opacity-0 scale-95"
                                     x-transition:enter-end="opacity-100 scale-100"
                                     x-transition:leave="transition ease-in duration-75"
                                     x-transition:leave-start="opacity-100 scale-100"
                                     x-transition:leave-end="opacity-0 scale-95"
                                     x-cloak
                                     class="dropdown-menu">
                                    <a class="dropdown-item" href="{% url 'crush_lu:dashboard' %}?user_view=1">
                                        {% include "shared/icons/home.html" with class="w-4 h-4 inline mr-2" %}
                                        {% trans "My Dashboard" %}
                                    </a>
                                    {% if user.crushprofile %}
                                        {% if profile_is_approved %}
                                        <a class="dropdown-item" href="{% url 'crush_lu:edit_profile' %}">
                                            {% include "shared/icons/pencil.html" with class="w-4 h-4 inline mr-2" %}
                                            {% trans "Edit Profile" %}
                                        </a>
                                        {% elif profile_completion_status in 'not_started,step1,step2,step3,completed' %}
                                        <a class="dropdown-item" href="{% url 'crush_lu:create_profile' %}">
                                            {% include "shared/icons/arrow-path.html" with class="w-4 h-4 inline mr-2" %}
                                            {% trans "Finish Profile" %}
                                        </a>
                                        {% else %}
                                        <a class="dropdown-item" href="{% url 'crush_lu:edit_profile' %}">
                                            {% include "shared/icons/pencil.html" with class="w-4 h-4 inline mr-2" %}
                                            {% trans "Edit Profile" %}
                                        </a>
                                        {% endif %}
                                    {% endif %}
                                    <a class="dropdown-item" href="{% url 'crush_lu:account_settings' %}">
                                        {% include "shared/icons/cog.html" with class="w-4 h-4 inline mr-2" %}
                                        {% trans "Account Settings" %}
                                    </a>
                                    <div class="dropdown-divider"></div>
                                    <a class="dropdown-item text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20" href="{% url 'crush_lu:logout' %}">
                                        {% include "shared/icons/arrow-right-on-rectangle.html" with class="w-4 h-4 inline mr-2" %}
                                        {% trans "Logout" %}
                                    </a>
                                </div>
                            </div>
                        {% else %}
                            {# DATING USER NAVIGATION - varies by profile status #}

                            {% if profile_is_approved %}
                                {# APPROVED USER: Full navigation #}
                                <a class="nav-link" href="{% url 'crush_lu:dashboard' %}">
                                    {% include "shared/icons/home.html" with class="w-4 h-4" %}
                                    <span>{% trans "Dashboard" %}</span>
                                </a>
                                {% if has_special_journey %}
                                <a class="nav-link special-journey" href="{% url 'crush_lu:journey_map' %}">
                                    {% include "shared/icons/star.html" with class="w-4 h-4 text-yellow-400" %}
                                    <span>{% trans "Special Journey" %}</span>
                                    {% if not journey_started %}
                                        <span class="badge badge-warning">{% trans "New!" %}</span>
                                    {% endif %}
                                </a>
                                {% endif %}

                                <!-- Events Dropdown -->
                                <div class="dropdown" @click.away="closeEvents">
                                    <button type="button" @click="toggleEvents" class="nav-link" aria-haspopup="true" x-bind:aria-expanded="eventsAriaExpanded">
                                        {% include "shared/icons/calendar.html" with class="w-4 h-4" %}
                                        <span>{% trans "Events" %}</span>
                                        {% if upcoming_events_count > 0 %}
                                            <span class="badge badge-info">{{ upcoming_events_count }}</span>
                                        {% endif %}
                                        {% include "shared/icons/chevron-down.html" with class="w-3 h-3" %}
                                    </button>
                                    <div x-show="eventsOpen"
                                         x-transition:enter="transition ease-out duration-100"
                                         x-transition:enter-start="opacity-0 scale-95"
                                         x-transition:enter-end="opacity-100 scale-100"
                                         x-transition:leave="transition ease-in duration-75"
                                         x-transition:leave-start="opacity-100 scale-100"
                                         x-transition:leave-end="opacity-0 scale-95"
                                         x-cloak
                                         class="dropdown-menu">
                                        <div class="px-4 py-2 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase">{% trans "Upcoming Events" %}</div>
                                        {% if upcoming_events %}
                                            {% for registration in upcoming_events %}
                                                <a class="dropdown-item" href="{% url 'crush_lu:event_detail' registration.event.id %}">
                                                    <div class="flex justify-between items-start">
                                                        <div>
                                                            <strong>{{ registration.event.title|truncatewords:4 }}</strong>
                                                            <br>
                                                            <small class="text-gray-500">
                                                                {{ registration.event.date_time|date:"M d, g:i A" }}
                                                            </small>
                                                        </div>
                                                        {% if registration.status == 'waitlist' %}
                                                            <span class="badge badge-secondary ml-2">{% trans "Waitlist" %}</span>
                                                        {% else %}
                                                            <span class="badge badge-success ml-2">✓</span>
                                                        {% endif %}
                                                    </div>
                                                </a>
                                            {% endfor %}
                                            <div class="dropdown-divider"></div>
                                        {% else %}
                                            <span class="block px-4 py-2 text-gray-500">{% trans "No upcoming events" %}</span>
                                            <div class="dropdown-divider"></div>
                                        {% endif %}
                                        <a class="dropdown-item" href="{% url 'crush_lu:event_list' %}">
                                            {% include "shared/icons/magnifying-glass.html" with class="w-4 h-4 inline mr-2" %}
                                            {% trans "Browse All Events" %}
                                        </a>
                                    </div>
                                </div>

                                <a class="nav-link" href="{% url 'crush_lu:my_connections' %}">
                                    {% include "shared/icons/users.html" with class="w-4 h-4" %}
                                    <span>{% trans "Connections" %}</span>
                                    {% if pending_requests_count > 0 %}
                                        <span class="badge badge-danger">{{ pending_requests_count }}</span>
                                    {% endif %}
                                </a>

                            {% elif profile_status == 'pending' %}
                                {# PENDING REVIEW: Show status + browse events #}
                                <a class="nav-link" href="{% url 'crush_lu:dashboard' %}">
                                    {% include "shared/icons/clock.html" with class="w-4 h-4" %}
                                    <span>{% trans "Under Review" %}</span>
                                    <span class="badge badge-info">⏳</span>
                                </a>
                                {% if assigned_coach_name %}
                                <span class="text-white/60 text-xs desktop-nav-inline">
                                    {{ assigned_coach_name }} {% trans "is reviewing" %}
                                </span>
                                {% endif %}
                                {% if has_special_journey %}
                                <a class="nav-link special-journey" href="{% url 'crush_lu:journey_map' %}">
                                    {% include "shared/icons/star.html" with class="w-4 h-4 text-yellow-400" %}
                                    <span>{% trans "Special Journey" %}</span>
                                </a>
                                {% endif %}
                                <a class="nav-link" href="{% url 'crush_lu:event_list' %}">
                                    {% include "shared/icons/calendar.html" with class="w-4 h-4" %}
                                    <span>{% trans "Browse Events" %}</span>
                                </a>

                            {% elif profile_status == 'revision' %}
                                {# REVISION NEEDED: Fix profile + locked features #}
                                <a class="nav-link text-orange-400 hover:text-orange-300" href="{% url 'crush_lu:edit_profile' %}">
                                    {% include "shared/icons/exclamation-circle.html" with class="w-4 h-4" %}
                                    <span>{% trans "Fix Profile" %}</span>
                                    <span class="badge badge-warning">!</span>
                                </a>
                                {% if has_special_journey %}
                                <a class="nav-link special-journey" href="{% url 'crush_lu:journey_map' %}">
                                    {% include "shared/icons/star.html" with class="w-4 h-4 text-yellow-400" %}
                                    <span>{% trans "Special Journey" %}</span>
                                </a>
                                {% endif %}
                                <a class="nav-link" href="{% url 'crush_lu:event_list' %}">
                                    {% include "shared/icons/calendar.html" with class="w-4 h-4" %}
                                    <span>{% trans "Browse Events" %}</span>
                                </a>
                                {% include "crush_lu/partials/nav_locked_item.html" with label=_("Connections") tooltip=_("Connect after events") %}

                            {% else %}
                                {# PROFILE INCOMPLETE: Progress dropdown + locked features #}
                                {% include "crush_lu/partials/nav_progress_dropdown.html" %}
                                {% if has_special_journey %}
                                <a class="nav-link special-journey" href="{% url 'crush_lu:journey_map' %}">
                                    {% include "shared/icons/star.html" with class="w-4 h-4 text-yellow-400" %}
                                    <span>{% trans "Special Journey" %}</span>
                                    {% if not journey_started %}
                                        <span class="badge badge-warning">{% trans "New!" %}</span>
                                    {% endif %}
                                </a>
                                {% endif %}
                                <a class="nav-link" href="{% url 'crush_lu:event_list' %}">
                                    {% include "shared/icons/calendar.html" with class="w-4 h-4" %}
                                    <span>{% trans "Browse Events" %}</span>
                                </a>
                                {% include "crush_lu/partials/nav_locked_item.html" with label=_("Connections") tooltip=_("Connect after events") %}
                            {% endif %}

                            <!-- User Profile Dropdown (always shown for authenticated users) -->
                            <div class="dropdown" @click.away="closeUserMenu">
                                <button type="button" @click="toggleUserMenu" class="nav-link" aria-haspopup="true" x-bind:aria-expanded="userMenuAriaExpanded">
                                    {% include "shared/icons/user-circle.html" with class="w-4 h-4" %}
                                    <span>{{ user.first_name|default:user.username }}</span>
                                    {% if profile_status == 'pending' %}
                                        <span class="badge badge-info" title="{% trans 'Profile pending review' %}">⏳</span>
                                    {% elif profile_status == 'rejected' %}
                                        <span class="badge badge-danger" title="{% trans 'Profile rejected' %}">✗</span>
                                    {% elif profile_status == 'revision' %}
                                        <span class="badge badge-warning" title="{% trans 'Profile needs revision' %}">!</span>
                                    {% elif profile_is_approved %}
                                        <span class="badge badge-success" title="{% trans 'Profile approved' %}">✓</span>
                                    {% endif %}
                                    {% include "shared/icons/chevron-down.html" with class="w-3 h-3" %}
                                </button>
                                <div x-show="userMenuOpen"
                                     x-transition:enter="transition ease-out duration-100"
                                     x-transition:enter-start="opacity-0 scale-95"
                                     x-transition:enter-end="opacity-100 scale-100"
                                     x-transition:leave="transition ease-in duration-75"
                                     x-transition:leave-start="opacity-100 scale-100"
                                     x-transition:leave-end="opacity-0 scale-95"
                                     x-cloak
                                     class="dropdown-menu">
                                    {% if user.crushprofile %}
                                        <div class="px-4 py-2 text-xs font-semibold text-gray-500">
                                            {% trans "Profile Status:" %}
                                            {% if profile_status == 'pending' %}
                                                <span class="text-blue-500">{% trans "Pending Review" %}</span>
                                            {% elif profile_status == 'rejected' %}
                                                <span class="text-red-500">{% trans "Rejected" %}</span>
                                            {% elif profile_status == 'revision' %}
                                                <span class="text-yellow-600">{% trans "Needs Revision" %}</span>
                                            {% elif profile_is_approved %}
                                                <span class="text-green-500">{% trans "Approved" %} ✓</span>
                                            {% else %}
                                                <span class="text-gray-500">{% trans "Not Submitted" %}</span>
                                            {% endif %}
                                        </div>
                                        <div class="dropdown-divider"></div>
                                        {% if profile_is_approved %}
                                        <a class="dropdown-item" href="{% url 'crush_lu:edit_profile' %}">
                                            {% include "shared/icons/pencil.html" with class="w-4 h-4 inline mr-2" %}
                                            {% trans "Edit Profile" %}
                                        </a>
                                        {% elif profile_completion_status in 'not_started,step1,step2,step3,completed' %}
                                        <a class="dropdown-item" href="{% url 'crush_lu:create_profile' %}">
                                            {% include "shared/icons/arrow-path.html" with class="w-4 h-4 inline mr-2" %}
                                            {% trans "Finish Profile" %}
                                        </a>
                                        {% else %}
                                        <a class="dropdown-item" href="{% url 'crush_lu:edit_profile' %}">
                                            {% include "shared/icons/pencil.html" with class="w-4 h-4 inline mr-2" %}
                                            {% trans "Edit Profile" %}
                                        </a>
                                        {% endif %}
                                    {% else %}
                                        <a class="dropdown-item" href="{% url 'crush_lu:create_profile' %}">
                                            {% include "shared/icons/user-plus.html" with class="w-4 h-4 inline mr-2" %}
                                            {% trans "Create Profile" %}
                                        </a>
                                    {% endif %}
                                    <a class="dropdown-item" href="{% url 'crush_lu:account_settings' %}">
                                        {% include "shared/icons/cog.html" with class="w-4 h-4 inline mr-2" %}
                                        {% trans "Account Settings" %}
                                    </a>
                                    <div class="dropdown-divider"></div>
                                    <a class="dropdown-item text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20" href="{% url 'crush_lu:logout' %}">
                                        {% include "shared/icons/arrow-right-on-rectangle.html" with class="w-4 h-4 inline mr-2" %}
                                        {% trans "Logout" %}
                                    </a>
                                </div>
                            </div>
                        {% endif %}
                    {% else %}
                        {# GUEST NAVIGATION #}
                        <a class="nav-link" href="{% url 'crush_lu:about' %}">{% trans "About" %}</a>
                        <a class="nav-link" href="{% url 'crush_lu:how_it_works' %}">{% trans "How It Works" %}</a>
                        <a class="nav-link" href="{% url 'crush_lu:event_list' %}">{% trans "Events" %}</a>
                        <a class="nav-link" href="{% url 'crush_lu:membership' %}">{% trans "Membership" %}</a>
                        <a class="inline-flex items-center bg-white text-gray-800 px-4 py-2 rounded-full font-semibold hover:bg-gray-100 transition-colors shadow-sm" href="{% url 'crush_lu:login' %}">
                            {% trans "Login / Join" %}
                        </a>
                    {% endif %}

                    {# Theme Toggle (always visible) #}
                    <div x-data="themeToggle" class="relative">
                        <button
                            @click="toggleTheme"
                            x-bind:class="toggleButtonClass"
                            class="p-2 rounded-lg transition-all duration-300 flex items-center gap-2 border-0 focus:outline-none focus:ring-2 focus:ring-white/50"
                            x-bind:aria-label="ariaLabel"
                            type="button">
                            <!-- Sun icon -->
                            <svg x-bind:class="sunIconClass" class="w-5 h-5 transition-opacity duration-300" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                                <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"/>
                            </svg>
                            <!-- Moon icon -->
                            <svg x-bind:class="moonIconClass" class="w-5 h-5 transition-opacity duration-300" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                                <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"/>
                            </svg>
                            <!-- Desktop: Show status text -->
                            <span class="hidden md:inline text-sm font-medium" x-text="statusText"></span>
                        </button>
                    </div>

                    {# Language Switcher (always visible) #}
                    {% include "crush_lu/partials/language_switcher.html" %}
                </nav>
            </div>

            <!-- Mobile Navigation Menu -->
            <div id="mobile-nav-menu"
                 x-show="mobileMenuOpen"
                 x-transition:enter="transition ease-out duration-200"
                 x-transition:enter-start="opacity-0 -translate-y-2"
                 x-transition:enter-end="opacity-100 translate-y-0"
                 x-transition:leave="transition ease-in duration-150"
                 x-transition:leave-start="opacity-100 translate-y-0"
                 x-transition:leave-end="opacity-0 -translate-y-2"
                 x-cloak
                 role="navigation"
                 aria-label="Mobile navigation"
                 class="lg:hidden pb-4 border-t border-white/20 mt-2 pt-4">
                <div class="flex flex-col space-y-2">
                    {% if user.is_authenticated %}
                        {% if user.crushcoach and user.crushcoach.is_active %}
                            {# COACH MOBILE NAVIGATION #}
                            <a class="nav-link block" href="{% url 'crush_lu:coach_dashboard' %}">
                                {% include "shared/icons/chart-bar.html" with class="w-4 h-4 inline mr-2" %}
                                {% trans "Coach Dashboard" %}
                                {% if pending_screening_count > 0 %}
                                    <span class="badge badge-warning ml-1">{{ pending_screening_count }}</span>
                                {% endif %}
                            </a>
                            {% if has_special_journey %}
                            <a class="nav-link block special-journey" href="{% url 'crush_lu:journey_map' %}">
                                {% include "shared/icons/star.html" with class="w-4 h-4 inline mr-2 text-yellow-400" %}
                                {% trans "Special Journey" %}
                            </a>
                            {% endif %}
                            <a class="nav-link block" href="{% url 'crush_lu:coach_sessions' %}">
                                {% include "shared/icons/calendar.html" with class="w-4 h-4 inline mr-2" %}
                                {% trans "My Sessions" %}
                            </a>
                            <a class="nav-link block" href="{% url 'crush_lu:event_list' %}">
                                {% include "shared/icons/calendar.html" with class="w-4 h-4 inline mr-2" %}
                                {% trans "Events" %}
                            </a>
                            <a class="nav-link block" href="{% url 'crush_lu:dashboard' %}?user_view=1">
                                {% include "shared/icons/home.html" with class="w-4 h-4 inline mr-2" %}
                                {% trans "My Profile" %}
                            </a>
                            <div class="border-t border-white/20 my-2"></div>
                            <a class="nav-link block" href="{% url 'crush_lu:coach_journey_dashboard' %}">
                                {% include "shared/icons/map-pin.html" with class="w-4 h-4 inline mr-2" %}
                                {% trans "Journey Management" %}
                            </a>
                            {% if user.crushprofile %}
                                {% if profile_is_approved %}
                                <a class="nav-link block" href="{% url 'crush_lu:edit_profile' %}">
                                    {% include "shared/icons/pencil.html" with class="w-4 h-4 inline mr-2" %}
                                    {% trans "Edit Profile" %}
                                </a>
                                {% elif profile_completion_status in 'not_started,step1,step2,step3,completed' %}
                                <a class="nav-link block" href="{% url 'crush_lu:create_profile' %}">
                                    {% include "shared/icons/arrow-path.html" with class="w-4 h-4 inline mr-2" %}
                                    {% trans "Finish Profile" %}
                                </a>
                                {% else %}
                                <a class="nav-link block" href="{% url 'crush_lu:edit_profile' %}">
                                    {% include "shared/icons/pencil.html" with class="w-4 h-4 inline mr-2" %}
                                    {% trans "Edit Profile" %}
                                </a>
                                {% endif %}
                            {% endif %}
                            <a class="nav-link block" href="{% url 'crush_lu:account_settings' %}">
                                {% include "shared/icons/cog.html" with class="w-4 h-4 inline mr-2" %}
                                {% trans "Account Settings" %}
                            </a>
                            <div class="border-t border-white/20 my-2"></div>
                            <a class="nav-link block text-red-200" href="{% url 'crush_lu:logout' %}">
                                {% include "shared/icons/arrow-right-on-rectangle.html" with class="w-4 h-4 inline mr-2" %}
                                {% trans "Logout" %}
                            </a>
                        {% else %}
                            {# DATING USER MOBILE NAVIGATION - varies by profile status #}

                            {% if profile_is_approved %}
                                {# APPROVED USER: Full mobile navigation #}
                                <a class="nav-link block" href="{% url 'crush_lu:dashboard' %}">
                                    {% include "shared/icons/home.html" with class="w-4 h-4 inline mr-2" %}
                                    {% trans "Dashboard" %}
                                </a>
                                {% if has_special_journey %}
                                <a class="nav-link block special-journey" href="{% url 'crush_lu:journey_map' %}">
                                    {% include "shared/icons/star.html" with class="w-4 h-4 inline mr-2 text-yellow-400" %}
                                    {% trans "Special Journey" %}
                                    {% if not journey_started %}
                                        <span class="badge badge-warning ml-1">{% trans "New!" %}</span>
                                    {% endif %}
                                </a>
                                {% endif %}
                                <a class="nav-link block" href="{% url 'crush_lu:event_list' %}">
                                    {% include "shared/icons/calendar.html" with class="w-4 h-4 inline mr-2" %}
                                    {% trans "Events" %}
                                    {% if upcoming_events_count > 0 %}
                                        <span class="badge badge-info ml-1">{{ upcoming_events_count }}</span>
                                    {% endif %}
                                </a>
                                <a class="nav-link block" href="{% url 'crush_lu:my_connections' %}">
                                    {% include "shared/icons/users.html" with class="w-4 h-4 inline mr-2" %}
                                    {% trans "Connections" %}
                                    {% if pending_requests_count > 0 %}
                                        <span class="badge badge-danger ml-1">{{ pending_requests_count }}</span>
                                    {% endif %}
                                </a>
                                <div class="border-t border-white/20 my-2"></div>
                                <a class="nav-link block" href="{% url 'crush_lu:edit_profile' %}">
                                    {% include "shared/icons/pencil.html" with class="w-4 h-4 inline mr-2" %}
                                    {% trans "Edit Profile" %}
                                </a>

                            {% elif profile_status == 'pending' %}
                                {# PENDING REVIEW: Status + browse events #}
                                <a class="nav-link block" href="{% url 'crush_lu:dashboard' %}">
                                    {% include "shared/icons/clock.html" with class="w-4 h-4 inline mr-2" %}
                                    {% trans "Under Review" %}
                                    <span class="badge badge-info ml-1">⏳</span>
                                </a>
                                {% if assigned_coach_name %}
                                <span class="block text-white/60 text-sm px-4 py-1">
                                    {{ assigned_coach_name }} {% trans "is reviewing your profile" %}
                                </span>
                                {% endif %}
                                {% if has_special_journey %}
                                <a class="nav-link block special-journey" href="{% url 'crush_lu:journey_map' %}">
                                    {% include "shared/icons/star.html" with class="w-4 h-4 inline mr-2 text-yellow-400" %}
                                    {% trans "Special Journey" %}
                                </a>
                                {% endif %}
                                <a class="nav-link block" href="{% url 'crush_lu:event_list' %}">
                                    {% include "shared/icons/calendar.html" with class="w-4 h-4 inline mr-2" %}
                                    {% trans "Browse Events" %}
                                </a>
                                <div class="border-t border-white/20 my-2"></div>
                                <a class="nav-link block" href="{% url 'crush_lu:edit_profile' %}">
                                    {% include "shared/icons/pencil.html" with class="w-4 h-4 inline mr-2" %}
                                    {% trans "Edit Profile" %}
                                </a>

                            {% elif profile_status == 'revision' %}
                                {# REVISION NEEDED: Fix profile + locked features #}
                                <a class="nav-link block text-orange-300" href="{% url 'crush_lu:edit_profile' %}">
                                    {% include "shared/icons/exclamation-circle.html" with class="w-4 h-4 inline mr-2" %}
                                    {% trans "Fix Profile" %}
                                    <span class="badge badge-warning ml-1">!</span>
                                </a>
                                {% if has_special_journey %}
                                <a class="nav-link block special-journey" href="{% url 'crush_lu:journey_map' %}">
                                    {% include "shared/icons/star.html" with class="w-4 h-4 inline mr-2 text-yellow-400" %}
                                    {% trans "Special Journey" %}
                                </a>
                                {% endif %}
                                <a class="nav-link block" href="{% url 'crush_lu:event_list' %}">
                                    {% include "shared/icons/calendar.html" with class="w-4 h-4 inline mr-2" %}
                                    {% trans "Browse Events" %}
                                </a>
                                <span class="block text-white/40 px-4 py-2">
                                    {% include "shared/icons/lock-closed.html" with class="w-4 h-4 inline mr-2" %}
                                    {% trans "Connections" %} <span class="text-xs">({% trans "after events" %})</span>
                                </span>

                            {% else %}
                                {# PROFILE INCOMPLETE: Progress info + locked features #}
                                <div class="px-4 py-3 bg-white/10 rounded-lg mb-2">
                                    <div class="flex justify-between text-sm mb-2">
                                        <span class="text-white/80">{% trans "Profile Progress" %}</span>
                                        <span class="text-white font-medium">{{ profile_completion_step }}/4</span>
                                    </div>
                                    <div class="w-full bg-white/20 rounded-full h-2">
                                        <div class="bg-gradient-to-r from-crush-purple to-crush-pink h-2 rounded-full"
                                             style="width: {% widthratio profile_completion_step 4 100 %}%"></div>
                                    </div>
                                    <p class="text-white/60 text-xs mt-2">{% trans "Next:" %} {{ profile_step_label }}</p>
                                </div>
                                <a class="nav-link block bg-crush-pink/20 rounded-lg" href="{% url 'crush_lu:create_profile' %}">
                                    {% include "shared/icons/arrow-right.html" with class="w-4 h-4 inline mr-2" %}
                                    {% trans "Continue Setup" %}
                                </a>
                                {% if has_special_journey %}
                                <a class="nav-link block special-journey" href="{% url 'crush_lu:journey_map' %}">
                                    {% include "shared/icons/star.html" with class="w-4 h-4 inline mr-2 text-yellow-400" %}
                                    {% trans "Special Journey" %}
                                    {% if not journey_started %}
                                        <span class="badge badge-warning ml-1">{% trans "New!" %}</span>
                                    {% endif %}
                                </a>
                                {% endif %}
                                <a class="nav-link block" href="{% url 'crush_lu:event_list' %}">
                                    {% include "shared/icons/calendar.html" with class="w-4 h-4 inline mr-2" %}
                                    {% trans "Browse Events" %}
                                </a>
                                <span class="block text-white/40 px-4 py-2">
                                    {% include "shared/icons/lock-closed.html" with class="w-4 h-4 inline mr-2" %}
                                    {% trans "Connections" %} <span class="text-xs">({% trans "after events" %})</span>
                                </span>
                            {% endif %}

                            {# Common items for all authenticated dating users #}
                            <a class="nav-link block" href="{% url 'crush_lu:account_settings' %}">
                                {% include "shared/icons/cog.html" with class="w-4 h-4 inline mr-2" %}
                                {% trans "Account Settings" %}
                            </a>
                            <div class="border-t border-white/20 my-2"></div>
                            <a class="nav-link block text-red-200" href="{% url 'crush_lu:logout' %}">
                                {% include "shared/icons/arrow-right-on-rectangle.html" with class="w-4 h-4 inline mr-2" %}
                                {% trans "Logout" %}
                            </a>
                        {% endif %}
                    {% else %}
                        {# GUEST MOBILE NAVIGATION #}
                        <a class="nav-link block" href="{% url 'crush_lu:about' %}">{% trans "About" %}</a>
                        <a class="nav-link block" href="{% url 'crush_lu:how_it_works' %}">{% trans "How It Works" %}</a>
                        <a class="nav-link block" href="{% url 'crush_lu:event_list' %}">{% trans "Events" %}</a>
                        <a class="nav-link block" href="{% url 'crush_lu:membership' %}">{% trans "Membership" %}</a>
                        <div class="border-t border-white/20 my-2"></div>
                        <a class="block bg-white text-gray-800 px-4 py-2 rounded-full font-semibold text-center hover:bg-gray-100 transition-colors shadow-sm" href="{% url 'crush_lu:login' %}">
                            {% trans "Login / Join" %}
                        </a>
                    {% endif %}

                    {# Mobile Theme Toggle (always visible) #}
                    <div class="border-t border-white/20 my-2"></div>
                    <div x-data="themeToggle" class="px-4 py-2">
                        <button
                            @click="toggleTheme"
                            x-bind:class="toggleButtonClass"
                            class="w-full p-3 rounded-lg transition-all duration-300 flex items-center gap-3 border-0 focus:outline-none focus:ring-2 focus:ring-white/50"
                            x-bind:aria-label="ariaLabel"
                            type="button">
                            <!-- Sun icon -->
                            <svg x-bind:class="sunIconClass" class="w-5 h-5 transition-opacity duration-300" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                                <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"/>
                            </svg>
                            <!-- Moon icon -->
                            <svg x-bind:class="moonIconClass" class="w-5 h-5 transition-opacity duration-300" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                                <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"/>
                            </svg>
                            <!-- Status text (always shown on mobile) -->
                            <span class="text-sm font-medium flex-1 text-left" x-text="statusText"></span>
                        </button>
                    </div>

                    {# Mobile Language Switcher (always visible) #}
                    {% include "crush_lu/partials/language_switcher.html" with mobile=True %}
                </div>
            </div>
        </div>
    </nav>

    <!-- PWA Install Banner (hidden by default, shown by JavaScript) -->
    {% include "crush_lu/partials/pwa_install_banner.html" %}

    <!-- Push Notification Activation Prompt (for PWA users, hidden by default) -->
    {% if user.is_authenticated %}
        {% include "crush_lu/partials/_push_activation_prompt.html" %}
    {% endif %}

    <!-- Global Profile Status Banners -->
    {% if user.is_authenticated and profile_completion_status and profile_completion_status != 'submitted' and profile_completion_status != 'completed' and not profile_is_approved %}
    <!-- Profile Incomplete Banner -->
    <div class="bg-amber-500 text-white px-4 py-3 text-center" role="alert">
        <div class="flex items-center justify-center gap-2 flex-wrap">
            {% include "shared/icons/exclamation-triangle.html" with class="w-5 h-5" %}
            <span class="font-medium">{% trans "Your profile is incomplete" %}</span>
            <a href="{% url 'crush_lu:create_profile' %}"
               class="underline font-semibold hover:no-underline">
                {% trans "Complete your profile" %} →
            </a>
        </div>
    </div>
    {% elif user.is_authenticated and profile_status in 'pending,under_review' and not profile_is_approved %}
    <!-- Pending Review Banner -->
    <div class="bg-purple-600 text-white px-4 py-3 text-center" role="alert">
        <div class="flex items-center justify-center gap-2 flex-wrap">
            {% include "shared/icons/clock.html" with class="w-5 h-5" %}
            <span class="font-medium">{% trans "Your profile is under review by our Crush Coach" %}</span>
            <a href="{% url 'crush_lu:profile_submitted' %}"
               class="underline font-semibold hover:no-underline">
                {% trans "Check status" %} →
            </a>
        </div>
    </div>
    {% endif %}

    <!-- Messages (Alpine.js dismissible) -->
    {% if messages %}
        <div class="container mt-4" role="status" aria-live="polite">
            {% for message in messages %}
                <div x-data="dismissible"
                     x-show="show"
                     x-transition:enter="transition ease-out duration-300"
                     x-transition:enter-start="opacity-0 -translate-y-2"
                     x-transition:enter-end="opacity-100 translate-y-0"
                     x-transition:leave="transition ease-in duration-200"
                     x-transition:leave-start="opacity-100 translate-y-0"
                     x-transition:leave-end="opacity-0 -translate-y-2"
                     class="{% if 'success' in message.tags %}bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-700 text-green-800 dark:text-green-200{% elif 'error' in message.tags or 'danger' in message.tags %}bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 text-red-700 dark:text-red-200{% elif 'warning' in message.tags %}bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700 text-yellow-800 dark:text-yellow-200{% else %}bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 text-blue-800 dark:text-blue-200{% endif %} px-4 py-3 rounded-lg mb-4 relative"
                     role="alert">
                    <div class="flex items-center">
                        {% if 'success' in message.tags %}
                            {% include "shared/icons/check-circle.html" with class="w-5 h-5 mr-3 flex-shrink-0" %}
                        {% elif 'error' in message.tags or 'danger' in message.tags %}
                            {% include "shared/icons/exclamation-triangle.html" with class="w-5 h-5 mr-3 flex-shrink-0" %}
                        {% elif 'warning' in message.tags %}
                            {% include "shared/icons/exclamation-triangle.html" with class="w-5 h-5 mr-3 flex-shrink-0" %}
                        {% else %}
                            {% include "shared/icons/exclamation-circle.html" with class="w-5 h-5 mr-3 flex-shrink-0" %}
                        {% endif %}
                        <span class="flex-1">{{ message }}</span>
                    </div>
                    <button @click="dismiss"
                            type="button"
                            class="absolute top-3 right-3 p-1 rounded-full opacity-60 hover:opacity-100 transition-opacity cursor-pointer"
                            aria-label="Dismiss this message">
                        {% include "shared/icons/x-mark.html" with class="w-4 h-4" aria_hidden="true" %}
                    </button>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <!-- Main Content -->
    <main id="main-content" class="container pt-8" role="main">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer (Tailwind Grid) -->
    <footer class="bg-crush-dark text-white py-12">
        <div class="container">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                <!-- Brand Column -->
                <div class="lg:col-span-1">
                    <p class="text-xl font-bold mb-4 flex items-center gap-2">{% include "crush_lu/includes/ghost-logo.html" with class="w-7 h-7" %}<span>Crush.lu</span></p>
                    <p class="text-white/70">{% trans "Meet new people. Make real connections." %}</p>
                </div>

                <!-- Quick Links -->
                <div>
                    <p class="font-semibold mb-4 text-white/90">{% trans "Quick Links" %}</p>
                    <ul class="space-y-2">
                        <li><a href="{% url 'crush_lu:about' %}" class="text-white/75 hover:text-white transition-colors">{% trans "About Us" %}</a></li>
                        <li><a href="{% url 'crush_lu:how_it_works' %}" class="text-white/75 hover:text-white transition-colors">{% trans "How It Works" %}</a></li>
                        <li><a href="{% url 'crush_lu:event_list' %}" class="text-white/75 hover:text-white transition-colors">{% trans "Events" %}</a></li>
                        <li><a href="{% url 'crush_lu:membership' %}" class="text-white/75 hover:text-white transition-colors">{% trans "Membership" %}</a></li>
                    </ul>
                </div>

                <!-- Legal -->
                <div>
                    <p class="font-semibold mb-4 text-white/90">{% trans "Legal" %}</p>
                    <ul class="space-y-2">
                        <li><a href="{% url 'crush_lu:privacy_policy' %}" class="text-white/75 hover:text-white transition-colors">{% trans "Privacy Policy" %}</a></li>
                        <li><a href="{% url 'crush_lu:terms_of_service' %}" class="text-white/75 hover:text-white transition-colors">{% trans "Terms of Service" %}</a></li>
                        <li><a href="{% url 'crush_lu:data_deletion' %}" class="text-white/75 hover:text-white transition-colors">{% trans "Data Deletion" %}</a></li>
                    </ul>
                </div>

                <!-- Privacy First -->
                <div>
                    <p class="font-semibold mb-4 text-white/90">{% trans "Privacy First" %}</p>
                    <p class="text-white/75">{% trans "Your privacy matters. All profiles are reviewed by our Crush Coaches." %}</p>
                    {% if whatsapp_enabled and whatsapp_number %}
                    <p class="text-white/75 mt-4">
                        <a href="https://wa.me/{{ whatsapp_number }}" target="_blank" rel="noopener noreferrer"
                           class="inline-flex items-center gap-1.5 text-white/75 hover:text-white transition-colors">
                            <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                            WhatsApp
                        </a>
                        <span class="mx-1.5 text-white/40">&middot;</span>
                        <a href="mailto:love@crush.lu" class="text-white/75 hover:text-white transition-colors">love@crush.lu</a>
                    </p>
                    {% endif %}
                    {% if social_links %}
                    <div class="flex items-center gap-3 mt-4">
                        {% for link in social_links %}
                        <a href="{{ link.url }}" target="_blank" rel="noopener noreferrer"
                           class="text-white/60 hover:text-white transition-colors" aria-label="{{ link.name }}">
                            {% if link.icon_id == "instagram" %}
                            <svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/></svg>
                            {% elif link.icon_id == "facebook" %}
                            <svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                            {% elif link.icon_id == "linkedin" %}
                            <svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                            {% elif link.icon_id == "google" %}
                            <svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M12.48 10.92v3.28h7.84c-.24 1.84-.853 3.187-1.787 4.133-1.147 1.147-2.933 2.4-6.053 2.4-4.827 0-8.6-3.893-8.6-8.72s3.773-8.72 8.6-8.72c2.6 0 4.507 1.027 5.907 2.347l2.307-2.307C18.747 1.44 16.133 0 12.48 0 5.867 0 .307 5.387.307 12s5.56 12 12.173 12c3.573 0 6.267-1.173 8.373-3.36 2.16-2.16 2.84-5.213 2.84-7.667 0-.76-.053-1.467-.173-2.053H12.48z"/></svg>
                            {% elif link.icon_id == "reddit" %}
                            <svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M12 0A12 12 0 000 12a12 12 0 0012 12 12 12 0 0012-12A12 12 0 0012 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 01-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 01.042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 014.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 01.14-.197.35.35 0 01.238-.042l2.906.617a1.214 1.214 0 011.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 00-.231.094.33.33 0 000 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 00.029-.463.33.33 0 00-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 00-.232-.095z"/></svg>
                            {% endif %}
                        </a>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Copyright -->
            <div class="border-t border-white/20 mt-8 pt-8 text-center">
                <small class="text-white/75">{% trans "&copy; 2026 Crush.lu - Made with 💕 in Luxembourg" %}</small>
            </div>
        </div>
    </footer>

    {% include "crush_lu/partials/_whatsapp_button.html" %}

    <!-- Toast Notification Container -->
    {% include "crush_lu/shared/toast.html" %}

    <!-- JavaScript i18n catalog (must load before components that use gettext()) -->
    <script src="{% url 'javascript-catalog' %}"></script>

    <!-- HTMX (HTML-driven interactivity) - deferred for non-blocking load -->
    <script defer src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.4/dist/htmx.min.js"
            integrity="sha384-HGfztofotfshcF7+8n44JQL2oJmowVChPTg48S+jvZoztPfvwD79OC/LTtG6dMp+"
            crossorigin="anonymous"></script>

    <!-- Toast Notification Component (loads before alpine-components.js) -->
    {% if debug %}
        {% now "U" as ts %}
        <script defer src="{% static 'crush_lu/js/toast-component.js' %}?v={{ ts }}"></script>
    {% else %}
        <script defer src="{% static 'crush_lu/js/toast-component.js' %}"></script>
    {% endif %}

    <!-- Alpine.js CSP Components (defer maintains order - runs BEFORE Alpine.js) -->
    {% if debug %}
        {% now "U" as ts %}
        <script defer src="{% static 'crush_lu/js/alpine-components.js' %}?v={{ ts }}"></script>
    {% else %}
        <script defer src="{% static 'crush_lu/js/alpine-components.js' %}"></script>
    {% endif %}
    <!-- Alpine.js CSP Build (CSP-compliant, no unsafe-eval required) -->
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/csp@3.13.3/dist/cdn.min.js"
            integrity="sha384-EkI5VI1qflXkHKn4NX4W76cYYqh8dAx7UKkCc4QJ10k8jdtauy8Qs3BkF21ZXcZj"
            crossorigin="anonymous"></script>

    <!-- Sortable.js for drag-and-drop with touch support -->
    <script defer src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"
            integrity="sha384-BSxuMLxX+FCbTdYec3TbXlnMGEEM2QXTFdtDaveen71o+jswm2J36+xFqp8k4VHM"
            crossorigin="anonymous"></script>

    <!-- Crush.lu Utilities (CSRF, sanitization, logging) -->
    <script defer src="{% static 'crush_lu/js/utils.js' %}"></script>

    <!-- PWA Mode Detector (must load early) -->
    <script defer src="{% static 'crush_lu/js/pwa-detector.js' %}"></script>

    <!-- Page Loading Indicator -->
    <script defer src="{% static 'crush_lu/js/page-loading.js' %}"></script>

    <!-- Push Notifications (PWA) -->
    <script defer src="{% static 'crush_lu/js/push-notifications.js' %}"></script>

    <!-- PWA Install Prompt -->
    <script defer src="{% static 'crush_lu/js/pwa-install.js' %}"></script>

    <!-- PWA Update Handler -->
    <script defer src="{% static 'crush_lu/js/pwa-update.js' %}"></script>

    <!-- PWA Service Worker Registration -->
    {% if debug %}
    <!-- DEBUG mode: Unregister any existing SW to prevent caching issues -->
    <script defer src="{% static 'crush_lu/js/sw-unregister.js' %}"></script>
    {% else %}
    <script defer src="{% static 'crush_lu/js/sw-register.js' %}"></script>
    {% endif %}

    <!-- Facebook JS SDK for social login (loaded on login/signup pages via extra_js block) -->
    {% block social_js %}{% endblock %}

    {% block extra_js %}{% endblock %}

    {% include "includes/cookie_banner.html" %}
</body>
</html>
