{% load static %}
{% load i18n %}
{% load analytics %}
{% load seo_tags %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE|default:'en' }}">
<head>
    {% analytics_head %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Crush.lu - Meet New People{% endblock %}</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{% static 'crush_lu/crush_favicon.ico' %}">

    <!-- Performance: Resource Hints -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    <link rel="preload" href="{% static 'crush_lu/css/tailwind.css' %}" as="style">

    <!-- SEO: Canonical URL (self-referencing - each language version is its own canonical) -->
    <link rel="canonical" href="{% block canonical_url %}{% canonical_url %}{% endblock %}">

    <!-- SEO: Hreflang tags for multi-language support (en, de, fr) -->
    {% block hreflang_tags %}
    {% hreflang_tags %}
    {% endblock %}

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="{% block og_type %}website{% endblock %}">
    <meta property="og:url" content="https://crush.lu{{ request.path }}">
    <meta property="og:title" content="{% block og_title %}Crush.lu - Meet New People in Luxembourg{% endblock %}">
    <meta property="og:description" content="{% block og_description %}Privacy-first dating platform for Luxembourg. Meet real people at organized events - no endless swiping, just authentic connections.{% endblock %}">
    <meta property="og:image" content="{% block og_image %}{{ social_preview_image_url }}{% endblock %}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:locale" content="{{ LANGUAGE_CODE|default:'en' }}_{{ LANGUAGE_CODE|default:'EN'|upper }}">
    <meta property="og:site_name" content="Crush.lu">
    <meta property="fb:app_id" content="1170910678282435">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://crush.lu{{ request.path }}">
    <meta property="twitter:title" content="{% block twitter_title %}Crush.lu - Meet New People in Luxembourg{% endblock %}">
    <meta property="twitter:description" content="{% block twitter_description %}Privacy-first dating platform for Luxembourg. Meet real people at organized events - no endless swiping, just authentic connections.{% endblock %}">
    <meta property="twitter:image" content="{% block twitter_image %}{{ social_preview_image_url }}{% endblock %}">

    <!-- Additional SEO -->
    <meta name="description" content="{% block meta_description %}Privacy-first dating platform for Luxembourg. Coach-curated profiles and event-based meetups for authentic connections.{% endblock %}">
    <meta name="keywords" content="{% block meta_keywords %}dating luxembourg, meetups luxembourg, singles events, crush.lu, dating events, speed dating luxembourg, singles events luxembourg{% endblock %}">
    <meta name="robots" content="{% block meta_robots %}index, follow{% endblock %}">
    <meta name="author" content="Crush.lu">
    <meta name="geo.region" content="LU">
    <meta name="geo.placename" content="Luxembourg">

    <!-- Schema.org Organization Structured Data (JSON-LD) -->
    {% block structured_data %}
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "Crush.lu",
        "alternateName": "Crush Luxembourg",
        "url": "https://crush.lu",
        "logo": "https://crush.lu{% static 'shared/icons/android-launchericon-512-512.png' %}",
        "description": "Privacy-first dating platform for Luxembourg. Meet real people at organized events - no endless swiping, just authentic connections.",
        "foundingDate": "2025",
        "areaServed": {
            "@type": "Country",
            "name": "Luxembourg"
        },
        "sameAs": [],
        "contactPoint": {
            "@type": "ContactPoint",
            "contactType": "customer service",
            "email": "love@crush.lu",
            "availableLanguage": ["English", "German", "French"]
        }
    }
    </script>
    {% endblock %}

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#9B59B6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Crush.lu">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="manifest" href="{% url 'pwa_manifest' %}">

    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'shared/icons/ios/180.png' %}">
    <link rel="apple-touch-icon" sizes="167x167" href="{% static 'shared/icons/ios/167.png' %}">
    <link rel="apple-touch-icon" sizes="152x152" href="{% static 'shared/icons/ios/152.png' %}">
    <link rel="apple-touch-icon" sizes="144x144" href="{% static 'shared/icons/ios/144.png' %}">
    <link rel="apple-touch-icon" sizes="120x120" href="{% static 'shared/icons/ios/120.png' %}">
    <link rel="apple-touch-icon" sizes="114x114" href="{% static 'shared/icons/ios/114.png' %}">
    <link rel="apple-touch-icon" sizes="76x76" href="{% static 'shared/icons/ios/76.png' %}">
    <link rel="apple-touch-icon" sizes="72x72" href="{% static 'shared/icons/ios/72.png' %}">
    <link rel="apple-touch-icon" sizes="60x60" href="{% static 'shared/icons/ios/60.png' %}">
    <link rel="apple-touch-icon" sizes="57x57" href="{% static 'shared/icons/ios/57.png' %}">
    <link rel="apple-touch-icon" href="{% static 'shared/icons/ios/180.png' %}">

    <!-- Critical CSS - Inlined for fastest FCP/LCP (above-the-fold styles) -->
    <style>
        /* Critical CSS for Crush.lu - prevents FOUC and enables fast first paint */
        :root{--crush-pink:#FF6B9D;--crush-purple:#9B59B6;--crush-dark:#2C3E50;--crush-light:#F8F9FA}
        [x-cloak]{display:none!important}
        *,::before,::after{box-sizing:border-box}
        body{margin:0;font-family:Inter,system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#F8F9FA;color:#2C3E50;-webkit-font-smoothing:antialiased}
        .container{max-width:1200px;margin:0 auto;padding:0 1rem}
        .crush-navbar{background:linear-gradient(135deg,#9B59B6,#FF6B9D);box-shadow:0 2px 10px rgba(0,0,0,.08)}
        .navbar-brand{color:#fff;font-weight:700;font-size:1.5rem;text-decoration:none}
        .nav-link{display:inline-flex;align-items:center;gap:.375rem;color:rgba(255,255,255,.9);padding:.5rem .75rem;text-decoration:none;font-weight:500}
        #page-loading-overlay{position:fixed;inset:0;background:linear-gradient(135deg,#9B59B6 0%,#FF6B9D 100%);display:none;align-items:center;justify-content:center;z-index:9999}
        #page-loading-overlay.show{display:flex}
        .loading-content{text-align:center;color:#fff}
        .loading-spinner{width:50px;height:50px;border:3px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:#fff;animation:spin 1s linear infinite;margin:0 auto 1rem}
        @keyframes spin{to{transform:rotate(360deg)}}
        .loading-heart{font-size:2rem;animation:pulse 1.5s ease-in-out infinite}
        @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
        .hidden{display:none}
        .lg\:hidden{display:none}
        @media(max-width:1023px){.lg\:hidden{display:block}.hidden.lg\:flex{display:none}}
        .flex{display:flex}.items-center{align-items:center}.justify-between{justify-content:space-between}
        .py-3{padding-top:.75rem;padding-bottom:.75rem}
        .text-white{color:#fff}
        /* Hero section critical styles for LCP optimization */
        .hero-section{background:linear-gradient(135deg,#9B59B6 0%,#FF6B9D 100%);color:#fff;padding:5rem 1rem;margin:-1rem -1rem 0;position:relative;overflow:hidden;border-radius:0 0 50px 50px}
        .hero-content{position:relative;z-index:1;max-width:1200px;margin:0 auto}
        .hero-title{font-size:clamp(2.5rem,6vw,4.5rem);font-weight:800;margin-bottom:1.5rem;line-height:1.2}
        .hero-subtitle{font-size:clamp(1.1rem,2.5vw,1.5rem);opacity:.95;margin-bottom:2.5rem;max-width:700px}
        .hero-emoji{font-size:clamp(8rem,20vw,15rem);display:inline-block}
        .hero-cta{display:flex;gap:1rem;flex-wrap:wrap;justify-content:center;align-items:center}
        .btn-hero-primary{background:#fff;color:#9B59B6;font-weight:600;padding:1rem 2.5rem;border-radius:50px;border:none;font-size:1.1rem;box-shadow:0 8px 20px rgba(0,0,0,.2);text-decoration:none;display:inline-block}
        .btn-hero-secondary{background:rgba(255,255,255,.2);color:#fff;font-weight:600;padding:1rem 2.5rem;border-radius:50px;border:2px solid #fff;font-size:1.1rem;text-decoration:none;display:inline-block}
        @media(max-width:767px){.hero-section{padding:3rem 1rem}.hero-cta{flex-direction:column}.hero-cta .btn-hero-primary,.hero-cta .btn-hero-secondary{width:100%;max-width:300px;text-align:center}}
    </style>

    <!-- Tailwind CSS (all styles bundled) -->
    <link rel="stylesheet" href="{% static 'crush_lu/css/tailwind.css' %}">

    <!-- HTMX Configuration -->
    <meta name="htmx-config" content='{"defaultSwapStyle":"innerHTML","globalViewTransitions":true}'>

    {% block extra_css %}{% endblock %}
</head>
<body hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'>
    {% analytics_body %}
    <!-- Skip to main content link for keyboard/screen reader users -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:bg-white focus:text-crush-purple focus:px-4 focus:py-2 focus:rounded-lg focus:shadow-lg focus:font-semibold">
        Skip to main content
    </a>
    <!-- Loading Overlay -->
    <div id="page-loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-heart">üíï</div>
            <div class="loading-text">Loading...</div>
            <div class="loading-subtext">Just a moment</div>
        </div>
    </div>

    <!-- Navigation (Alpine.js powered) -->
    <nav class="crush-navbar" x-data="navbar">
        <div class="container">
            <div class="flex justify-between items-center py-3">
                <!-- Brand -->
                {% if user.is_authenticated %}
                    <a class="navbar-brand" href="{% url 'crush_lu:dashboard' %}">üíï Crush.lu</a>
                {% else %}
                    <a class="navbar-brand" href="{% url 'crush_lu:home' %}">üíï Crush.lu</a>
                {% endif %}

                <!-- Mobile menu button -->
                <button type="button"
                        @click="toggleMobile"
                        class="lg:hidden text-white p-2 rounded-lg hover:bg-white/10 transition-colors"
                        aria-label="Toggle navigation menu"
                        x-bind:aria-expanded="mobileMenuAriaExpanded"
                        aria-controls="mobile-nav-menu">
                    <!-- Hamburger icon -->
                    <svg x-show="mobileMenuClosed" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                    </svg>
                    <!-- Close icon -->
                    <svg x-show="mobileMenuOpen" x-cloak class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>

                <!-- Desktop Navigation -->
                <nav class="hidden lg:flex items-center space-x-1" role="navigation" aria-label="Main navigation">
                    {% if user.is_authenticated %}
                        {# Check if user is a coach #}
                        {% if user.crushcoach and user.crushcoach.is_active %}
                            {# COACH NAVIGATION #}
                            <a class="nav-link" href="{% url 'crush_lu:coach_dashboard' %}">
                                {% include "shared/icons/chart-bar.html" with class="w-4 h-4" %}
                                <span>Coach Dashboard</span>
                                {% if pending_screening_count > 0 %}
                                    <span class="badge badge-warning">{{ pending_screening_count }}</span>
                                {% endif %}
                            </a>
                            {% if has_special_journey %}
                            <a class="nav-link special-journey" href="{% url 'crush_lu:journey_map' %}">
                                {% include "shared/icons/star.html" with class="w-4 h-4 text-yellow-400" %}
                                <span>Special Journey</span>
                                {% if not journey_started %}
                                    <span class="badge badge-warning">New!</span>
                                {% endif %}
                            </a>
                            {% endif %}
                            <a class="nav-link" href="{% url 'crush_lu:coach_sessions' %}">
                                {% include "shared/icons/calendar.html" with class="w-4 h-4" %}
                                <span>My Sessions</span>
                            </a>
                            <a class="nav-link" href="{% url 'crush_lu:event_list' %}">
                                {% include "shared/icons/calendar.html" with class="w-4 h-4" %}
                                <span>Events</span>
                            </a>
                            <a class="nav-link" href="{% url 'crush_lu:dashboard' %}?user_view=1">
                                {% include "shared/icons/home.html" with class="w-4 h-4" %}
                                <span>My Profile</span>
                            </a>

                            <!-- Coach Tools Dropdown -->
                            <div class="dropdown" @click.away="closeCoachTools">
                                <button type="button" @click="toggleCoachTools" class="nav-link" aria-haspopup="true" x-bind:aria-expanded="coachToolsAriaExpanded">
                                    {% include "shared/icons/cog.html" with class="w-4 h-4" %}
                                    <span>Coach Tools</span>
                                    {% include "shared/icons/chevron-down.html" with class="w-3 h-3" %}
                                </button>
                                <div x-show="coachToolsOpen"
                                     x-transition:enter="transition ease-out duration-100"
                                     x-transition:enter-start="opacity-0 scale-95"
                                     x-transition:enter-end="opacity-100 scale-100"
                                     x-transition:leave="transition ease-in duration-75"
                                     x-transition:leave-start="opacity-100 scale-100"
                                     x-transition:leave-end="opacity-0 scale-95"
                                     x-cloak
                                     class="dropdown-menu show">
                                    <a class="dropdown-item" href="{% url 'crush_lu:coach_dashboard' %}">
                                        {% include "shared/icons/clipboard.html" with class="w-4 h-4 inline mr-2" %}
                                        Review Queue
                                        {% if pending_screening_count > 0 %}
                                            <span class="badge badge-warning ml-2">{{ pending_screening_count }}</span>
                                        {% endif %}
                                    </a>
                                    <a class="dropdown-item" href="{% url 'crush_lu:coach_journey_dashboard' %}">
                                        {% include "shared/icons/map-pin.html" with class="w-4 h-4 inline mr-2" %}
                                        Journey Management
                                    </a>
                                    <div class="dropdown-divider"></div>
                                    <a class="dropdown-item" href="{% url 'crush_lu:coach_sessions' %}">
                                        {% include "shared/icons/chat-bubble-left-right.html" with class="w-4 h-4 inline mr-2" %}
                                        All Sessions
                                    </a>
                                    <a class="dropdown-item" href="{% url 'crush_lu:event_list' %}">
                                        {% include "shared/icons/calendar.html" with class="w-4 h-4 inline mr-2" %}
                                        Manage Events
                                    </a>
                                </div>
                            </div>

                            <!-- Coach Profile Dropdown -->
                            <div class="dropdown" @click.away="closeCoachProfile">
                                <button type="button" @click="toggleCoachProfile" class="nav-link" aria-haspopup="true" x-bind:aria-expanded="coachProfileAriaExpanded">
                                    {% include "shared/icons/user-circle.html" with class="w-4 h-4" %}
                                    <span>{{ user.first_name|default:user.username }}</span>
                                    {% include "shared/icons/chevron-down.html" with class="w-3 h-3" %}
                                </button>
                                <div x-show="coachProfileOpen"
                                     x-transition:enter="transition ease-out duration-100"
                                     x-transition:enter-start="opacity-0 scale-95"
                                     x-transition:enter-end="opacity-100 scale-100"
                                     x-transition:leave="transition ease-in duration-75"
                                     x-transition:leave-start="opacity-100 scale-100"
                                     x-transition:leave-end="opacity-0 scale-95"
                                     x-cloak
                                     class="dropdown-menu show">
                                    <a class="dropdown-item" href="{% url 'crush_lu:dashboard' %}?user_view=1">
                                        {% include "shared/icons/home.html" with class="w-4 h-4 inline mr-2" %}
                                        My Dashboard
                                    </a>
                                    {% if user.crushprofile %}
                                        {% if profile_is_approved %}
                                        <a class="dropdown-item" href="{% url 'crush_lu:edit_profile' %}">
                                            {% include "shared/icons/pencil.html" with class="w-4 h-4 inline mr-2" %}
                                            Edit Profile
                                        </a>
                                        {% elif profile_completion_status in 'not_started,step1,step2,step3,completed' %}
                                        <a class="dropdown-item" href="{% url 'crush_lu:create_profile' %}">
                                            {% include "shared/icons/arrow-path.html" with class="w-4 h-4 inline mr-2" %}
                                            Finish Profile
                                        </a>
                                        {% else %}
                                        <a class="dropdown-item" href="{% url 'crush_lu:edit_profile' %}">
                                            {% include "shared/icons/pencil.html" with class="w-4 h-4 inline mr-2" %}
                                            Edit Profile
                                        </a>
                                        {% endif %}
                                    {% endif %}
                                    <a class="dropdown-item" href="{% url 'crush_lu:account_settings' %}">
                                        {% include "shared/icons/cog.html" with class="w-4 h-4 inline mr-2" %}
                                        Account Settings
                                    </a>
                                    <div class="dropdown-divider"></div>
                                    <a class="dropdown-item text-red-600 hover:bg-red-50" href="{% url 'crush_lu:logout' %}">
                                        {% include "shared/icons/arrow-right-on-rectangle.html" with class="w-4 h-4 inline mr-2" %}
                                        Logout
                                    </a>
                                </div>
                            </div>
                        {% else %}
                            {# DATING USER NAVIGATION #}
                            <a class="nav-link" href="{% url 'crush_lu:dashboard' %}">
                                {% include "shared/icons/home.html" with class="w-4 h-4" %}
                                <span>Dashboard</span>
                                {% if profile_needs_action %}
                                    <span class="badge badge-warning" title="Profile needs revision">!</span>
                                {% endif %}
                            </a>
                            {% if has_special_journey %}
                            <a class="nav-link special-journey" href="{% url 'crush_lu:journey_map' %}">
                                {% include "shared/icons/star.html" with class="w-4 h-4 text-yellow-400" %}
                                <span>Special Journey</span>
                                {% if not journey_started %}
                                    <span class="badge badge-warning">New!</span>
                                {% endif %}
                            </a>
                            {% endif %}

                            <!-- Events Dropdown -->
                            <div class="dropdown" @click.away="closeEvents">
                                <button type="button" @click="toggleEvents" class="nav-link" aria-haspopup="true" x-bind:aria-expanded="eventsAriaExpanded">
                                    {% include "shared/icons/calendar.html" with class="w-4 h-4" %}
                                    <span>Events</span>
                                    {% if upcoming_events_count > 0 %}
                                        <span class="badge badge-info">{{ upcoming_events_count }}</span>
                                    {% endif %}
                                    {% include "shared/icons/chevron-down.html" with class="w-3 h-3" %}
                                </button>
                                <div x-show="eventsOpen"
                                     x-transition:enter="transition ease-out duration-100"
                                     x-transition:enter-start="opacity-0 scale-95"
                                     x-transition:enter-end="opacity-100 scale-100"
                                     x-transition:leave="transition ease-in duration-75"
                                     x-transition:leave-start="opacity-100 scale-100"
                                     x-transition:leave-end="opacity-0 scale-95"
                                     x-cloak
                                     class="dropdown-menu show">
                                    <div class="px-4 py-2 text-xs font-semibold text-gray-500 uppercase">Upcoming Events</div>
                                    {% if upcoming_events %}
                                        {% for registration in upcoming_events %}
                                            <a class="dropdown-item" href="{% url 'crush_lu:event_detail' registration.event.id %}">
                                                <div class="flex justify-between items-start">
                                                    <div>
                                                        <strong>{{ registration.event.title|truncatewords:4 }}</strong>
                                                        <br>
                                                        <small class="text-gray-500">
                                                            {{ registration.event.date_time|date:"M d, g:i A" }}
                                                        </small>
                                                    </div>
                                                    {% if registration.status == 'waitlist' %}
                                                        <span class="badge badge-secondary ml-2">Waitlist</span>
                                                    {% else %}
                                                        <span class="badge badge-success ml-2">‚úì</span>
                                                    {% endif %}
                                                </div>
                                            </a>
                                        {% endfor %}
                                        <div class="dropdown-divider"></div>
                                    {% else %}
                                        <span class="block px-4 py-2 text-gray-500">No upcoming events</span>
                                        <div class="dropdown-divider"></div>
                                    {% endif %}
                                    <a class="dropdown-item" href="{% url 'crush_lu:event_list' %}">
                                        {% include "shared/icons/magnifying-glass.html" with class="w-4 h-4 inline mr-2" %}
                                        Browse All Events
                                    </a>
                                </div>
                            </div>

                            <a class="nav-link" href="{% url 'crush_lu:my_connections' %}">
                                {% include "shared/icons/users.html" with class="w-4 h-4" %}
                                <span>Connections</span>
                                {% if pending_requests_count > 0 %}
                                    <span class="badge badge-danger">{{ pending_requests_count }}</span>
                                {% endif %}
                            </a>

                            <!-- User Profile Dropdown -->
                            <div class="dropdown" @click.away="closeUserMenu">
                                <button type="button" @click="toggleUserMenu" class="nav-link" aria-haspopup="true" x-bind:aria-expanded="userMenuAriaExpanded">
                                    {% include "shared/icons/user-circle.html" with class="w-4 h-4" %}
                                    <span>{{ user.first_name|default:user.username }}</span>
                                    {% if profile_status == 'pending' %}
                                        <span class="badge badge-info" title="Profile pending review">‚è≥</span>
                                    {% elif profile_status == 'rejected' %}
                                        <span class="badge badge-danger" title="Profile rejected">‚úó</span>
                                    {% elif profile_status == 'revision' %}
                                        <span class="badge badge-warning" title="Profile needs revision">!</span>
                                    {% elif profile_is_approved %}
                                        <span class="badge badge-success" title="Profile approved">‚úì</span>
                                    {% endif %}
                                    {% include "shared/icons/chevron-down.html" with class="w-3 h-3" %}
                                </button>
                                <div x-show="userMenuOpen"
                                     x-transition:enter="transition ease-out duration-100"
                                     x-transition:enter-start="opacity-0 scale-95"
                                     x-transition:enter-end="opacity-100 scale-100"
                                     x-transition:leave="transition ease-in duration-75"
                                     x-transition:leave-start="opacity-100 scale-100"
                                     x-transition:leave-end="opacity-0 scale-95"
                                     x-cloak
                                     class="dropdown-menu show">
                                    {% if user.crushprofile %}
                                        <div class="px-4 py-2 text-xs font-semibold text-gray-500">
                                            Profile Status:
                                            {% if profile_status == 'pending' %}
                                                <span class="text-blue-500">Pending Review</span>
                                            {% elif profile_status == 'rejected' %}
                                                <span class="text-red-500">Rejected</span>
                                            {% elif profile_status == 'revision' %}
                                                <span class="text-yellow-600">Needs Revision</span>
                                            {% elif profile_is_approved %}
                                                <span class="text-green-500">Approved ‚úì</span>
                                            {% else %}
                                                <span class="text-gray-500">Not Submitted</span>
                                            {% endif %}
                                        </div>
                                        <div class="dropdown-divider"></div>
                                        {% if profile_is_approved %}
                                        <a class="dropdown-item" href="{% url 'crush_lu:edit_profile' %}">
                                            {% include "shared/icons/pencil.html" with class="w-4 h-4 inline mr-2" %}
                                            Edit Profile
                                        </a>
                                        {% elif profile_completion_status in 'not_started,step1,step2,step3,completed' %}
                                        <a class="dropdown-item" href="{% url 'crush_lu:create_profile' %}">
                                            {% include "shared/icons/arrow-path.html" with class="w-4 h-4 inline mr-2" %}
                                            Finish Profile
                                        </a>
                                        {% else %}
                                        <a class="dropdown-item" href="{% url 'crush_lu:edit_profile' %}">
                                            {% include "shared/icons/pencil.html" with class="w-4 h-4 inline mr-2" %}
                                            Edit Profile
                                        </a>
                                        {% endif %}
                                    {% else %}
                                        <a class="dropdown-item" href="{% url 'crush_lu:create_profile' %}">
                                            {% include "shared/icons/user-plus.html" with class="w-4 h-4 inline mr-2" %}
                                            Create Profile
                                        </a>
                                    {% endif %}
                                    <a class="dropdown-item" href="{% url 'crush_lu:account_settings' %}">
                                        {% include "shared/icons/cog.html" with class="w-4 h-4 inline mr-2" %}
                                        Account Settings
                                    </a>
                                    <div class="dropdown-divider"></div>
                                    <a class="dropdown-item text-red-600 hover:bg-red-50" href="{% url 'crush_lu:logout' %}">
                                        {% include "shared/icons/arrow-right-on-rectangle.html" with class="w-4 h-4 inline mr-2" %}
                                        Logout
                                    </a>
                                </div>
                            </div>
                        {% endif %}
                    {% else %}
                        {# GUEST NAVIGATION #}
                        <a class="nav-link" href="{% url 'crush_lu:about' %}">About</a>
                        <a class="nav-link" href="{% url 'crush_lu:how_it_works' %}">How It Works</a>
                        <a class="nav-link" href="{% url 'crush_lu:event_list' %}">Events</a>
                        <a class="inline-flex items-center bg-white text-gray-800 px-4 py-2 rounded-full font-semibold hover:bg-gray-100 transition-colors shadow-sm" href="{% url 'crush_lu:login' %}">
                            Login / Join
                        </a>
                    {% endif %}

                    {# Language Switcher (always visible) #}
                    {% include "crush_lu/partials/language_switcher.html" %}
                </nav>
            </div>

            <!-- Mobile Navigation Menu -->
            <div id="mobile-nav-menu"
                 x-show="mobileMenuOpen"
                 x-transition:enter="transition ease-out duration-200"
                 x-transition:enter-start="opacity-0 -translate-y-2"
                 x-transition:enter-end="opacity-100 translate-y-0"
                 x-transition:leave="transition ease-in duration-150"
                 x-transition:leave-start="opacity-100 translate-y-0"
                 x-transition:leave-end="opacity-0 -translate-y-2"
                 x-cloak
                 role="navigation"
                 aria-label="Mobile navigation"
                 class="lg:hidden pb-4 border-t border-white/20 mt-2 pt-4">
                <div class="flex flex-col space-y-2">
                    {% if user.is_authenticated %}
                        {% if user.crushcoach and user.crushcoach.is_active %}
                            {# COACH MOBILE NAVIGATION #}
                            <a class="nav-link block" href="{% url 'crush_lu:coach_dashboard' %}">
                                {% include "shared/icons/chart-bar.html" with class="w-4 h-4 inline mr-2" %}
                                Coach Dashboard
                                {% if pending_screening_count > 0 %}
                                    <span class="badge badge-warning ml-1">{{ pending_screening_count }}</span>
                                {% endif %}
                            </a>
                            {% if has_special_journey %}
                            <a class="nav-link block special-journey" href="{% url 'crush_lu:journey_map' %}">
                                {% include "shared/icons/star.html" with class="w-4 h-4 inline mr-2 text-yellow-400" %}
                                Special Journey
                            </a>
                            {% endif %}
                            <a class="nav-link block" href="{% url 'crush_lu:coach_sessions' %}">
                                {% include "shared/icons/calendar.html" with class="w-4 h-4 inline mr-2" %}
                                My Sessions
                            </a>
                            <a class="nav-link block" href="{% url 'crush_lu:event_list' %}">
                                {% include "shared/icons/calendar.html" with class="w-4 h-4 inline mr-2" %}
                                Events
                            </a>
                            <a class="nav-link block" href="{% url 'crush_lu:dashboard' %}?user_view=1">
                                {% include "shared/icons/home.html" with class="w-4 h-4 inline mr-2" %}
                                My Profile
                            </a>
                            <div class="border-t border-white/20 my-2"></div>
                            <a class="nav-link block" href="{% url 'crush_lu:coach_journey_dashboard' %}">
                                {% include "shared/icons/map-pin.html" with class="w-4 h-4 inline mr-2" %}
                                Journey Management
                            </a>
                            {% if user.crushprofile %}
                                {% if profile_is_approved %}
                                <a class="nav-link block" href="{% url 'crush_lu:edit_profile' %}">
                                    {% include "shared/icons/pencil.html" with class="w-4 h-4 inline mr-2" %}
                                    Edit Profile
                                </a>
                                {% elif profile_completion_status in 'not_started,step1,step2,step3,completed' %}
                                <a class="nav-link block" href="{% url 'crush_lu:create_profile' %}">
                                    {% include "shared/icons/arrow-path.html" with class="w-4 h-4 inline mr-2" %}
                                    Finish Profile
                                </a>
                                {% else %}
                                <a class="nav-link block" href="{% url 'crush_lu:edit_profile' %}">
                                    {% include "shared/icons/pencil.html" with class="w-4 h-4 inline mr-2" %}
                                    Edit Profile
                                </a>
                                {% endif %}
                            {% endif %}
                            <a class="nav-link block" href="{% url 'crush_lu:account_settings' %}">
                                {% include "shared/icons/cog.html" with class="w-4 h-4 inline mr-2" %}
                                Account Settings
                            </a>
                            <div class="border-t border-white/20 my-2"></div>
                            <a class="nav-link block text-red-200" href="{% url 'crush_lu:logout' %}">
                                {% include "shared/icons/arrow-right-on-rectangle.html" with class="w-4 h-4 inline mr-2" %}
                                Logout
                            </a>
                        {% else %}
                            {# DATING USER MOBILE NAVIGATION #}
                            <a class="nav-link block" href="{% url 'crush_lu:dashboard' %}">
                                {% include "shared/icons/home.html" with class="w-4 h-4 inline mr-2" %}
                                Dashboard
                                {% if profile_needs_action %}
                                    <span class="badge badge-warning ml-1">!</span>
                                {% endif %}
                            </a>
                            {% if has_special_journey %}
                            <a class="nav-link block special-journey" href="{% url 'crush_lu:journey_map' %}">
                                {% include "shared/icons/star.html" with class="w-4 h-4 inline mr-2 text-yellow-400" %}
                                Special Journey
                            </a>
                            {% endif %}
                            <a class="nav-link block" href="{% url 'crush_lu:event_list' %}">
                                {% include "shared/icons/calendar.html" with class="w-4 h-4 inline mr-2" %}
                                Events
                                {% if upcoming_events_count > 0 %}
                                    <span class="badge badge-info ml-1">{{ upcoming_events_count }}</span>
                                {% endif %}
                            </a>
                            <a class="nav-link block" href="{% url 'crush_lu:my_connections' %}">
                                {% include "shared/icons/users.html" with class="w-4 h-4 inline mr-2" %}
                                Connections
                                {% if pending_requests_count > 0 %}
                                    <span class="badge badge-danger ml-1">{{ pending_requests_count }}</span>
                                {% endif %}
                            </a>
                            <div class="border-t border-white/20 my-2"></div>
                            {% if user.crushprofile %}
                                {% if profile_is_approved %}
                                <a class="nav-link block" href="{% url 'crush_lu:edit_profile' %}">
                                    {% include "shared/icons/pencil.html" with class="w-4 h-4 inline mr-2" %}
                                    Edit Profile
                                </a>
                                {% elif profile_completion_status in 'not_started,step1,step2,step3,completed' %}
                                <a class="nav-link block" href="{% url 'crush_lu:create_profile' %}">
                                    {% include "shared/icons/arrow-path.html" with class="w-4 h-4 inline mr-2" %}
                                    Finish Profile
                                </a>
                                {% else %}
                                <a class="nav-link block" href="{% url 'crush_lu:edit_profile' %}">
                                    {% include "shared/icons/pencil.html" with class="w-4 h-4 inline mr-2" %}
                                    Edit Profile
                                </a>
                                {% endif %}
                            {% else %}
                            <a class="nav-link block" href="{% url 'crush_lu:create_profile' %}">
                                {% include "shared/icons/user-plus.html" with class="w-4 h-4 inline mr-2" %}
                                Create Profile
                            </a>
                            {% endif %}
                            <a class="nav-link block" href="{% url 'crush_lu:account_settings' %}">
                                {% include "shared/icons/cog.html" with class="w-4 h-4 inline mr-2" %}
                                Account Settings
                            </a>
                            <div class="border-t border-white/20 my-2"></div>
                            <a class="nav-link block text-red-200" href="{% url 'crush_lu:logout' %}">
                                {% include "shared/icons/arrow-right-on-rectangle.html" with class="w-4 h-4 inline mr-2" %}
                                Logout
                            </a>
                        {% endif %}
                    {% else %}
                        {# GUEST MOBILE NAVIGATION #}
                        <a class="nav-link block" href="{% url 'crush_lu:about' %}">About</a>
                        <a class="nav-link block" href="{% url 'crush_lu:how_it_works' %}">How It Works</a>
                        <a class="nav-link block" href="{% url 'crush_lu:event_list' %}">Events</a>
                        <div class="border-t border-white/20 my-2"></div>
                        <a class="block bg-white text-gray-800 px-4 py-2 rounded-full font-semibold text-center hover:bg-gray-100 transition-colors shadow-sm" href="{% url 'crush_lu:login' %}">
                            Login / Join
                        </a>
                    {% endif %}

                    {# Mobile Language Switcher (always visible) #}
                    <div class="border-t border-white/20 my-2"></div>
                    {% include "crush_lu/partials/language_switcher.html" with mobile=True %}
                </div>
            </div>
        </div>
    </nav>

    <!-- Global Profile Status Banners -->
    {% if user.is_authenticated and profile_completion_status and profile_completion_status != 'submitted' %}
    <!-- Profile Incomplete Banner -->
    <div class="bg-amber-500 text-white px-4 py-3 text-center" role="alert">
        <div class="flex items-center justify-center gap-2 flex-wrap">
            {% include "shared/icons/exclamation-triangle.html" with class="w-5 h-5" %}
            <span class="font-medium">{% trans "Your profile is incomplete" %}</span>
            <a href="{% url 'crush_lu:create_profile' %}"
               class="underline font-semibold hover:no-underline">
                {% trans "Complete your profile" %} ‚Üí
            </a>
        </div>
    </div>
    {% elif user.is_authenticated and profile_status in 'pending,under_review' and not profile_is_approved %}
    <!-- Pending Review Banner -->
    <div class="bg-purple-600 text-white px-4 py-3 text-center" role="alert">
        <div class="flex items-center justify-center gap-2 flex-wrap">
            {% include "shared/icons/clock.html" with class="w-5 h-5" %}
            <span class="font-medium">{% trans "Your profile is under review by our Crush Coach" %}</span>
            <a href="{% url 'crush_lu:profile_submitted' %}"
               class="underline font-semibold hover:no-underline">
                {% trans "Check status" %} ‚Üí
            </a>
        </div>
    </div>
    {% endif %}

    <!-- Messages (Alpine.js dismissible) -->
    {% if messages %}
        <div class="container mt-4" role="status" aria-live="polite">
            {% for message in messages %}
                <div x-data="dismissible"
                     x-show="show"
                     x-transition:enter="transition ease-out duration-300"
                     x-transition:enter-start="opacity-0 -translate-y-2"
                     x-transition:enter-end="opacity-100 translate-y-0"
                     x-transition:leave="transition ease-in duration-200"
                     x-transition:leave-start="opacity-100 translate-y-0"
                     x-transition:leave-end="opacity-0 -translate-y-2"
                     class="{% if 'success' in message.tags %}bg-green-50 border border-green-200 text-green-800{% elif 'error' in message.tags or 'danger' in message.tags %}bg-red-50 border border-red-200 text-red-700{% elif 'warning' in message.tags %}bg-yellow-50 border border-yellow-200 text-yellow-800{% else %}bg-blue-50 border border-blue-200 text-blue-800{% endif %} px-4 py-3 rounded-lg mb-4 relative"
                     role="alert">
                    <div class="flex items-center">
                        {% if 'success' in message.tags %}
                            {% include "shared/icons/check-circle.html" with class="w-5 h-5 mr-3 flex-shrink-0" %}
                        {% elif 'error' in message.tags or 'danger' in message.tags %}
                            {% include "shared/icons/exclamation-triangle.html" with class="w-5 h-5 mr-3 flex-shrink-0" %}
                        {% elif 'warning' in message.tags %}
                            {% include "shared/icons/exclamation-triangle.html" with class="w-5 h-5 mr-3 flex-shrink-0" %}
                        {% else %}
                            {% include "shared/icons/exclamation-circle.html" with class="w-5 h-5 mr-3 flex-shrink-0" %}
                        {% endif %}
                        <span class="flex-1">{{ message }}</span>
                    </div>
                    <button @click="dismiss"
                            type="button"
                            class="btn-close absolute top-4 right-4"
                            aria-label="Dismiss this message">
                        {% include "shared/icons/x-mark.html" with class="w-5 h-5" aria_hidden="true" %}
                    </button>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <!-- Main Content -->
    <main id="main-content" class="container my-4" role="main">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer (Tailwind Grid) -->
    <footer class="bg-crush-dark text-white py-12 mt-auto">
        <div class="container">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                <!-- Brand Column -->
                <div class="lg:col-span-1">
                    <p class="text-xl font-bold mb-4">üíï Crush.lu</p>
                    <p class="text-white/70">{% trans "Meet new people. Make real connections." %}</p>
                </div>

                <!-- Quick Links -->
                <div>
                    <p class="font-semibold mb-4 text-white/90">{% trans "Quick Links" %}</p>
                    <ul class="space-y-2">
                        <li><a href="{% url 'crush_lu:about' %}" class="text-white/75 hover:text-white transition-colors">{% trans "About Us" %}</a></li>
                        <li><a href="{% url 'crush_lu:how_it_works' %}" class="text-white/75 hover:text-white transition-colors">{% trans "How It Works" %}</a></li>
                        <li><a href="{% url 'crush_lu:event_list' %}" class="text-white/75 hover:text-white transition-colors">{% trans "Events" %}</a></li>
                    </ul>
                </div>

                <!-- Legal -->
                <div>
                    <p class="font-semibold mb-4 text-white/90">{% trans "Legal" %}</p>
                    <ul class="space-y-2">
                        <li><a href="{% url 'crush_lu:privacy_policy' %}" class="text-white/75 hover:text-white transition-colors">{% trans "Privacy Policy" %}</a></li>
                        <li><a href="{% url 'crush_lu:terms_of_service' %}" class="text-white/75 hover:text-white transition-colors">{% trans "Terms of Service" %}</a></li>
                        <li><a href="{% url 'crush_lu:data_deletion' %}" class="text-white/75 hover:text-white transition-colors">{% trans "Data Deletion" %}</a></li>
                    </ul>
                </div>

                <!-- Privacy First -->
                <div>
                    <p class="font-semibold mb-4 text-white/90">{% trans "Privacy First" %}</p>
                    <p class="text-white/75">{% trans "Your privacy matters. All profiles are reviewed by our Crush Coaches." %}</p>
                </div>
            </div>

            <!-- Copyright -->
            <div class="border-t border-white/20 mt-8 pt-8 text-center">
                <small class="text-white/75">{% trans "&copy; 2025 Crush.lu - Made with üíï in Luxembourg" %}</small>
            </div>
        </div>
    </footer>

    <!-- HTMX (HTML-driven interactivity) - deferred for non-blocking load -->
    <script defer src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.4/dist/htmx.min.js"
            integrity="sha384-HGfztofotfshcF7+8n44JQL2oJmowVChPTg48S+jvZoztPfvwD79OC/LTtG6dMp+"
            crossorigin="anonymous"></script>

    <!-- Alpine.js CSP Components (SYNC load - must run BEFORE Alpine.js initializes) -->
    <script src="{% static 'crush_lu/js/alpine-components.js' %}"></script>

    <!-- Alpine.js CSP Build (CSP-compliant, no unsafe-eval required) -->
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/csp@3.13.3/dist/cdn.min.js"
            integrity="sha384-EkI5VI1qflXkHKn4NX4W76cYYqh8dAx7UKkCc4QJ10k8jdtauy8Qs3BkF21ZXcZj"
            crossorigin="anonymous"></script>

    <!-- Sortable.js for drag-and-drop with touch support -->
    <script defer src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"
            integrity="sha384-BSxuMLxX+FCbTdYec3TbXlnMGEEM2QXTFdtDaveen71o+jswm2J36+xFqp8k4VHM"
            crossorigin="anonymous"></script>

    <!-- Crush.lu Utilities (CSRF, sanitization, logging) -->
    <script defer src="{% static 'crush_lu/js/utils.js' %}"></script>

    <!-- PWA Mode Detector (must load early) -->
    <script defer src="{% static 'crush_lu/js/pwa-detector.js' %}"></script>

    <!-- Page Loading Indicator -->
    <script defer src="{% static 'crush_lu/js/page-loading.js' %}"></script>

    <!-- Push Notifications (PWA) -->
    <script defer src="{% static 'crush_lu/js/push-notifications.js' %}"></script>

    <!-- PWA Install Prompt -->
    <script defer src="{% static 'crush_lu/js/pwa-install.js' %}"></script>

    <!-- PWA Update Handler -->
    <script defer src="{% static 'crush_lu/js/pwa-update.js' %}"></script>

    <!-- PWA Service Worker Registration (externalized for performance) -->
    <script defer src="{% static 'crush_lu/js/sw-register.js' %}"></script>

    <!-- Facebook JS SDK for social login (loaded on login/signup pages via extra_js block) -->
    {% block social_js %}{% endblock %}

    {% block extra_js %}{% endblock %}

    {% include "includes/cookie_banner.html" %}
</body>
</html>
