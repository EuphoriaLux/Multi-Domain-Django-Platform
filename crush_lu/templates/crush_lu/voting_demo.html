{% extends 'crush_lu/base.html' %}
{% load static %}

{% block title %}Voting System Demo - Crush.lu{% endblock %}

{% block extra_css %}
{# Styles moved to static/crush_lu/css/pages/voting.css #}
{% endblock %}

{% block content %}
<div class="tour-overlay" id="tourOverlay"></div>
<div class="tour-tooltip" id="tourTooltip">
    <h3 id="tourTitle"></h3>
    <p id="tourText"></p>
    <div class="tour-tooltip-buttons">
        <button class="px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors" id="tourPrev">‚Üê Previous</button>
        <button class="btn-crush-primary px-4 py-2" id="tourNext">Next ‚Üí</button>
    </div>
</div>

<div class="container py-5">
    <div class="flex justify-center">
        <div class="w-full max-w-5xl px-4">
            <div class="text-center mb-5">
                <h1 class="display-4">üéØ Voting System Demo</h1>
                <p class="lead text-muted">Learn how event voting works at Crush.lu</p>
                <button class="btn-crush-primary px-6 py-3 text-lg" id="startTour">
                    Start Guided Tour
                </button>
            </div>

            <!-- Step 1: Event Timing -->
            <div class="demo-section" id="step-timing">
                <h2 class="mb-4">‚è∞ Step 1: Voting Timeline</h2>
                <div class="countdown-demo">
                    <h3 class="mb-3">Event Day Timeline</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                        <div>
                            <div class="text-4xl">üéâ</div>
                            <strong>Event Starts</strong>
                            <p class="mb-0 text-sm">e.g., 7:00 PM</p>
                        </div>
                        <div>
                            <div class="text-4xl">üó≥Ô∏è</div>
                            <strong>Voting Opens</strong>
                            <p class="mb-0 text-sm">15 min later (7:15 PM)</p>
                        </div>
                        <div>
                            <div class="text-4xl">üèÜ</div>
                            <strong>Voting Closes</strong>
                            <p class="mb-0 text-sm">30 min to vote (7:45 PM)</p>
                        </div>
                    </div>
                    <div class="alert alert-light mt-3 mb-0">
                        <strong>Countdown Timer:</strong> You'll see a live countdown on your phone showing exactly how much time remains to vote!
                    </div>
                </div>
            </div>

            <!-- Step 2: Activity Options -->
            <div class="demo-section" id="step-options">
                <h2 class="mb-4">üé≠ Step 2: Choose Your Activity</h2>
                <p class="text-muted mb-4">You'll vote on ONE activity from these options. The winning activity determines how the evening unfolds!</p>

                <form id="demoVoteForm">
                    <!-- Speed Dating -->
                    <div class="activity-group-card" id="group-speed-dating">
                        <h3 class="text-primary mb-3">üíï Speed Dating</h3>
                        <p class="text-muted mb-3">Quick 3-5 minute conversations in organized formats</p>

                        <div class="variant-option-item">
                            <input class="form-check-input variant-radio" type="radio" name="demo_vote" id="demo-random" value="random">
                            <label class="form-check-label w-100" for="demo-random">
                                <strong>Random Order</strong>: Classic speed dating with random pairing. Perfect for meeting diverse people!
                            </label>
                        </div>

                        <div class="variant-option-item">
                            <input class="form-check-input variant-radio" type="radio" name="demo_vote" id="demo-alphabetic" value="alphabetic">
                            <label class="form-check-label w-100" for="demo-alphabetic">
                                <strong>Alphabetic Order</strong>: Organized by first name. Creates natural conversation starters!
                            </label>
                        </div>

                        <div class="variant-option-item">
                            <input class="form-check-input variant-radio" type="radio" name="demo_vote" id="demo-hair" value="hair">
                            <label class="form-check-label w-100" for="demo-hair">
                                <strong>By Hair Color</strong>: A playful twist that creates fun icebreakers!
                            </label>
                        </div>
                    </div>

                    <!-- Presentations -->
                    <div class="activity-group-card" id="group-presentations">
                        <h3 class="text-primary mb-3">üé§ 90 Second Presentations</h3>
                        <p class="text-muted mb-3">Everyone introduces themselves in creative ways</p>

                        <div class="variant-option-item">
                            <input class="form-check-input variant-radio" type="radio" name="demo_vote" id="demo-music" value="music">
                            <label class="form-check-label w-100" for="demo-music">
                                <strong>With Favorite Music</strong>: Introduce yourself while your song plays!
                            </label>
                        </div>

                        <div class="variant-option-item">
                            <input class="form-check-input variant-radio" type="radio" name="demo_vote" id="demo-questions" value="questions">
                            <label class="form-check-label w-100" for="demo-questions">
                                <strong>5 Predefined Questions</strong>: Fun questions everyone answers!
                            </label>
                        </div>

                        <div class="variant-option-item">
                            <input class="form-check-input variant-radio" type="radio" name="demo_vote" id="demo-picture" value="picture">
                            <label class="form-check-label w-100" for="demo-picture">
                                <strong>Share Picture & Story</strong>: Show a favorite photo and tell its story!
                            </label>
                        </div>
                    </div>

                    <!-- Mystery -->
                    <div class="activity-group-card" id="group-mystery">
                        <h3 class="text-primary mb-3">üé≠ Mystery Event</h3>
                        <p class="text-muted mb-3">Trust the coaches with a surprise activity!</p>

                        <div class="variant-option-item">
                            <input class="form-check-input variant-radio" type="radio" name="demo_vote" id="demo-mystery" value="mystery">
                            <label class="form-check-label w-100" for="demo-mystery">
                                We've prepared a surprise designed to help you connect in unexpected ways. Adventure awaits!
                            </label>
                        </div>
                    </div>

                    <div class="text-center">
                        <button type="button" class="btn-crush-primary px-8 py-3 text-lg disabled:opacity-50 disabled:cursor-not-allowed" id="demoSubmitBtn" disabled>
                            Submit My Vote
                        </button>
                    </div>
                </form>
            </div>

            <!-- Step 3: Results -->
            <div class="demo-section" id="step-results">
                <h2 class="mb-4">üìä Step 3: See Results & Winner</h2>
                <p class="text-muted mb-4">After voting closes, you'll see live results with vote counts and percentages!</p>

                <div class="results-preview">
                    <div class="text-center mb-3">
                        <h3>üèÜ Winner: Speed Dating - Random Order</h3>
                        <p class="text-muted mb-0">The activity with the most votes wins!</p>
                    </div>
                </div>

                <div class="mb-3">
                    <strong>Speed Dating - Random Order</strong>
                    <div class="progress-bar-demo">
                        <div class="progress-fill" style="width: 45%;">15 votes (45%)</div>
                    </div>
                </div>

                <div class="mb-3">
                    <strong>Presentations - With Music</strong>
                    <div class="progress-bar-demo">
                        <div class="progress-fill" style="width: 30%;">10 votes (30%)</div>
                    </div>
                </div>

                <div class="mb-3">
                    <strong>Mystery Event</strong>
                    <div class="progress-bar-demo">
                        <div class="progress-fill" style="width: 25%;">8 votes (25%)</div>
                    </div>
                </div>

                <div class="alert alert-success mt-4">
                    <strong>What happens next?</strong> The winning activity starts! In this example, you'd begin speed dating in random order with 3-5 minute conversations.
                </div>
            </div>

            <!-- Step 4: Post-Event -->
            <div class="demo-section" id="step-connections">
                <h2 class="mb-4">üíï Step 4: Make Connections</h2>
                <p class="text-muted mb-4">After the event, you can request connections with people you clicked with!</p>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h5>‚úì You Can:</h5>
                        <ul class="list-disc list-inside space-y-1">
                            <li>View all event attendees</li>
                            <li>Send connection requests</li>
                            <li>Get coach-facilitated introductions</li>
                            <li>Exchange contact info with mutual matches</li>
                        </ul>
                    </div>
                    <div>
                        <h5>üîí Privacy Protected:</h5>
                        <ul class="list-disc list-inside space-y-1">
                            <li>Only attendees can see each other</li>
                            <li>Coach reviews all connections</li>
                            <li>Both people must consent</li>
                            <li>No info shared without permission</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="text-center mt-5 flex flex-wrap gap-3 justify-center">
                <button class="px-6 py-3 text-lg border border-purple-500 text-purple-600 hover:bg-purple-50 rounded-lg transition-colors" id="restartTour">
                    üîÑ Replay Tour
                </button>
                <a href="{% url 'crush_lu:event_list' %}" class="btn-crush-primary px-6 py-3 text-lg">
                    Browse Events ‚Üí
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script nonce="{{ request.csp_nonce }}">
class VotingTour {
    constructor() {
        this.currentStep = 0;
        this.steps = [
            {
                title: "Welcome to Event Voting! üéâ",
                text: "At Crush.lu events, YOU decide the activity! This tour shows how voting works on event day.",
                target: null,
                highlight: null
            },
            {
                title: "The Timeline ‚è∞",
                text: "Voting opens 15 minutes after the event starts and lasts 30 minutes. You'll see a live countdown timer on your phone showing exactly how much time remains!",
                target: "step-timing",
                highlight: "step-timing"
            },
            {
                title: "Choose Your Activity üé≠",
                text: "You'll see 3 main activity types, each with different variants. Select ONE option from all the choices - the one with the most votes wins!",
                target: "step-options",
                highlight: "step-options"
            },
            {
                title: "Speed Dating Options üíï",
                text: "If you prefer quick conversations, choose one of the Speed Dating variants. Each offers a different way to organize the rounds!",
                target: "group-speed-dating",
                highlight: "group-speed-dating"
            },
            {
                title: "Presentation Options üé§",
                text: "Prefer something creative? Choose a presentation style where everyone gets 90 seconds to introduce themselves in unique ways!",
                target: "group-presentations",
                highlight: "group-presentations"
            },
            {
                title: "Mystery Event üé≠",
                text: "Feeling adventurous? Trust our coaches with a surprise activity designed to create unexpected connections!",
                target: "group-mystery",
                highlight: "group-mystery"
            },
            {
                title: "Submit Your Vote ‚úì",
                text: "Try selecting an option now! Once you pick one, the submit button activates. You can change your vote anytime before voting closes.",
                target: "demoVoteForm",
                highlight: "demoSubmitBtn"
            },
            {
                title: "Live Results üìä",
                text: "After voting closes, see how everyone voted! The winning activity is announced and you can see the vote breakdown with percentages.",
                target: "step-results",
                highlight: "step-results"
            },
            {
                title: "Make Connections After üíï",
                text: "When the event ends, you can connect with people you clicked with. Our coaches help facilitate introductions while protecting everyone's privacy!",
                target: "step-connections",
                highlight: "step-connections"
            },
            {
                title: "You're Ready! üéâ",
                text: "That's how voting works! On event day, simply open the voting link on your phone when it's time. Questions? Ask a coach at the event!",
                target: null,
                highlight: null
            }
        ];

        this.init();
    }

    init() {
        document.getElementById('startTour').addEventListener('click', () => this.start());
        document.getElementById('restartTour').addEventListener('click', () => this.start());
        document.getElementById('tourNext').addEventListener('click', () => this.next());
        document.getElementById('tourPrev').addEventListener('click', () => this.prev());
        document.getElementById('tourOverlay').addEventListener('click', () => this.end());

        // Enable submit button when radio is selected
        document.querySelectorAll('input[name="demo_vote"]').forEach(radio => {
            radio.addEventListener('change', () => {
                document.getElementById('demoSubmitBtn').disabled = false;
            });
        });

        // Demo submit
        document.getElementById('demoSubmitBtn').addEventListener('click', () => {
            alert('‚úì Vote submitted! In the real event, you\'d now see the results page.');
        });
    }

    start() {
        this.currentStep = 0;
        this.show();
    }

    show() {
        const step = this.steps[this.currentStep];
        const tooltip = document.getElementById('tourTooltip');
        const overlay = document.getElementById('tourOverlay');

        // Update text
        document.getElementById('tourTitle').textContent = step.title;
        document.getElementById('tourText').textContent = step.text;

        // Update buttons
        document.getElementById('tourPrev').style.display = this.currentStep === 0 ? 'none' : 'block';
        document.getElementById('tourNext').textContent = this.currentStep === this.steps.length - 1 ? 'Finish' : 'Next ‚Üí';

        // Remove previous highlights
        document.querySelectorAll('.tour-highlight').forEach(el => {
            el.classList.remove('tour-highlight');
        });
        document.querySelectorAll('.demo-section.active').forEach(el => {
            el.classList.remove('active');
        });

        // Show overlay and tooltip
        overlay.classList.add('active');
        tooltip.classList.add('active');

        // Position tooltip and highlight
        if (step.target) {
            const target = document.getElementById(step.target);
            const rect = target.getBoundingClientRect();

            tooltip.style.top = (rect.top + window.scrollY - 250) + 'px';
            tooltip.style.left = Math.max(20, (rect.left + rect.width / 2 - 200)) + 'px';

            // Scroll into view
            target.scrollIntoView({ behavior: 'smooth', block: 'center' });
            target.classList.add('active');
        } else {
            // Center tooltip
            tooltip.style.top = '50%';
            tooltip.style.left = '50%';
            tooltip.style.transform = 'translate(-50%, -50%)';
        }

        if (step.highlight) {
            const highlight = document.getElementById(step.highlight);
            if (highlight) {
                setTimeout(() => {
                    highlight.classList.add('tour-highlight');
                }, 300);
            }
        }
    }

    next() {
        if (this.currentStep < this.steps.length - 1) {
            this.currentStep++;
            this.show();
        } else {
            this.end();
        }
    }

    prev() {
        if (this.currentStep > 0) {
            this.currentStep--;
            this.show();
        }
    }

    end() {
        document.getElementById('tourOverlay').classList.remove('active');
        document.getElementById('tourTooltip').classList.remove('active');
        document.querySelectorAll('.tour-highlight').forEach(el => {
            el.classList.remove('tour-highlight');
        });
        document.querySelectorAll('.demo-section.active').forEach(el => {
            el.classList.remove('active');
        });
    }
}

// Initialize tour when page loads
document.addEventListener('DOMContentLoaded', () => {
    new VotingTour();
});
</script>
{% endblock %}
