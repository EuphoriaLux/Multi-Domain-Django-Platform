{% extends 'crush_lu/base.html' %}
{% load static i18n %}

{% block title %}{% trans "How Event Voting Works - Crush.lu" %}{% endblock %}

{% block content %}
<div class="tour-overlay" id="tourOverlay"></div>
<div class="tour-tooltip" id="tourTooltip">
    <h3 id="tourTitle"></h3>
    <p id="tourText"></p>
    <div class="tour-tooltip-buttons">
        <button class="px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors" id="tourPrev">{% trans "Previous" %}</button>
        <button class="btn-crush-primary px-4 py-2" id="tourNext">{% trans "Next" %}</button>
    </div>
</div>

<div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Hero Section -->
    <div class="text-center mb-12 py-8">
        <div class="inline-block mb-4">
            <span class="text-5xl">üó≥Ô∏è</span>
        </div>
        <h1 class="text-4xl md:text-5xl font-bold mb-4 bg-gradient-to-r from-crush-purple to-crush-pink bg-clip-text text-transparent">
            {% trans "How Event Voting Works" %}
        </h1>
        <p class="text-lg md:text-xl text-gray-600 dark:text-gray-400 max-w-2xl mx-auto leading-relaxed mb-8">
            {% trans "Your voice shapes the evening! Learn how you'll vote on TWO categories to customize your Crush.lu event experience." %}
        </p>
        <button class="btn-crush-primary px-8 py-4 text-lg font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 inline-flex items-center gap-2" id="startTour">
            <span>{% trans "Start Interactive Tour" %}</span>
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
            </svg>
        </button>
    </div>

    <!-- Step 1: Three-Phase Event Overview -->
    <div class="demo-section relative bg-white dark:bg-gray-800 rounded-2xl shadow-lg mb-10 overflow-hidden border border-gray-100 dark:border-gray-700 transition-all duration-300" id="step-overview">
        <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-crush-purple via-purple-500 to-crush-pink"></div>

        <div class="p-6 md:p-8">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-gradient-to-br from-crush-purple to-crush-pink rounded-lg flex items-center justify-center">
                    <span class="text-white text-lg">üéØ</span>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">{% trans "Step 1: Your Event Has 3 Phases" %}</h2>
            </div>

            <p class="text-gray-600 dark:text-gray-400 mb-8 leading-relaxed">
                {% trans "Every Crush.lu event follows this structure. Your votes determine what happens in Phases 2 and 3!" %}
            </p>

            <!-- Three Phase Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="timeline">
                <!-- Phase 1 -->
                <div class="relative bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-950/40 dark:to-blue-900/30 border-2 border-blue-200 dark:border-blue-800 rounded-2xl p-6 text-center hover:shadow-lg transition-all duration-300">
                    <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-blue-500 text-white text-xs font-bold px-3 py-1 rounded-full">
                        {% trans "0-15 min" %}
                    </div>
                    <div class="text-5xl mb-4 mt-2">üéâ</div>
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">{% trans "Phase 1: Icebreaker" %}</h3>
                    <p class="text-gray-600 dark:text-gray-400 text-sm">{% trans "Mingle and get comfortable. Voting opens at the 15-minute mark!" %}</p>
                </div>

                <!-- Phase 2 -->
                <div class="relative bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-950/40 dark:to-purple-900/30 border-2 border-purple-200 dark:border-purple-800 rounded-2xl p-6 text-center hover:shadow-lg transition-all duration-300">
                    <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-crush-purple text-white text-xs font-bold px-3 py-1 rounded-full">
                        {% trans "After voting" %}
                    </div>
                    <div class="text-5xl mb-4 mt-2">üé§</div>
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">{% trans "Phase 2: Presentations" %}</h3>
                    <p class="text-gray-600 dark:text-gray-400 text-sm">{% trans "Everyone gets 90 seconds to introduce themselves. You rate each presenter anonymously (1-5 stars)." %}</p>
                </div>

                <!-- Phase 3 -->
                <div class="relative bg-gradient-to-br from-pink-50 to-pink-100 dark:from-pink-950/40 dark:to-pink-900/30 border-2 border-pink-200 dark:border-pink-800 rounded-2xl p-6 text-center hover:shadow-lg transition-all duration-300">
                    <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-crush-pink text-white text-xs font-bold px-3 py-1 rounded-full">
                        {% trans "Final phase" %}
                    </div>
                    <div class="text-5xl mb-4 mt-2">üíï</div>
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">{% trans "Phase 3: Speed Dating" %}</h3>
                    <p class="text-gray-600 dark:text-gray-400 text-sm">{% trans "3-5 minute conversations. Your ratings help decide who you're paired with! Twist chosen by YOUR votes." %}</p>
                </div>
            </div>

            <!-- Voting Window Info -->
            <div class="mt-8 bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-950/30 dark:to-orange-950/30 border-l-4 border-amber-500 dark:border-amber-600 rounded-lg p-5">
                <div class="flex items-start gap-3">
                    <span class="text-2xl flex-shrink-0">‚è±Ô∏è</span>
                    <div>
                        <strong class="text-gray-900 dark:text-white block mb-1">{% trans "Voting Window: 30 Minutes" %}</strong>
                        <p class="text-gray-700 dark:text-gray-300">{% trans "Voting opens 15 minutes after the event starts. You have 30 minutes to cast your votes. A live countdown shows exactly how much time remains!" %}</p>
                    </div>
                </div>
            </div>

            <!-- Rating & Pairing Info -->
            <div class="mt-4 bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-950/30 dark:to-pink-950/30 border-l-4 border-crush-purple dark:border-purple-600 rounded-lg p-5" id="rating-info">
                <div class="flex items-start gap-3">
                    <span class="text-2xl flex-shrink-0">‚≠ê</span>
                    <div>
                        <strong class="text-gray-900 dark:text-white block mb-1">{% trans "Anonymous Ratings & Smart Pairing" %}</strong>
                        <p class="text-gray-700 dark:text-gray-300 mb-0">{% trans "During presentations, you anonymously rate each person 1-5 stars. These ratings are used to create better speed dating pairings - people who rated each other highly are more likely to be matched! Your individual ratings are always private." %}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Step 2: Two-Category Voting Explanation -->
    <div class="demo-section relative bg-white dark:bg-gray-800 rounded-2xl shadow-lg mb-10 overflow-hidden border border-gray-100 dark:border-gray-700 transition-all duration-300" id="step-categories">
        <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-crush-purple via-purple-500 to-crush-pink"></div>

        <div class="p-6 md:p-8">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-gradient-to-br from-crush-purple to-crush-pink rounded-lg flex items-center justify-center">
                    <span class="text-white text-lg">‚úåÔ∏è</span>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">{% trans "Step 2: You Vote on TWO Categories" %}</h2>
            </div>

            <div class="bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-950/30 dark:to-pink-950/30 border border-purple-200 dark:border-purple-700 rounded-xl p-5 mb-8">
                <p class="text-gray-800 dark:text-gray-200 text-center font-medium">
                    {% trans "Unlike simple polls, you'll vote on TWO separate things. Each category affects a different phase of the event!" %}
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Category A: Presentation Style -->
                <div class="bg-gradient-to-br from-purple-50 to-blue-50 dark:from-purple-950/30 dark:to-blue-950/30 border-2 border-purple-200 dark:border-purple-700 rounded-2xl p-6" id="category-presentation">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-12 h-12 bg-gradient-to-br from-crush-purple to-purple-700 rounded-xl flex items-center justify-center shadow-md">
                            <span class="text-white text-2xl">üé§</span>
                        </div>
                        <div>
                            <span class="text-xs font-bold text-purple-600 dark:text-purple-400 uppercase tracking-wide">{% trans "Category A" %}</span>
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white">{% trans "Presentation Style" %}</h3>
                        </div>
                    </div>
                    <p class="text-gray-700 dark:text-gray-300 mb-4 text-sm">{% trans "How will everyone introduce themselves in Phase 2?" %}</p>

                    <div class="space-y-2">
                        {% for option in presentation_options %}
                        <div class="bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-3 flex items-center gap-3">
                            <span class="w-8 h-8 bg-purple-100 dark:bg-purple-900/50 rounded-full flex items-center justify-center text-purple-600 dark:text-purple-400 font-bold text-sm">{{ forloop.counter }}</span>
                            <div>
                                <strong class="text-gray-900 dark:text-white text-sm">{{ option.display_name }}</strong>
                                {% if option.description %}
                                <p class="text-gray-500 dark:text-gray-400 text-xs">{{ option.description|truncatewords:10 }}</p>
                                {% endif %}
                            </div>
                        </div>
                        {% empty %}
                        <div class="bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-3">
                            <strong class="text-gray-900 dark:text-white text-sm">{% trans "With Favorite Music" %}</strong>
                        </div>
                        <div class="bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-3">
                            <strong class="text-gray-900 dark:text-white text-sm">{% trans "5 Predefined Questions" %}</strong>
                        </div>
                        <div class="bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-3">
                            <strong class="text-gray-900 dark:text-white text-sm">{% trans "Share Picture & Story" %}</strong>
                        </div>
                        {% endfor %}
                    </div>

                    <div class="mt-4 text-center">
                        <span class="inline-flex items-center gap-1.5 text-purple-600 dark:text-purple-400 font-medium text-sm">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                            </svg>
                            {% trans "Most voted = Phase 2 format" %}
                        </span>
                    </div>
                </div>

                <!-- Category B: Speed Dating Twist -->
                <div class="bg-gradient-to-br from-pink-50 to-purple-50 dark:from-pink-950/30 dark:to-purple-950/30 border-2 border-pink-200 dark:border-pink-700 rounded-2xl p-6" id="category-twist">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-12 h-12 bg-gradient-to-br from-crush-pink to-pink-600 rounded-xl flex items-center justify-center shadow-md">
                            <span class="text-white text-2xl">üíï</span>
                        </div>
                        <div>
                            <span class="text-xs font-bold text-pink-600 dark:text-pink-400 uppercase tracking-wide">{% trans "Category B" %}</span>
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white">{% trans "Speed Dating Twist" %}</h3>
                        </div>
                    </div>
                    <p class="text-gray-700 dark:text-gray-300 mb-4 text-sm">{% trans "What fun twist will spice up Phase 3?" %}</p>

                    <div class="space-y-2">
                        {% for option in twist_options %}
                        <div class="bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-3 flex items-center gap-3">
                            <span class="w-8 h-8 bg-pink-100 dark:bg-pink-900/50 rounded-full flex items-center justify-center text-pink-600 dark:text-pink-400 font-bold text-sm">{{ forloop.counter }}</span>
                            <div>
                                <strong class="text-gray-900 dark:text-white text-sm">{{ option.display_name }}</strong>
                                {% if option.description %}
                                <p class="text-gray-500 dark:text-gray-400 text-xs">{{ option.description|truncatewords:10 }}</p>
                                {% endif %}
                            </div>
                        </div>
                        {% empty %}
                        <div class="bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-3">
                            <strong class="text-gray-900 dark:text-white text-sm">{% trans "Spicy Questions First" %}</strong>
                        </div>
                        <div class="bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-3">
                            <strong class="text-gray-900 dark:text-white text-sm">{% trans "Forbidden Word Game" %}</strong>
                        </div>
                        <div class="bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-3">
                            <strong class="text-gray-900 dark:text-white text-sm">{% trans "Algorithm Extended" %}</strong>
                        </div>
                        {% endfor %}
                    </div>

                    <div class="mt-4 text-center">
                        <span class="inline-flex items-center gap-1.5 text-pink-600 dark:text-pink-400 font-medium text-sm">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                            </svg>
                            {% trans "Most voted = Phase 3 twist" %}
                        </span>
                    </div>
                </div>
            </div>

            <!-- Mystery Event Callout -->
            <div class="mt-8 bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-950/30 dark:to-purple-950/30 border-2 border-dashed border-indigo-300 dark:border-indigo-600 rounded-xl p-5" id="mystery-callout">
                <div class="flex items-start gap-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center shadow-md flex-shrink-0">
                        <span class="text-white text-2xl">üé≠</span>
                    </div>
                    <div>
                        <h4 class="font-bold text-gray-900 dark:text-white mb-1">{% trans "Special: Mystery Event" %}</h4>
                        <p class="text-gray-700 dark:text-gray-300 text-sm">
                            {% trans "Some events feature a Mystery option! If chosen, coaches surprise everyone with a unique activity designed to create unexpected connections. Adventure awaits!" %}
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Step 3: Interactive Voting Demo -->
    <div class="demo-section relative bg-white dark:bg-gray-800 rounded-2xl shadow-lg mb-10 overflow-hidden border border-gray-100 dark:border-gray-700 transition-all duration-300" id="step-demo" x-data="votingDemoSuccess">
        <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-crush-purple via-purple-500 to-crush-pink"></div>

        <div class="p-6 md:p-8">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-gradient-to-br from-crush-purple to-crush-pink rounded-lg flex items-center justify-center">
                    <span class="text-white text-lg">üó≥Ô∏è</span>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">{% trans "Step 3: Try Voting Now!" %}</h2>
            </div>

            <!-- Vote Form (hidden after submit) -->
            <div x-show="isNotSubmitted">
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-950/30 dark:to-purple-950/30 border border-blue-200 dark:border-blue-700 rounded-xl p-4 mb-6">
                    <p class="text-gray-800 dark:text-gray-200 text-center font-medium">
                        {% trans "Practice voting below! You must select ONE option from EACH category before you can submit." %}
                    </p>
                </div>

                <form id="demoVoteForm">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- Category A: Presentation Style -->
                        <div id="group-presentations">
                            <div class="flex items-center gap-3 mb-4">
                                <span class="w-8 h-8 bg-crush-purple text-white rounded-full flex items-center justify-center font-bold">A</span>
                                <h3 class="text-lg font-bold text-gray-900 dark:text-white">{% trans "Presentation Style" %}</h3>
                            </div>

                            <div class="space-y-3">
                                {% for option in presentation_options %}
                                <div class="variant-option-item group relative bg-white dark:bg-gray-700 border-2 border-gray-200 dark:border-gray-600 rounded-xl p-4 cursor-pointer hover:border-crush-purple dark:hover:border-purple-500 transition-all duration-300 has-[:checked]:border-crush-purple dark:has-[:checked]:border-purple-500 has-[:checked]:bg-gradient-to-r has-[:checked]:from-purple-50 has-[:checked]:to-pink-50 dark:has-[:checked]:from-purple-950/30 dark:has-[:checked]:to-pink-950/30 has-[:checked]:shadow-md">
                                    <label class="flex items-start gap-4 cursor-pointer" for="demo-pres-{{ option.id }}">
                                        <input class="variant-radio mt-1 w-5 h-5 text-crush-purple focus:ring-crush-purple focus:ring-2 cursor-pointer" type="radio" name="demo_presentation" id="demo-pres-{{ option.id }}" value="{{ option.activity_variant }}">
                                        <div class="flex-1">
                                            <strong class="text-gray-900 dark:text-white block mb-1">{{ option.display_name }}</strong>
                                            <span class="text-gray-600 dark:text-gray-400 text-sm">{{ option.description }}</span>
                                        </div>
                                    </label>
                                </div>
                                {% empty %}
                                <div class="variant-option-item group relative bg-white dark:bg-gray-700 border-2 border-gray-200 dark:border-gray-600 rounded-xl p-4 cursor-pointer hover:border-crush-purple dark:hover:border-purple-500 transition-all duration-300 has-[:checked]:border-crush-purple dark:has-[:checked]:border-purple-500 has-[:checked]:bg-purple-50 dark:has-[:checked]:bg-purple-950/30 has-[:checked]:shadow-md">
                                    <label class="flex items-start gap-4 cursor-pointer" for="demo-pres-music">
                                        <input class="variant-radio mt-1 w-5 h-5 text-crush-purple focus:ring-crush-purple cursor-pointer" type="radio" name="demo_presentation" id="demo-pres-music" value="music">
                                        <div class="flex-1">
                                            <strong class="text-gray-900 dark:text-white block mb-1">{% trans "With Favorite Music" %}</strong>
                                            <span class="text-gray-600 dark:text-gray-400 text-sm">{% trans "Introduce yourself while your song plays!" %}</span>
                                        </div>
                                    </label>
                                </div>
                                <div class="variant-option-item group relative bg-white dark:bg-gray-700 border-2 border-gray-200 dark:border-gray-600 rounded-xl p-4 cursor-pointer hover:border-crush-purple dark:hover:border-purple-500 transition-all duration-300 has-[:checked]:border-crush-purple dark:has-[:checked]:border-purple-500 has-[:checked]:bg-purple-50 dark:has-[:checked]:bg-purple-950/30 has-[:checked]:shadow-md">
                                    <label class="flex items-start gap-4 cursor-pointer" for="demo-pres-questions">
                                        <input class="variant-radio mt-1 w-5 h-5 text-crush-purple focus:ring-crush-purple cursor-pointer" type="radio" name="demo_presentation" id="demo-pres-questions" value="questions">
                                        <div class="flex-1">
                                            <strong class="text-gray-900 dark:text-white block mb-1">{% trans "5 Predefined Questions" %}</strong>
                                            <span class="text-gray-600 dark:text-gray-400 text-sm">{% trans "Fun questions everyone answers!" %}</span>
                                        </div>
                                    </label>
                                </div>
                                <div class="variant-option-item group relative bg-white dark:bg-gray-700 border-2 border-gray-200 dark:border-gray-600 rounded-xl p-4 cursor-pointer hover:border-crush-purple dark:hover:border-purple-500 transition-all duration-300 has-[:checked]:border-crush-purple dark:has-[:checked]:border-purple-500 has-[:checked]:bg-purple-50 dark:has-[:checked]:bg-purple-950/30 has-[:checked]:shadow-md">
                                    <label class="flex items-start gap-4 cursor-pointer" for="demo-pres-picture">
                                        <input class="variant-radio mt-1 w-5 h-5 text-crush-purple focus:ring-crush-purple cursor-pointer" type="radio" name="demo_presentation" id="demo-pres-picture" value="picture">
                                        <div class="flex-1">
                                            <strong class="text-gray-900 dark:text-white block mb-1">{% trans "Share Picture & Story" %}</strong>
                                            <span class="text-gray-600 dark:text-gray-400 text-sm">{% trans "Show a favorite photo and tell its story!" %}</span>
                                        </div>
                                    </label>
                                </div>
                                {% endfor %}
                            </div>

                            <!-- Selection status -->
                            <div id="pres-status" class="mt-3 text-center text-sm text-gray-500 dark:text-gray-400 hidden">
                                <span class="inline-flex items-center gap-1 text-green-600 dark:text-green-400 font-medium">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    {% trans "Selected!" %}
                                </span>
                            </div>
                        </div>

                        <!-- Category B: Speed Dating Twist -->
                        <div id="group-speed-dating">
                            <div class="flex items-center gap-3 mb-4">
                                <span class="w-8 h-8 bg-crush-pink text-white rounded-full flex items-center justify-center font-bold">B</span>
                                <h3 class="text-lg font-bold text-gray-900 dark:text-white">{% trans "Speed Dating Twist" %}</h3>
                            </div>

                            <div class="space-y-3">
                                {% for option in twist_options %}
                                <div class="variant-option-item group relative bg-white dark:bg-gray-700 border-2 border-gray-200 dark:border-gray-600 rounded-xl p-4 cursor-pointer hover:border-crush-pink dark:hover:border-pink-500 transition-all duration-300 has-[:checked]:border-crush-pink dark:has-[:checked]:border-pink-500 has-[:checked]:bg-gradient-to-r has-[:checked]:from-pink-50 has-[:checked]:to-purple-50 dark:has-[:checked]:from-pink-950/30 dark:has-[:checked]:to-purple-950/30 has-[:checked]:shadow-md">
                                    <label class="flex items-start gap-4 cursor-pointer" for="demo-twist-{{ option.id }}">
                                        <input class="variant-radio mt-1 w-5 h-5 text-crush-pink focus:ring-crush-pink focus:ring-2 cursor-pointer" type="radio" name="demo_twist" id="demo-twist-{{ option.id }}" value="{{ option.activity_variant }}">
                                        <div class="flex-1">
                                            <strong class="text-gray-900 dark:text-white block mb-1">{{ option.display_name }}</strong>
                                            <span class="text-gray-600 dark:text-gray-400 text-sm">{{ option.description }}</span>
                                        </div>
                                    </label>
                                </div>
                                {% empty %}
                                <div class="variant-option-item group relative bg-white dark:bg-gray-700 border-2 border-gray-200 dark:border-gray-600 rounded-xl p-4 cursor-pointer hover:border-crush-pink dark:hover:border-pink-500 transition-all duration-300 has-[:checked]:border-crush-pink dark:has-[:checked]:border-pink-500 has-[:checked]:bg-pink-50 dark:has-[:checked]:bg-pink-950/30 has-[:checked]:shadow-md">
                                    <label class="flex items-start gap-4 cursor-pointer" for="demo-twist-spicy">
                                        <input class="variant-radio mt-1 w-5 h-5 text-crush-pink focus:ring-crush-pink cursor-pointer" type="radio" name="demo_twist" id="demo-twist-spicy" value="spicy">
                                        <div class="flex-1">
                                            <strong class="text-gray-900 dark:text-white block mb-1">{% trans "Spicy Questions First" %}</strong>
                                            <span class="text-gray-600 dark:text-gray-400 text-sm">{% trans "Start with fun, revealing questions!" %}</span>
                                        </div>
                                    </label>
                                </div>
                                <div class="variant-option-item group relative bg-white dark:bg-gray-700 border-2 border-gray-200 dark:border-gray-600 rounded-xl p-4 cursor-pointer hover:border-crush-pink dark:hover:border-pink-500 transition-all duration-300 has-[:checked]:border-crush-pink dark:has-[:checked]:border-pink-500 has-[:checked]:bg-pink-50 dark:has-[:checked]:bg-pink-950/30 has-[:checked]:shadow-md">
                                    <label class="flex items-start gap-4 cursor-pointer" for="demo-twist-forbidden">
                                        <input class="variant-radio mt-1 w-5 h-5 text-crush-pink focus:ring-crush-pink cursor-pointer" type="radio" name="demo_twist" id="demo-twist-forbidden" value="forbidden">
                                        <div class="flex-1">
                                            <strong class="text-gray-900 dark:text-white block mb-1">{% trans "Forbidden Word Game" %}</strong>
                                            <span class="text-gray-600 dark:text-gray-400 text-sm">{% trans "Avoid saying certain words - hilarious!" %}</span>
                                        </div>
                                    </label>
                                </div>
                                <div class="variant-option-item group relative bg-white dark:bg-gray-700 border-2 border-gray-200 dark:border-gray-600 rounded-xl p-4 cursor-pointer hover:border-crush-pink dark:hover:border-pink-500 transition-all duration-300 has-[:checked]:border-crush-pink dark:has-[:checked]:border-pink-500 has-[:checked]:bg-pink-50 dark:has-[:checked]:bg-pink-950/30 has-[:checked]:shadow-md">
                                    <label class="flex items-start gap-4 cursor-pointer" for="demo-twist-algorithm">
                                        <input class="variant-radio mt-1 w-5 h-5 text-crush-pink focus:ring-crush-pink cursor-pointer" type="radio" name="demo_twist" id="demo-twist-algorithm" value="algorithm">
                                        <div class="flex-1">
                                            <strong class="text-gray-900 dark:text-white block mb-1">{% trans "Algorithm Extended" %}</strong>
                                            <span class="text-gray-600 dark:text-gray-400 text-sm">{% trans "Top matches get extended 8-min conversations!" %}</span>
                                        </div>
                                    </label>
                                </div>
                                {% endfor %}
                            </div>

                            <!-- Selection status -->
                            <div id="twist-status" class="mt-3 text-center text-sm text-gray-500 dark:text-gray-400 hidden">
                                <span class="inline-flex items-center gap-1 text-green-600 dark:text-green-400 font-medium">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    {% trans "Selected!" %}
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Submit button and status -->
                    <div class="mt-8 text-center">
                        <div id="vote-warning" class="mb-4 text-amber-600 dark:text-amber-400 font-medium hidden">
                            {% trans "Please select one option from EACH category to continue" %}
                        </div>
                        <button type="button" class="btn-crush-primary px-10 py-4 text-lg font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none disabled:hover:shadow-lg inline-flex items-center gap-2" id="demoSubmitBtn" disabled @click="submitDemo">
                            <span>{% trans "Submit My Votes" %}</span>
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                        </button>
                    </div>
                </form>
            </div>

            <!-- Success State (shown after submit) -->
            <div x-show="isSubmitted" class="text-center py-8" x-cloak>
                <div class="inline-flex items-center justify-center w-20 h-20 bg-green-100 dark:bg-green-900/30 rounded-full mb-6">
                    <svg class="w-10 h-10 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">{% trans "Votes Submitted!" %}</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-lg mx-auto mb-6">
                    <div class="bg-purple-50 dark:bg-purple-950/30 border border-purple-200 dark:border-purple-700 rounded-xl p-4">
                        <div class="text-sm text-purple-600 dark:text-purple-400 font-semibold mb-1">üé§ {% trans "Presentation Style" %}</div>
                        <div class="text-gray-900 dark:text-white font-bold" x-text="presChoiceText"></div>
                    </div>
                    <div class="bg-pink-50 dark:bg-pink-950/30 border border-pink-200 dark:border-pink-700 rounded-xl p-4">
                        <div class="text-sm text-pink-600 dark:text-pink-400 font-semibold mb-1">üíï {% trans "Speed Dating Twist" %}</div>
                        <div class="text-gray-900 dark:text-white font-bold" x-text="twistChoiceText"></div>
                    </div>
                </div>
                <p class="text-gray-600 dark:text-gray-400">{% trans "In a real event, you would now see the results page with live vote counts. Scrolling to results..." %}</p>
            </div>
        </div>
    </div>

    <!-- Step 4: Results Display -->
    <div class="demo-section relative bg-white dark:bg-gray-800 rounded-2xl shadow-lg mb-10 overflow-hidden border border-gray-100 dark:border-gray-700 transition-all duration-300" id="step-results">
        <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-crush-purple via-purple-500 to-crush-pink"></div>

        <div class="p-6 md:p-8">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-gradient-to-br from-crush-purple to-crush-pink rounded-lg flex items-center justify-center">
                    <span class="text-white text-lg">üìä</span>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">{% trans "Step 4: See the Results" %}</h2>
            </div>
            <p class="text-gray-600 dark:text-gray-400 mb-8 leading-relaxed">{% trans "After voting closes, you'll see the chosen options for BOTH categories - each one shapes a different part of your evening!" %}</p>

            <!-- Two Winner Banners -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <!-- Presentation Winner -->
                <div class="relative bg-gradient-to-br from-purple-400 via-purple-500 to-purple-600 dark:from-purple-700 dark:via-purple-800 dark:to-purple-900 rounded-2xl p-6 text-center overflow-hidden shadow-lg">
                    <div class="absolute inset-0 opacity-10">
                        <div class="absolute top-0 right-0 w-32 h-32 bg-white rounded-full blur-3xl"></div>
                    </div>
                    <div class="absolute top-3 left-3 text-2xl opacity-70 animate-pulse">üé§</div>
                    <div class="relative">
                        <span class="text-xs font-bold text-purple-200 uppercase tracking-wide">{% trans "Category A - Selected" %}</span>
                        <div class="text-4xl my-3">üèÜ</div>
                        <h3 class="text-xl font-bold text-white mb-1">{% trans "With Favorite Music" %}</h3>
                        <p class="text-purple-200 text-sm">{% trans "Presentation Style" %}</p>
                    </div>
                </div>

                <!-- Speed Dating Winner -->
                <div class="relative bg-gradient-to-br from-pink-400 via-pink-500 to-pink-600 dark:from-pink-700 dark:via-pink-800 dark:to-pink-900 rounded-2xl p-6 text-center overflow-hidden shadow-lg">
                    <div class="absolute inset-0 opacity-10">
                        <div class="absolute top-0 right-0 w-32 h-32 bg-white rounded-full blur-3xl"></div>
                    </div>
                    <div class="absolute top-3 right-3 text-2xl opacity-70 animate-pulse">üíï</div>
                    <div class="relative">
                        <span class="text-xs font-bold text-pink-200 uppercase tracking-wide">{% trans "Category B - Selected" %}</span>
                        <div class="text-4xl my-3">üèÜ</div>
                        <h3 class="text-xl font-bold text-white mb-1">{% trans "Spicy Questions First" %}</h3>
                        <p class="text-pink-200 text-sm">{% trans "Speed Dating Twist" %}</p>
                    </div>
                </div>
            </div>

            <!-- Sample Vote Breakdown -->
            <h4 class="font-bold text-gray-900 dark:text-white mb-4">{% trans "Example Vote Breakdown:" %}</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Presentation Results -->
                <div class="space-y-3">
                    <div class="text-sm font-medium text-purple-600 dark:text-purple-400 mb-2">{% trans "Presentation Style" %}</div>
                    <div>
                        <div class="flex items-center justify-between mb-1">
                            <span class="text-gray-700 dark:text-gray-300 text-sm">{% trans "With Favorite Music" %}</span>
                            <span class="text-purple-600 dark:text-purple-400 font-bold text-sm">45%</span>
                        </div>
                        <div class="h-3 bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden">
                            <div class="h-full bg-gradient-to-r from-crush-purple to-purple-600 rounded-full" style="width: 45%;"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex items-center justify-between mb-1">
                            <span class="text-gray-700 dark:text-gray-300 text-sm">{% trans "5 Questions" %}</span>
                            <span class="text-gray-500 dark:text-gray-400 font-bold text-sm">35%</span>
                        </div>
                        <div class="h-3 bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden">
                            <div class="h-full bg-gray-400 dark:bg-gray-500 rounded-full" style="width: 35%;"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex items-center justify-between mb-1">
                            <span class="text-gray-700 dark:text-gray-300 text-sm">{% trans "Picture & Story" %}</span>
                            <span class="text-gray-500 dark:text-gray-400 font-bold text-sm">20%</span>
                        </div>
                        <div class="h-3 bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden">
                            <div class="h-full bg-gray-400 dark:bg-gray-500 rounded-full" style="width: 20%;"></div>
                        </div>
                    </div>
                </div>

                <!-- Twist Results -->
                <div class="space-y-3">
                    <div class="text-sm font-medium text-pink-600 dark:text-pink-400 mb-2">{% trans "Speed Dating Twist" %}</div>
                    <div>
                        <div class="flex items-center justify-between mb-1">
                            <span class="text-gray-700 dark:text-gray-300 text-sm">{% trans "Spicy Questions" %}</span>
                            <span class="text-pink-600 dark:text-pink-400 font-bold text-sm">50%</span>
                        </div>
                        <div class="h-3 bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden">
                            <div class="h-full bg-gradient-to-r from-crush-pink to-pink-600 rounded-full" style="width: 50%;"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex items-center justify-between mb-1">
                            <span class="text-gray-700 dark:text-gray-300 text-sm">{% trans "Forbidden Word" %}</span>
                            <span class="text-gray-500 dark:text-gray-400 font-bold text-sm">30%</span>
                        </div>
                        <div class="h-3 bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden">
                            <div class="h-full bg-gray-400 dark:bg-gray-500 rounded-full" style="width: 30%;"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex items-center justify-between mb-1">
                            <span class="text-gray-700 dark:text-gray-300 text-sm">{% trans "Algorithm Extended" %}</span>
                            <span class="text-gray-500 dark:text-gray-400 font-bold text-sm">20%</span>
                        </div>
                        <div class="h-3 bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden">
                            <div class="h-full bg-gray-400 dark:bg-gray-500 rounded-full" style="width: 20%;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-8 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-950/30 dark:to-emerald-950/30 border-l-4 border-green-500 dark:border-green-600 rounded-lg p-5">
                <div class="flex items-start gap-3">
                    <span class="text-2xl flex-shrink-0">üéØ</span>
                    <div>
                        <strong class="text-gray-900 dark:text-white block mb-1">{% trans "What happens next?" %}</strong>
                        <p class="text-gray-700 dark:text-gray-300">{% trans "The winning options are applied! In this example: Everyone presents with their favorite music playing, then speed dating starts with spicy questions to break the ice!" %}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- CTA Section -->
    <div class="text-center mt-12 mb-8">
        <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
            <button class="group inline-flex items-center gap-3 px-8 py-4 text-lg font-semibold border-2 border-crush-purple text-crush-purple dark:text-purple-400 dark:border-purple-500 hover:bg-crush-purple hover:text-white dark:hover:bg-purple-600 dark:hover:text-white rounded-xl transition-all duration-300 shadow-md hover:shadow-lg transform hover:scale-105" id="restartTour">
                <svg class="w-5 h-5 transform group-hover:rotate-180 transition-transform duration-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
                <span>{% trans "Replay Tour" %}</span>
            </button>
            <a href="{% url 'crush_lu:event_list' %}" class="btn-crush-primary px-10 py-4 text-lg font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 inline-flex items-center gap-2">
                <span>{% trans "Browse Events" %}</span>
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                </svg>
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script nonce="{{ request.csp_nonce }}">
class VotingTour {
    constructor() {
        this.currentStep = 0;
        this.steps = [
            {
                title: "{% trans 'Welcome to Event Voting!' %} üéâ",
                text: "{% trans 'At Crush.lu events, YOU shape the evening! This tour shows you exactly how voting works.' %}",
                target: null,
                highlight: null
            },
            {
                title: "{% trans 'Three-Phase Events' %} üéØ",
                text: "{% trans 'Every event has 3 phases: Icebreaker, Presentations, and Speed Dating. Your votes decide what happens in phases 2 and 3!' %}",
                target: "step-overview",
                highlight: "timeline"
            },
            {
                title: "{% trans 'Voting Opens at 15 Minutes' %} ‚è±Ô∏è",
                text: "{% trans 'After 15 minutes of mingling, voting opens for 30 minutes. You will see a live countdown timer on your phone!' %}",
                target: "step-overview",
                highlight: "step-overview"
            },
            {
                title: "{% trans 'Rate & Get Paired' %} ‚≠ê",
                text: "{% trans 'During presentations, you anonymously rate each person 1-5 stars. These ratings help create better speed dating pairings - people who rated each other highly are more likely to be matched!' %}",
                target: "step-overview",
                highlight: "rating-info"
            },
            {
                title: "{% trans 'TWO Categories!' %} ‚úåÔ∏è",
                text: "{% trans 'Unlike simple polls, you vote on TWO separate things. Each one affects a different phase of the event.' %}",
                target: "step-categories",
                highlight: "step-categories"
            },
            {
                title: "{% trans 'Category A: Presentation Style' %} üé§",
                text: "{% trans 'First, choose HOW everyone will introduce themselves. With music? Fun questions? Photos? You decide!' %}",
                target: "step-categories",
                highlight: "category-presentation"
            },
            {
                title: "{% trans 'Category B: Speed Dating Twist' %} üíï",
                text: "{% trans 'Then, pick a fun TWIST for the speed dating phase. Spicy questions? Word games? Extended time for top matches?' %}",
                target: "step-categories",
                highlight: "category-twist"
            },
            {
                title: "{% trans 'Mystery Option' %} üé≠",
                text: "{% trans 'Some events offer a Mystery option! Trust the coaches with a surprise activity designed to create unexpected connections.' %}",
                target: "step-categories",
                highlight: "mystery-callout"
            },
            {
                title: "{% trans 'Try It Now!' %} üó≥Ô∏è",
                text: "{% trans 'Practice voting below! Select ONE option from EACH category - the submit button only activates when both are chosen.' %}",
                target: "step-demo",
                highlight: "demoVoteForm"
            },
            {
                title: "{% trans 'The Results!' %} üìä",
                text: "{% trans 'After voting closes, the most voted options are revealed for BOTH categories. Each one shapes a different part of your evening!' %}",
                target: "step-results",
                highlight: "step-results"
            },
            {
                title: "{% trans 'You are Ready!' %} üéâ",
                text: "{% trans 'That is everything! On event day, open the voting link on your phone. Questions? Ask a coach at the event!' %}",
                target: null,
                highlight: null
            }
        ];

        this.init();
    }

    init() {
        var self = this;
        document.getElementById('startTour').addEventListener('click', function() { self.start(); });
        document.getElementById('restartTour').addEventListener('click', function() { self.start(); });
        document.getElementById('tourNext').addEventListener('click', function() { self.next(); });
        document.getElementById('tourPrev').addEventListener('click', function() { self.prev(); });
        document.getElementById('tourOverlay').addEventListener('click', function() { self.end(); });

        // Track selections for both categories
        var presSelected = false;
        var twistSelected = false;

        document.querySelectorAll('input[name="demo_presentation"]').forEach(function(radio) {
            radio.addEventListener('change', function() {
                presSelected = true;
                document.getElementById('pres-status').classList.remove('hidden');
                self.checkBothSelected(presSelected, twistSelected);
            });
        });

        document.querySelectorAll('input[name="demo_twist"]').forEach(function(radio) {
            radio.addEventListener('change', function() {
                twistSelected = true;
                document.getElementById('twist-status').classList.remove('hidden');
                self.checkBothSelected(presSelected, twistSelected);
            });
        });
    }

    checkBothSelected(presSelected, twistSelected) {
        var btn = document.getElementById('demoSubmitBtn');
        var warning = document.getElementById('vote-warning');
        if (presSelected && twistSelected) {
            btn.disabled = false;
            warning.classList.add('hidden');
        } else {
            btn.disabled = true;
            warning.classList.remove('hidden');
        }
    }

    start() {
        this.currentStep = 0;
        this.show();
    }

    show() {
        var step = this.steps[this.currentStep];
        var tooltip = document.getElementById('tourTooltip');
        var overlay = document.getElementById('tourOverlay');

        document.getElementById('tourTitle').textContent = step.title;
        document.getElementById('tourText').textContent = step.text;

        document.getElementById('tourPrev').style.display = this.currentStep === 0 ? 'none' : 'block';
        document.getElementById('tourNext').textContent = this.currentStep === this.steps.length - 1 ? "{% trans 'Finish' %}" : "{% trans 'Next' %} ‚Üí";

        document.querySelectorAll('.tour-highlight').forEach(function(el) {
            el.classList.remove('tour-highlight');
        });
        document.querySelectorAll('.demo-section.active').forEach(function(el) {
            el.classList.remove('active');
        });

        overlay.classList.add('active');
        tooltip.classList.add('active');

        if (step.target) {
            var target = document.getElementById(step.target);
            var rect = target.getBoundingClientRect();

            tooltip.style.top = (rect.top + window.scrollY - 250) + 'px';
            tooltip.style.left = Math.max(20, (rect.left + rect.width / 2 - 200)) + 'px';
            tooltip.style.transform = 'none';

            target.scrollIntoView({ behavior: 'smooth', block: 'center' });
            target.classList.add('active');
        } else {
            tooltip.style.top = '50%';
            tooltip.style.left = '50%';
            tooltip.style.transform = 'translate(-50%, -50%)';
        }

        if (step.highlight) {
            var highlight = document.getElementById(step.highlight);
            if (highlight) {
                setTimeout(function() {
                    highlight.classList.add('tour-highlight');
                }, 300);
            }
        }
    }

    next() {
        if (this.currentStep < this.steps.length - 1) {
            this.currentStep++;
            this.show();
        } else {
            this.end();
        }
    }

    prev() {
        if (this.currentStep > 0) {
            this.currentStep--;
            this.show();
        }
    }

    end() {
        document.getElementById('tourOverlay').classList.remove('active');
        document.getElementById('tourTooltip').classList.remove('active');
        document.querySelectorAll('.tour-highlight').forEach(function(el) {
            el.classList.remove('tour-highlight');
        });
        document.querySelectorAll('.demo-section.active').forEach(function(el) {
            el.classList.remove('active');
        });
    }
}

document.addEventListener('DOMContentLoaded', function() {
    new VotingTour();
});
</script>
{% endblock %}
