{% load i18n %}
<form method="post"
      hx-post="{% url 'crush_lu:event_register' event.id %}"
      hx-target="#registration-form-container"
      hx-swap="outerHTML"
      novalidate
      id="registration-form-container"
      aria-live="polite"
      aria-atomic="true">
    {% csrf_token %}

    {% if form.non_field_errors %}
        <div class="bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-700 text-red-800 dark:text-red-300 rounded-lg p-4 mb-4">
            {% for error in form.non_field_errors %}
                <p class="m-0">{{ error }}</p>
            {% endfor %}
        </div>
    {% endif %}

    {% if form.dietary_restrictions %}
    <div class="mb-4">
        <label for="{{ form.dietary_restrictions.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1">
            {% trans "Dietary Restrictions" %}
        </label>
        {{ form.dietary_restrictions }}
        <small class="text-gray-500 dark:text-gray-400 text-sm">{% trans "e.g., vegetarian, gluten-free" %}</small>
        {% if form.dietary_restrictions.errors %}
            <div class="text-red-500 text-sm mt-1">{{ form.dietary_restrictions.errors.0 }}</div>
        {% endif %}
    </div>
    {% endif %}

    {% if form.bringing_guest %}
    <div class="mb-4">
        <div class="flex items-center gap-3 mb-3">
            {{ form.bringing_guest }}
            <label for="{{ form.bringing_guest.id_for_label }}" class="text-sm text-gray-700 dark:text-gray-200 cursor-pointer">
                {% trans "I'm bringing a guest" %}
            </label>
        </div>

        <div class="ml-7">
            <label for="{{ form.guest_name.id_for_label }}" class="text-sm font-medium text-gray-700 dark:text-gray-200 mb-2 block">
                {% trans "Guest's Name" %}
            </label>
            {{ form.guest_name }}
            {% if form.guest_name.errors %}
                <div class="text-red-500 text-sm mt-1">{{ form.guest_name.errors.0 }}</div>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <div class="flex flex-col gap-3">
        <button type="submit" class="btn-crush-primary py-4 text-lg inline-flex items-center justify-center gap-2">
            <span class="htmx-indicator">
                {% include "shared/icons/loading.html" with class="w-5 h-5 animate-spin" %}
            </span>
            <span class="htmx-hide-on-request">
                {% if event.is_full %}
                    {% trans "Join Waitlist" %}
                {% else %}
                    {% trans "Confirm Registration" %}
                {% endif %}
            </span>
        </button>
        <a href="{% url 'crush_lu:event_detail' event.id %}" class="block w-full text-center py-3 px-4 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 font-medium rounded-lg transition-colors">
            {% trans "Cancel" %}
        </a>
    </div>
</form>
