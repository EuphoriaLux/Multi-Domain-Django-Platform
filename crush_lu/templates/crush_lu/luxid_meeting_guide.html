{% extends 'crush_lu/base.html' %}
{% load static %}

{% block title %}LuxID CIAM Integration - Technical Overview - Crush.lu{% endblock %}
{% block meta_robots %}noindex, nofollow{% endblock %}

{% block extra_css %}
<style>
    /* Print styles */
    @media print {
        nav, .sticky, .no-print, footer { display: none !important; }
        .print-break { page-break-before: always; }
        body { font-size: 11pt; }
        .shadow-lg, .shadow-xl { box-shadow: none !important; }
    }
    /* PKCE flow diagram */
    .flow-step {
        position: relative;
    }
    .flow-step:not(:last-child)::after {
        content: '';
        position: absolute;
        left: 50%;
        bottom: -1.5rem;
        transform: translateX(-50%);
        width: 2px;
        height: 1.5rem;
        background: linear-gradient(to bottom, #8B5CF6, #3B82F6);
    }
    .flow-arrow {
        position: relative;
    }
    .flow-arrow::after {
        content: '\2193';
        position: absolute;
        left: 50%;
        bottom: -1.75rem;
        transform: translateX(-50%);
        font-size: 1.25rem;
        color: #8B5CF6;
    }
    /* Architecture diagram */
    .arch-box {
        border: 2px solid;
        border-radius: 0.75rem;
        padding: 1rem 1.5rem;
        text-align: center;
        font-weight: 600;
        min-width: 200px;
    }
    .arch-arrow {
        display: flex;
        align-items: center;
        justify-content: center;
        color: #6B7280;
        font-size: 1.5rem;
        padding: 0 0.5rem;
    }
    /* Checklist styling */
    .checklist-item {
        display: flex;
        align-items: flex-start;
        gap: 0.75rem;
        padding: 0.75rem 0;
        border-bottom: 1px solid rgba(0,0,0,0.05);
    }
    .checklist-box {
        width: 1.25rem;
        height: 1.25rem;
        border: 2px solid #8B5CF6;
        border-radius: 0.25rem;
        flex-shrink: 0;
        margin-top: 0.125rem;
    }
    html.dark .checklist-item {
        border-bottom-color: rgba(255,255,255,0.05);
    }
</style>
{% endblock %}

{% block content %}
{# ===== HERO BANNER ===== #}
<div id="hero" class="bg-gradient-to-r from-purple-600 via-blue-500 to-green-400 text-white py-12 shadow-xl -mt-8">
    <div class="max-w-5xl mx-auto px-4 text-center">
        <div class="flex items-center justify-center gap-4 mb-6">
            <img src="{% static 'crush_lu/images/Logo-LuxID_small.webp' %}"
                 alt="LuxID"
                 class="w-16 h-16 bg-white rounded-xl p-2 shadow-xl">
            <span class="text-4xl font-light opacity-50">&times;</span>
            <img src="{% static 'crush_lu/crush_favicon.ico' %}"
                 alt="Crush.lu"
                 class="w-16 h-16 bg-white rounded-xl p-2 shadow-xl">
        </div>
        <h1 class="text-3xl md:text-4xl font-bold mb-3">LuxID CIAM Integration</h1>
        <p class="text-xl text-white/90 mb-2">Technical Overview &amp; Meeting Preparation Guide</p>
        <p class="text-white/70">POST Luxembourg &times; Crush.lu</p>
    </div>
</div>

{# ===== STICKY NAV ===== #}
<div class="sticky top-0 z-40 bg-white/95 dark:bg-gray-900/95 backdrop-blur-sm shadow-sm border-b border-gray-200 dark:border-gray-700 no-print"
     x-data="sectionNav">
    <div class="max-w-5xl mx-auto px-4">
        <nav class="flex gap-1 overflow-x-auto py-2 text-sm scrollbar-hide" aria-label="Section navigation">
            <button data-section="mockups" @click="scrollTo('mockups')"
                    class="px-3 py-1.5 rounded-full whitespace-nowrap transition-colors hover:bg-purple-100 dark:hover:bg-purple-900/30"
                    x-bind:class="isActive('mockups') ? 'bg-purple-100 dark:bg-purple-900/40 text-purple-700 dark:text-purple-300 font-semibold' : 'text-gray-600 dark:text-gray-400'">
                UX Mockups</button>
            <button data-section="integration" @click="scrollTo('integration')"
                    class="px-3 py-1.5 rounded-full whitespace-nowrap transition-colors hover:bg-purple-100 dark:hover:bg-purple-900/30"
                    x-bind:class="isActive('integration') ? 'bg-purple-100 dark:bg-purple-900/40 text-purple-700 dark:text-purple-300 font-semibold' : 'text-gray-600 dark:text-gray-400'">
                Integration</button>
            <button data-section="pkce" @click="scrollTo('pkce')"
                    class="px-3 py-1.5 rounded-full whitespace-nowrap transition-colors hover:bg-purple-100 dark:hover:bg-purple-900/30"
                    x-bind:class="isActive('pkce') ? 'bg-purple-100 dark:bg-purple-900/40 text-purple-700 dark:text-purple-300 font-semibold' : 'text-gray-600 dark:text-gray-400'">
                PKCE</button>
            <button data-section="attributes" @click="scrollTo('attributes')"
                    class="px-3 py-1.5 rounded-full whitespace-nowrap transition-colors hover:bg-purple-100 dark:hover:bg-purple-900/30"
                    x-bind:class="isActive('attributes') ? 'bg-purple-100 dark:bg-purple-900/40 text-purple-700 dark:text-purple-300 font-semibold' : 'text-gray-600 dark:text-gray-400'">
                Attributes</button>
            <button data-section="from-post" @click="scrollTo('from-post')"
                    class="px-3 py-1.5 rounded-full whitespace-nowrap transition-colors hover:bg-purple-100 dark:hover:bg-purple-900/30"
                    x-bind:class="isActive('from-post') ? 'bg-purple-100 dark:bg-purple-900/40 text-purple-700 dark:text-purple-300 font-semibold' : 'text-gray-600 dark:text-gray-400'">
                From POST</button>
            <button data-section="from-crush" @click="scrollTo('from-crush')"
                    class="px-3 py-1.5 rounded-full whitespace-nowrap transition-colors hover:bg-purple-100 dark:hover:bg-purple-900/30"
                    x-bind:class="isActive('from-crush') ? 'bg-purple-100 dark:bg-purple-900/40 text-purple-700 dark:text-purple-300 font-semibold' : 'text-gray-600 dark:text-gray-400'">
                From Crush.lu</button>
            <button data-section="architecture" @click="scrollTo('architecture')"
                    class="px-3 py-1.5 rounded-full whitespace-nowrap transition-colors hover:bg-purple-100 dark:hover:bg-purple-900/30"
                    x-bind:class="isActive('architecture') ? 'bg-purple-100 dark:bg-purple-900/40 text-purple-700 dark:text-purple-300 font-semibold' : 'text-gray-600 dark:text-gray-400'">
                Architecture</button>
            <button data-section="pricing" @click="scrollTo('pricing')"
                    class="px-3 py-1.5 rounded-full whitespace-nowrap transition-colors hover:bg-purple-100 dark:hover:bg-purple-900/30"
                    x-bind:class="isActive('pricing') ? 'bg-purple-100 dark:bg-purple-900/40 text-purple-700 dark:text-purple-300 font-semibold' : 'text-gray-600 dark:text-gray-400'">
                Pricing</button>
            <button data-section="sla" @click="scrollTo('sla')"
                    class="px-3 py-1.5 rounded-full whitespace-nowrap transition-colors hover:bg-purple-100 dark:hover:bg-purple-900/30"
                    x-bind:class="isActive('sla') ? 'bg-purple-100 dark:bg-purple-900/40 text-purple-700 dark:text-purple-300 font-semibold' : 'text-gray-600 dark:text-gray-400'">
                SLA</button>
            <button data-section="contractual" @click="scrollTo('contractual')"
                    class="px-3 py-1.5 rounded-full whitespace-nowrap transition-colors hover:bg-purple-100 dark:hover:bg-purple-900/30"
                    x-bind:class="isActive('contractual') ? 'bg-purple-100 dark:bg-purple-900/40 text-purple-700 dark:text-purple-300 font-semibold' : 'text-gray-600 dark:text-gray-400'">
                Legal</button>
            <button data-section="timeline" @click="scrollTo('timeline')"
                    class="px-3 py-1.5 rounded-full whitespace-nowrap transition-colors hover:bg-purple-100 dark:hover:bg-purple-900/30"
                    x-bind:class="isActive('timeline') ? 'bg-purple-100 dark:bg-purple-900/40 text-purple-700 dark:text-purple-300 font-semibold' : 'text-gray-600 dark:text-gray-400'">
                Timeline</button>
        </nav>
    </div>
</div>

<div class="max-w-5xl mx-auto px-4 py-8 space-y-12">

{# ===== SECTION 1: UX MOCKUPS ===== #}
<section id="mockups" class="scroll-mt-20">
    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3">
        <span class="flex items-center justify-center w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-blue-500 text-white text-lg font-bold">1</span>
        UX Mockups (Live Demos)
    </h2>
    <div class="grid md:grid-cols-2 gap-6">
        <a href="/mockup/auth-luxid/"
           class="block bg-white dark:bg-gray-800 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden border border-gray-200 dark:border-gray-700 hover:border-purple-300 dark:hover:border-purple-600 group">
            <div class="bg-gradient-to-r from-purple-600 via-blue-500 to-green-400 p-4">
                <div class="flex items-center gap-3">
                    <div class="bg-white/20 backdrop-blur-sm rounded-lg p-2">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/>
                        </svg>
                    </div>
                    <span class="text-white font-bold text-lg">Login / Signup Flow</span>
                </div>
            </div>
            <div class="p-5">
                <p class="text-gray-600 dark:text-gray-300 mb-3">Login and registration screens with LuxID as the primary "Fast Track" authentication option, alongside existing social providers.</p>
                <span class="text-purple-600 dark:text-purple-400 font-semibold text-sm group-hover:underline">/mockup/auth-luxid/ &rarr;</span>
            </div>
        </a>
        <a href="/mockup/profile-luxid/"
           class="block bg-white dark:bg-gray-800 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden border border-gray-200 dark:border-gray-700 hover:border-purple-300 dark:hover:border-purple-600 group">
            <div class="bg-gradient-to-r from-purple-600 via-blue-500 to-green-400 p-4">
                <div class="flex items-center gap-3">
                    <div class="bg-white/20 backdrop-blur-sm rounded-lg p-2">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                    </div>
                    <span class="text-white font-bold text-lg">Profile Fast-Track</span>
                </div>
            </div>
            <div class="p-5">
                <p class="text-gray-600 dark:text-gray-300 mb-3">Profile creation with pre-filled fields from LuxID attributes. Demonstrates how verified identity data accelerates onboarding.</p>
                <span class="text-purple-600 dark:text-purple-400 font-semibold text-sm group-hover:underline">/mockup/profile-luxid/ &rarr;</span>
            </div>
        </a>
    </div>
</section>

{# ===== SECTION 2: TECHNICAL INTEGRATION ===== #}
<section id="integration" class="scroll-mt-20">
    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3">
        <span class="flex items-center justify-center w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-blue-500 text-white text-lg font-bold">2</span>
        Technical Integration Overview
    </h2>

    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700 mb-6">
        <h3 class="font-bold text-lg text-gray-900 dark:text-white mb-4">Why Django Allauth + OIDC Is a Natural Fit</h3>
        <p class="text-gray-600 dark:text-gray-300 mb-4">
            POST recommends using "existing tested libraries" for integration (Annex G1 &sect;6.2).
            <strong>django-allauth</strong> is exactly that &mdash; a battle-tested authentication library with built-in OIDC provider support.
            Crush.lu already uses it for Google, Facebook, Microsoft, and LinkedIn OAuth.
        </p>
        <div class="flex flex-wrap gap-3">
            <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                OIDC Native Support
            </span>
            <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                PKCE Built-in
            </span>
            <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                Auto Discovery
            </span>
            <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                JWT Verification
            </span>
        </div>
    </div>

    <h3 class="font-bold text-lg text-gray-900 dark:text-white mb-4">5 Integration Steps</h3>
    <div class="space-y-4 mb-6">
        <div class="flex gap-4 items-start">
            <span class="flex-shrink-0 w-8 h-8 rounded-full bg-purple-100 dark:bg-purple-900/40 text-purple-700 dark:text-purple-300 flex items-center justify-center font-bold text-sm">1</span>
            <div>
                <p class="font-semibold text-gray-900 dark:text-white">Install OIDC Provider Package</p>
                <code class="text-sm bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded text-purple-700 dark:text-purple-300">pip install django-allauth[openid_connect]</code>
            </div>
        </div>
        <div class="flex gap-4 items-start">
            <span class="flex-shrink-0 w-8 h-8 rounded-full bg-purple-100 dark:bg-purple-900/40 text-purple-700 dark:text-purple-300 flex items-center justify-center font-bold text-sm">2</span>
            <div>
                <p class="font-semibold text-gray-900 dark:text-white">Register LuxID as OIDC Provider</p>
                <p class="text-sm text-gray-600 dark:text-gray-400">Configure Client ID, Client Secret, and Discovery URL in Django admin</p>
            </div>
        </div>
        <div class="flex gap-4 items-start">
            <span class="flex-shrink-0 w-8 h-8 rounded-full bg-purple-100 dark:bg-purple-900/40 text-purple-700 dark:text-purple-300 flex items-center justify-center font-bold text-sm">3</span>
            <div>
                <p class="font-semibold text-gray-900 dark:text-white">Configure Callback URLs</p>
                <p class="text-sm text-gray-600 dark:text-gray-400">Register callback URLs with POST for both UAT and Production</p>
            </div>
        </div>
        <div class="flex gap-4 items-start">
            <span class="flex-shrink-0 w-8 h-8 rounded-full bg-purple-100 dark:bg-purple-900/40 text-purple-700 dark:text-purple-300 flex items-center justify-center font-bold text-sm">4</span>
            <div>
                <p class="font-semibold text-gray-900 dark:text-white">Map User Attributes</p>
                <p class="text-sm text-gray-600 dark:text-gray-400">Map OIDC claims to CrushProfile fields (name, birthdate, gender, etc.)</p>
            </div>
        </div>
        <div class="flex gap-4 items-start">
            <span class="flex-shrink-0 w-8 h-8 rounded-full bg-purple-100 dark:bg-purple-900/40 text-purple-700 dark:text-purple-300 flex items-center justify-center font-bold text-sm">5</span>
            <div>
                <p class="font-semibold text-gray-900 dark:text-white">Enable PKCE</p>
                <p class="text-sm text-gray-600 dark:text-gray-400">Allauth handles PKCE automatically &mdash; just set <code class="bg-gray-100 dark:bg-gray-700 px-1 rounded text-sm">PKCE_ENABLED = True</code></p>
            </div>
        </div>
    </div>

    <div class="grid md:grid-cols-3 gap-4">
        <div class="bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4 border border-gray-200 dark:border-gray-700">
            <h4 class="font-semibold text-gray-900 dark:text-white mb-2 text-sm uppercase tracking-wide">Protocols (G1 &sect;3.3)</h4>
            <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                <li>SAML 2.0</li>
                <li>OAuth 2.0</li>
                <li class="font-bold text-purple-600 dark:text-purple-400">OIDC (our choice) &check;</li>
            </ul>
        </div>
        <div class="bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4 border border-gray-200 dark:border-gray-700">
            <h4 class="font-semibold text-gray-900 dark:text-white mb-2 text-sm uppercase tracking-wide">Security (G1 &sect;3.2)</h4>
            <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                <li>TLS 1.2 minimum</li>
                <li class="font-bold text-green-600 dark:text-green-400">TLS 1.3 recommended</li>
                <li>Certificate rotation via metadata</li>
            </ul>
        </div>
        <div class="bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4 border border-gray-200 dark:border-gray-700">
            <h4 class="font-semibold text-gray-900 dark:text-white mb-2 text-sm uppercase tracking-wide">Environments (G1 &sect;3.1)</h4>
            <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                <li><strong>UAT:</strong> Public, test data</li>
                <li><strong>Production:</strong> Public, real data</li>
                <li>Separate credentials per env</li>
            </ul>
        </div>
    </div>
</section>

{# ===== SECTION 3: PKCE FLOW ===== #}
<section id="pkce" class="scroll-mt-20 print-break">
    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3">
        <span class="flex items-center justify-center w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-blue-500 text-white text-lg font-bold">3</span>
        Authorization Code + PKCE Flow
    </h2>

    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700 mb-6">
        <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 mb-6 border border-blue-200 dark:border-blue-800">
            <p class="text-sm text-blue-800 dark:text-blue-200">
                <strong>Why PKCE?</strong> POST "highly recommends" it (Annex G1 &sect;6.2, RFC 7636).
                OAuth 2.1 will mandate PKCE for all clients. Django Allauth handles the entire flow automatically.
            </p>
        </div>

        <div class="space-y-8">
            <div class="flow-step flow-arrow">
                <div class="flex items-start gap-4">
                    <span class="flex-shrink-0 w-10 h-10 rounded-full bg-purple-600 text-white flex items-center justify-center font-bold">1</span>
                    <div>
                        <p class="font-bold text-gray-900 dark:text-white">Generate Code Verifier</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Client generates a random <code class="bg-gray-100 dark:bg-gray-700 px-1 rounded">code_verifier</code> (43-128 chars, cryptographically random)</p>
                        <div class="mt-2 bg-gray-900 dark:bg-gray-950 rounded-lg p-3">
                            <code class="text-sm text-green-400">code_verifier = "dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk"</code>
                        </div>
                    </div>
                </div>
            </div>
            <div class="flow-step flow-arrow">
                <div class="flex items-start gap-4">
                    <span class="flex-shrink-0 w-10 h-10 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold">2</span>
                    <div>
                        <p class="font-bold text-gray-900 dark:text-white">Hash to Code Challenge</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">SHA-256 hash the verifier to create <code class="bg-gray-100 dark:bg-gray-700 px-1 rounded">code_challenge</code></p>
                        <div class="mt-2 bg-gray-900 dark:bg-gray-950 rounded-lg p-3">
                            <code class="text-sm text-green-400">code_challenge = BASE64URL(SHA256(code_verifier))</code>
                        </div>
                    </div>
                </div>
            </div>
            <div class="flow-step flow-arrow">
                <div class="flex items-start gap-4">
                    <span class="flex-shrink-0 w-10 h-10 rounded-full bg-teal-600 text-white flex items-center justify-center font-bold">3</span>
                    <div>
                        <p class="font-bold text-gray-900 dark:text-white">Send Challenge with Auth Request</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Include <code class="bg-gray-100 dark:bg-gray-700 px-1 rounded">code_challenge</code> + <code class="bg-gray-100 dark:bg-gray-700 px-1 rounded">code_challenge_method=S256</code> in the authorization request</p>
                    </div>
                </div>
            </div>
            <div class="flow-step">
                <div class="flex items-start gap-4">
                    <span class="flex-shrink-0 w-10 h-10 rounded-full bg-green-600 text-white flex items-center justify-center font-bold">4</span>
                    <div>
                        <p class="font-bold text-gray-900 dark:text-white">Send Verifier with Token Exchange</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Include original <code class="bg-gray-100 dark:bg-gray-700 px-1 rounded">code_verifier</code> when exchanging auth code for tokens. Server verifies the hash matches.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

{# ===== SECTION 4: ATTRIBUTES ===== #}
<section id="attributes" class="scroll-mt-20">
    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3">
        <span class="flex items-center justify-center w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-blue-500 text-white text-lg font-bold">4</span>
        User Attributes (Annex C6)
    </h2>

    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden border border-gray-200 dark:border-gray-700 mb-6">
        <div class="px-6 py-4 bg-gray-50 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-600">
            <h3 class="font-semibold text-gray-900 dark:text-white">Standard OIDC Claims Available from LuxID</h3>
        </div>
        <div class="overflow-x-auto">
            <table class="w-full text-sm">
                <thead>
                    <tr class="border-b border-gray-200 dark:border-gray-700">
                        <th class="text-left px-6 py-3 font-semibold text-gray-700 dark:text-gray-300">Attribute</th>
                        <th class="text-left px-6 py-3 font-semibold text-gray-700 dark:text-gray-300">Description</th>
                        <th class="text-center px-6 py-3 font-semibold text-gray-700 dark:text-gray-300">Crush.lu Needs</th>
                    </tr>
                </thead>
                <tbody>
                    {% for attr in attributes_needed %}
                    <tr class="border-b border-gray-100 dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-700/30">
                        <td class="px-6 py-3 font-mono text-purple-700 dark:text-purple-300">{{ attr.name }}</td>
                        <td class="px-6 py-3 text-gray-600 dark:text-gray-400">{{ attr.description }}</td>
                        <td class="px-6 py-3 text-center">
                            {% if attr.required %}
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300">Required</span>
                            {% else %}
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400">Optional</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700">
        <h3 class="font-semibold text-gray-900 dark:text-white mb-3">All Standard OIDC Claims Available</h3>
        <div class="flex flex-wrap gap-2">
            {% for attr in attributes_available %}
            <code class="px-2.5 py-1 rounded-lg text-xs font-mono bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-200 dark:border-gray-600">{{ attr }}</code>
            {% endfor %}
        </div>
        <p class="text-sm text-gray-500 dark:text-gray-400 mt-3">Custom attributes possible per Annex C6 &sect;3</p>
    </div>
</section>

{# ===== SECTION 5: WHAT WE NEED FROM POST ===== #}
<section id="from-post" class="scroll-mt-20 print-break">
    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3">
        <span class="flex items-center justify-center w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-blue-500 text-white text-lg font-bold">5</span>
        What Crush.lu Needs from POST/LuxID
    </h2>
    <p class="text-gray-600 dark:text-gray-400 mb-4 text-sm">Reference: Annex G1 &sect;6.2</p>

    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700">
        <div class="space-y-1">
            <div class="checklist-item">
                <div class="checklist-box"></div>
                <div>
                    <p class="font-semibold text-gray-900 dark:text-white">Client ID</p>
                    <p class="text-sm text-gray-500 dark:text-gray-400">For each Client Application (UAT + Production)</p>
                </div>
            </div>
            <div class="checklist-item">
                <div class="checklist-box"></div>
                <div>
                    <p class="font-semibold text-gray-900 dark:text-white">Client Secret</p>
                    <p class="text-sm text-gray-500 dark:text-gray-400">For secure back-to-back (server-side) communication</p>
                </div>
            </div>
            <div class="checklist-item">
                <div class="checklist-box"></div>
                <div>
                    <p class="font-semibold text-gray-900 dark:text-white">Discovery Endpoint URL</p>
                    <p class="text-sm text-gray-500 dark:text-gray-400"><code class="bg-gray-100 dark:bg-gray-700 px-1 rounded text-xs">.well-known/openid-configuration</code> &mdash; auto-configures all endpoints</p>
                </div>
            </div>
            <div class="checklist-item">
                <div class="checklist-box"></div>
                <div>
                    <p class="font-semibold text-gray-900 dark:text-white">JWKS Endpoint</p>
                    <p class="text-sm text-gray-500 dark:text-gray-400">For OIDC token (JWT) signature verification</p>
                </div>
            </div>
            <div class="checklist-item">
                <div class="checklist-box"></div>
                <div>
                    <p class="font-semibold text-gray-900 dark:text-white">Test User Accounts</p>
                    <p class="text-sm text-gray-500 dark:text-gray-400">For UAT environment testing</p>
                </div>
            </div>
            <div class="checklist-item" style="border-bottom: none;">
                <div class="checklist-box"></div>
                <div>
                    <p class="font-semibold text-gray-900 dark:text-white">Technical Contact</p>
                    <p class="text-sm text-gray-500 dark:text-gray-400">For integration support during development</p>
                </div>
            </div>
        </div>
    </div>
</section>

{# ===== SECTION 6: WHAT CRUSH.LU PROVIDES ===== #}
<section id="from-crush" class="scroll-mt-20">
    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3">
        <span class="flex items-center justify-center w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-blue-500 text-white text-lg font-bold">6</span>
        What Crush.lu Provides to POST
    </h2>
    <p class="text-gray-600 dark:text-gray-400 mb-4 text-sm">Reference: Annex G1 &sect;6.2</p>

    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden border border-gray-200 dark:border-gray-700">
        <div class="divide-y divide-gray-100 dark:divide-gray-700/50">
            <div class="px-6 py-4 flex items-start gap-4">
                <span class="text-purple-500 mt-0.5">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                </span>
                <div>
                    <p class="font-semibold text-gray-900 dark:text-white">Technical Contact</p>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Name, email, phone number</p>
                </div>
            </div>
            <div class="px-6 py-4 flex items-start gap-4">
                <span class="text-purple-500 mt-0.5">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
                </span>
                <div>
                    <p class="font-semibold text-gray-900 dark:text-white">Application Name &amp; Logo</p>
                    <p class="text-sm text-gray-600 dark:text-gray-400"><strong>Crush.lu</strong> + application logo file</p>
                </div>
            </div>
            <div class="px-6 py-4 flex items-start gap-4">
                <span class="text-purple-500 mt-0.5">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                </span>
                <div>
                    <p class="font-semibold text-gray-900 dark:text-white">Required Attributes</p>
                    <p class="text-sm text-gray-600 dark:text-gray-400">
                        <strong>Mandatory:</strong> sub, email, email_verified, given_name, family_name, birthdate, gender<br>
                        <strong>Optional:</strong> phone_number, locale, picture
                    </p>
                </div>
            </div>
            <div class="px-6 py-4 flex items-start gap-4">
                <span class="text-purple-500 mt-0.5">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                </span>
                <div>
                    <p class="font-semibold text-gray-900 dark:text-white">Privacy &amp; Terms Links</p>
                    <p class="text-sm text-gray-600 dark:text-gray-400">
                        Privacy: <code class="bg-gray-100 dark:bg-gray-700 px-1 rounded text-xs">/en/privacy/</code> <code class="bg-gray-100 dark:bg-gray-700 px-1 rounded text-xs">/de/privacy/</code> <code class="bg-gray-100 dark:bg-gray-700 px-1 rounded text-xs">/fr/privacy/</code><br>
                        Terms &amp; Conditions link
                    </p>
                </div>
            </div>
            <div class="px-6 py-4 flex items-start gap-4">
                <span class="text-purple-500 mt-0.5">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/></svg>
                </span>
                <div>
                    <p class="font-semibold text-gray-900 dark:text-white">Authentication Protocol</p>
                    <p class="text-sm text-gray-600 dark:text-gray-400"><strong>OIDC</strong> with <strong>PKCE</strong> (Authorization Code + PKCE flow)</p>
                </div>
            </div>
            <div class="px-6 py-4 flex items-start gap-4">
                <span class="text-purple-500 mt-0.5">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/></svg>
                </span>
                <div>
                    <p class="font-semibold text-gray-900 dark:text-white">Callback URLs</p>
                    <div class="mt-2 space-y-2">
                        <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-3 border border-gray-200 dark:border-gray-600">
                            <p class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-1">UAT</p>
                            <code class="text-sm text-purple-700 dark:text-purple-300 break-all">{{ callback_uat }}</code>
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-3 border border-gray-200 dark:border-gray-600">
                            <p class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-1">Production</p>
                            <code class="text-sm text-purple-700 dark:text-purple-300 break-all">{{ callback_prod }}</code>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

{# ===== SECTION 7: ARCHITECTURE ===== #}
<section id="architecture" class="scroll-mt-20 print-break">
    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3">
        <span class="flex items-center justify-center w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-blue-500 text-white text-lg font-bold">7</span>
        Architecture Diagram
    </h2>

    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700 mb-6">
        {# Desktop architecture diagram #}
        <div class="hidden md:flex items-center justify-center gap-4 mb-8">
            <div class="arch-box border-blue-400 bg-blue-50 dark:bg-blue-900/20 dark:border-blue-600 text-blue-800 dark:text-blue-200">
                <div class="text-2xl mb-1">&#x1F4BB;</div>
                <div>User Browser</div>
            </div>
            <div class="arch-arrow">
                <div class="flex flex-col items-center">
                    <span class="text-xs text-gray-500 dark:text-gray-400 mb-1">HTTPS</span>
                    <span>&rarr;</span>
                </div>
            </div>
            <div class="arch-box border-purple-400 bg-purple-50 dark:bg-purple-900/20 dark:border-purple-600 text-purple-800 dark:text-purple-200">
                <div class="text-2xl mb-1">&#x2699;&#xFE0F;</div>
                <div>Crush.lu</div>
                <div class="text-xs opacity-70">Django + Allauth</div>
            </div>
            <div class="arch-arrow">
                <div class="flex flex-col items-center">
                    <span class="text-xs text-gray-500 dark:text-gray-400 mb-1">OIDC + PKCE</span>
                    <span>&rarr;</span>
                </div>
            </div>
            <div class="arch-box border-green-400 bg-green-50 dark:bg-green-900/20 dark:border-green-600 text-green-800 dark:text-green-200">
                <div class="text-2xl mb-1">&#x1F512;</div>
                <div>LuxID OIDC</div>
                <div class="text-xs opacity-70">POST Luxembourg</div>
            </div>
        </div>

        {# Mobile architecture diagram #}
        <div class="md:hidden space-y-3 mb-8">
            <div class="arch-box border-blue-400 bg-blue-50 dark:bg-blue-900/20 dark:border-blue-600 text-blue-800 dark:text-blue-200 text-center">
                <span class="text-xl mr-2">&#x1F4BB;</span> User Browser
            </div>
            <div class="text-center text-gray-400 text-xl">&darr; <span class="text-xs">HTTPS</span> &darr;</div>
            <div class="arch-box border-purple-400 bg-purple-50 dark:bg-purple-900/20 dark:border-purple-600 text-purple-800 dark:text-purple-200 text-center">
                <span class="text-xl mr-2">&#x2699;&#xFE0F;</span> Crush.lu <span class="text-xs opacity-70">(Django + Allauth)</span>
            </div>
            <div class="text-center text-gray-400 text-xl">&darr; <span class="text-xs">OIDC + PKCE</span> &darr;</div>
            <div class="arch-box border-green-400 bg-green-50 dark:bg-green-900/20 dark:border-green-600 text-green-800 dark:text-green-200 text-center">
                <span class="text-xl mr-2">&#x1F512;</span> LuxID OIDC <span class="text-xs opacity-70">(POST Luxembourg)</span>
            </div>
        </div>

        {# Token response flow #}
        <div class="bg-gray-50 dark:bg-gray-700/30 rounded-lg p-4 border border-gray-200 dark:border-gray-600 mb-6">
            <div class="text-center text-sm text-gray-600 dark:text-gray-400">
                <p class="font-semibold text-gray-900 dark:text-white mb-2">Token Response (JWT)</p>
                <code class="text-xs bg-gray-900 dark:bg-gray-950 text-green-400 px-3 py-2 rounded-lg inline-block">
                    LuxID &rarr; JWT (id_token + access_token + user attributes) &rarr; Crush.lu &rarr; Create/Login User
                </code>
            </div>
        </div>

        <div class="bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4 border border-amber-200 dark:border-amber-800">
            <h4 class="font-semibold text-amber-800 dark:text-amber-200 mb-2">LuxID Infrastructure (Annex G1 &sect;4.1)</h4>
            <div class="flex flex-wrap gap-2">
                <span class="px-3 py-1 rounded-full text-xs font-medium bg-amber-100 dark:bg-amber-900/40 text-amber-700 dark:text-amber-300">Firewall</span>
                <span class="px-3 py-1 rounded-full text-xs font-medium bg-amber-100 dark:bg-amber-900/40 text-amber-700 dark:text-amber-300">Anti-DDoS</span>
                <span class="px-3 py-1 rounded-full text-xs font-medium bg-amber-100 dark:bg-amber-900/40 text-amber-700 dark:text-amber-300">WAF</span>
                <span class="px-3 py-1 rounded-full text-xs font-medium bg-amber-100 dark:bg-amber-900/40 text-amber-700 dark:text-amber-300">Load Balancers</span>
                <span class="px-3 py-1 rounded-full text-xs font-medium bg-amber-100 dark:bg-amber-900/40 text-amber-700 dark:text-amber-300">ISO 27001</span>
            </div>
        </div>
    </div>
</section>

{# ===== SECTION 8: PRICING ===== #}
<section id="pricing" class="scroll-mt-20">
    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3">
        <span class="flex items-center justify-center w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-blue-500 text-white text-lg font-bold">8</span>
        Pricing Overview (Annex C3)
    </h2>

    <div class="grid md:grid-cols-3 gap-6">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border-2 border-green-400 dark:border-green-500 relative">
            <div class="absolute -top-3 left-4">
                <span class="px-3 py-1 rounded-full text-xs font-bold bg-green-500 text-white">Crush.lu Tier</span>
            </div>
            <div class="text-center mt-2">
                <p class="text-sm text-gray-500 dark:text-gray-400 mb-2">&lt; 1,000 Users</p>
                <p class="text-4xl font-bold text-green-600 dark:text-green-400">Free</p>
                <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">No cost for initial rollout</p>
            </div>
        </div>
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700">
            <div class="text-center">
                <p class="text-sm text-gray-500 dark:text-gray-400 mb-2">1,000 &ndash; 50,000 Users</p>
                <p class="text-4xl font-bold text-gray-900 dark:text-white">&euro;0.50</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">/user/year</p>
            </div>
        </div>
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700">
            <div class="text-center">
                <p class="text-sm text-gray-500 dark:text-gray-400 mb-2">&gt; 50,000 Users</p>
                <p class="text-4xl font-bold text-gray-900 dark:text-white">&euro;25k</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">flat/year</p>
            </div>
        </div>
    </div>
    <p class="text-sm text-gray-500 dark:text-gray-400 mt-4">Based on peak unique signups across all Client Applications per 12-month period.</p>
</section>

{# ===== SECTION 9: SLA ===== #}
<section id="sla" class="scroll-mt-20 print-break">
    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3">
        <span class="flex items-center justify-center w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-blue-500 text-white text-lg font-bold">9</span>
        SLA Highlights (Annex C2)
    </h2>

    <div class="grid md:grid-cols-2 gap-6">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700">
            <h3 class="font-bold text-gray-900 dark:text-white mb-4">Availability</h3>
            <div class="text-center mb-4">
                <p class="text-5xl font-bold text-green-600 dark:text-green-400">99.90%</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">quarterly measurement</p>
            </div>
            <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-2">
                <li class="flex items-start gap-2">
                    <svg class="w-4 h-4 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                    Measured quarterly
                </li>
                <li class="flex items-start gap-2">
                    <svg class="w-4 h-4 text-green-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                    Excludes scheduled maintenance
                </li>
            </ul>
        </div>
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700">
            <h3 class="font-bold text-gray-900 dark:text-white mb-4">Incident Response</h3>
            <div class="space-y-3">
                <div class="flex justify-between items-center py-2 border-b border-gray-100 dark:border-gray-700">
                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">P1 Response</span>
                    <span class="font-bold text-red-600 dark:text-red-400">15 min</span>
                </div>
                <div class="flex justify-between items-center py-2 border-b border-gray-100 dark:border-gray-700">
                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">P1 Intervention</span>
                    <span class="font-bold text-orange-600 dark:text-orange-400">1 hour</span>
                </div>
                <div class="flex justify-between items-center py-2 border-b border-gray-100 dark:border-gray-700">
                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Support Hours</span>
                    <span class="text-sm text-gray-600 dark:text-gray-400">Business Days</span>
                </div>
            </div>
            <div class="mt-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg p-3">
                <p class="text-sm text-gray-600 dark:text-gray-400">
                    <strong>Contact:</strong> 2424 3030 &middot; <a href="mailto:servicedesk@post.lu" class="text-purple-600 dark:text-purple-400 hover:underline">servicedesk@post.lu</a>
                </p>
            </div>
        </div>
    </div>
</section>

{# ===== SECTION 10: CONTRACTUAL ===== #}
<section id="contractual" class="scroll-mt-20">
    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3">
        <span class="flex items-center justify-center w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-blue-500 text-white text-lg font-bold">10</span>
        Key Contractual Points
    </h2>

    <div class="grid md:grid-cols-2 gap-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg p-5 border border-gray-200 dark:border-gray-700 flex items-start gap-3">
            <span class="text-2xl flex-shrink-0">&#x1F6E1;&#xFE0F;</span>
            <div>
                <p class="font-semibold text-gray-900 dark:text-white">GDPR Compliant</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">Separate data controllers (Clause 14)</p>
            </div>
        </div>
        <div class="bg-white dark:bg-gray-800 rounded-lg p-5 border border-gray-200 dark:border-gray-700 flex items-start gap-3">
            <span class="text-2xl flex-shrink-0">&#x1F3DB;&#xFE0F;</span>
            <div>
                <p class="font-semibold text-gray-900 dark:text-white">ISO 27001 Certified</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">Infrastructure security (Annex G2)</p>
            </div>
        </div>
        <div class="bg-white dark:bg-gray-800 rounded-lg p-5 border border-gray-200 dark:border-gray-700 flex items-start gap-3">
            <span class="text-2xl flex-shrink-0">&#x1F6AB;</span>
            <div>
                <p class="font-semibold text-gray-900 dark:text-white">No Data Resale</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">Ethical Code (Annex P1)</p>
            </div>
        </div>
        <div class="bg-white dark:bg-gray-800 rounded-lg p-5 border border-gray-200 dark:border-gray-700 flex items-start gap-3">
            <span class="text-2xl flex-shrink-0">&#x2696;&#xFE0F;</span>
            <div>
                <p class="font-semibold text-gray-900 dark:text-white">Luxembourg Law</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">Governing law (Clause 22)</p>
            </div>
        </div>
        <div class="bg-white dark:bg-gray-800 rounded-lg p-5 border border-gray-200 dark:border-gray-700 flex items-start gap-3">
            <span class="text-2xl flex-shrink-0">&#x1F4C5;</span>
            <div>
                <p class="font-semibold text-gray-900 dark:text-white">3-Month Termination Notice</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">Clause 19.2</p>
            </div>
        </div>
        <div class="bg-white dark:bg-gray-800 rounded-lg p-5 border border-gray-200 dark:border-gray-700 flex items-start gap-3">
            <span class="text-2xl flex-shrink-0">&#x1F50D;</span>
            <div>
                <p class="font-semibold text-gray-900 dark:text-white">Compliance Checks</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">POST can verify integration (Clause 3.4)</p>
            </div>
        </div>
    </div>
</section>

{# ===== SECTION 11: TIMELINE ===== #}
<section id="timeline" class="scroll-mt-20 print-break">
    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3">
        <span class="flex items-center justify-center w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-blue-500 text-white text-lg font-bold">11</span>
        Timeline &amp; Next Steps
    </h2>

    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700">
        <div class="space-y-6">
            <div class="flex gap-4">
                <div class="flex flex-col items-center">
                    <div class="w-10 h-10 rounded-full bg-purple-600 text-white flex items-center justify-center font-bold text-sm">1</div>
                    <div class="w-0.5 flex-1 bg-purple-200 dark:bg-purple-800 mt-2"></div>
                </div>
                <div class="pb-6">
                    <p class="font-bold text-gray-900 dark:text-white">Sign CIAM Agreement &amp; Receive UAT Credentials</p>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Week 1&ndash;2</p>
                    <p class="text-sm text-gray-600 dark:text-gray-300 mt-1">Finalize contract, receive Client ID/Secret and discovery endpoint for UAT</p>
                </div>
            </div>
            <div class="flex gap-4">
                <div class="flex flex-col items-center">
                    <div class="w-10 h-10 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold text-sm">2</div>
                    <div class="w-0.5 flex-1 bg-blue-200 dark:bg-blue-800 mt-2"></div>
                </div>
                <div class="pb-6">
                    <p class="font-bold text-gray-900 dark:text-white">Implement OIDC Integration in Dev</p>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Week 2&ndash;3</p>
                    <p class="text-sm text-gray-600 dark:text-gray-300 mt-1">Configure django-allauth OIDC provider, map attributes, build profile fast-track flow</p>
                </div>
            </div>
            <div class="flex gap-4">
                <div class="flex flex-col items-center">
                    <div class="w-10 h-10 rounded-full bg-teal-600 text-white flex items-center justify-center font-bold text-sm">3</div>
                    <div class="w-0.5 flex-1 bg-teal-200 dark:bg-teal-800 mt-2"></div>
                </div>
                <div class="pb-6">
                    <p class="font-bold text-gray-900 dark:text-white">Test on UAT with Test Users</p>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Week 3&ndash;4</p>
                    <p class="text-sm text-gray-600 dark:text-gray-300 mt-1">End-to-end testing with POST-provided test accounts, verify attribute mapping</p>
                </div>
            </div>
            <div class="flex gap-4">
                <div class="flex flex-col items-center">
                    <div class="w-10 h-10 rounded-full bg-green-600 text-white flex items-center justify-center font-bold text-sm">4</div>
                </div>
                <div>
                    <p class="font-bold text-gray-900 dark:text-white">Production Deployment</p>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Week 4&ndash;5</p>
                    <p class="text-sm text-gray-600 dark:text-gray-300 mt-1">Deploy to production, switch to production credentials, go live</p>
                </div>
            </div>
        </div>

        <div class="mt-6 bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800">
            <p class="text-sm text-blue-800 dark:text-blue-200">
                <strong>Ongoing:</strong> Certificate rotation is transparent via the metadata endpoint (.well-known/openid-configuration).
                No manual intervention required.
            </p>
        </div>
    </div>
</section>

</div>

{# ===== FOOTER DISCLAIMER ===== #}
<div class="bg-amber-50 dark:bg-amber-900/20 border-t-2 border-amber-300 dark:border-amber-700 py-6 mt-12">
    <div class="max-w-5xl mx-auto px-4 text-center">
        <p class="text-amber-800 dark:text-amber-200 font-semibold mb-1">Internal Document &mdash; Meeting Preparation Only</p>
        <p class="text-sm text-amber-700 dark:text-amber-300">
            This page is for internal use during discussions with POST Luxembourg / LuxID.
            Content is sourced from the CIAM Agreement (all annexes). Not for public distribution.
        </p>
    </div>
</div>

{% endblock %}