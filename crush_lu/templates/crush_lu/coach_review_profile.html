{% extends 'crush_lu/base.html' %}
{% load i18n %}

{% block title %}{% trans "Review Profile" %} - Crush.lu{% endblock %}

{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="lg:col-span-2">
        <a href="{% url 'crush_lu:coach_dashboard' %}" class="inline-flex items-center gap-2 px-4 py-2 mb-4 border border-gray-300 text-gray-700 hover:bg-gray-50 font-medium rounded-lg transition-colors">
            {% include "shared/icons/arrow-left.html" with class="w-4 h-4" %}
            {% trans "Back to Dashboard" %}
        </a>

        <div class="bg-white rounded-xl shadow-sm mb-6">
            <div class="px-6 py-4 border-b border-gray-100">
                <h4 class="font-semibold mb-0">{% trans "Profile Review" %}</h4>
            </div>
            <div class="p-6">
                <h5 class="text-xl font-semibold">{{ profile.user.get_full_name }}</h5>
                <p class="text-gray-500">{{ profile.user.email }}</p>

                <hr class="my-4 border-gray-200">

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <p><strong>{% trans "Age:" %}</strong> {% if profile.age %}{{ profile.age }}{% else %}{% trans "Not set" %}{% endif %} {% if profile.date_of_birth %}({{ profile.date_of_birth }}){% endif %}</p>
                        <p><strong>{% trans "Gender:" %}</strong> {{ profile.get_gender_display|default:"Not set" }}</p>
                        <p><strong>{% trans "Location:" %}</strong> {{ profile.location|default:"Not set" }}</p>
                    </div>
                    <div>
                        <p><strong>{% trans "Phone:" %}</strong> {{ profile.phone_number|default:"Not provided" }}</p>
                        <p><strong>{% trans "Looking for:" %}</strong> {{ profile.get_looking_for_display }}</p>
                    </div>
                </div>

                <div class="mb-4">
                    <p class="flex items-center gap-2 flex-wrap">
                        <strong>{% trans "Event Languages:" %}</strong>
                        {% for lang in profile.event_languages %}
                            <span class="inline-flex items-center gap-1 px-2 py-0.5 bg-blue-100 text-blue-800 rounded-full text-xs font-medium">
                                {% if lang == 'en' %}üá¨üáß English{% elif lang == 'de' %}üá©üá™ Deutsch{% elif lang == 'fr' %}üá´üá∑ Fran√ßais{% elif lang == 'lu' %}üá±üá∫ L√´tzebuergesch{% endif %}
                            </span>
                        {% empty %}
                            <span class="text-gray-400 text-sm italic">{% trans "Not set" %}</span>
                        {% endfor %}
                    </p>
                </div>

                <hr class="my-4 border-gray-200">

                <h6 class="font-semibold mb-2">{% trans "Bio" %}</h6>
                <p class="text-gray-600 mb-4">{{ profile.bio }}</p>

                <h6 class="font-semibold mb-2">{% trans "Interests" %}</h6>
                <p class="text-gray-600 mb-4">{{ profile.interests }}</p>

                <hr class="my-4 border-gray-200">

                <h6 class="font-semibold mb-2">{% trans "Privacy Settings" %}</h6>
                <ul class="list-disc list-inside text-gray-600 mb-4">
                    <li>{% trans "Show full name:" %} {% if profile.show_full_name %}{% trans "Yes" %}{% else %}{% trans "No" %}{% endif %}</li>
                    <li>{% trans "Show exact age:" %} {% if profile.show_exact_age %}{% trans "Yes" %}{% else %}{% trans "No" %}{% endif %}</li>
                    <li>{% trans "Blur photos:" %} {% if profile.blur_photos %}{% trans "Yes" %}{% else %}{% trans "No" %}{% endif %}</li>
                </ul>

                <hr class="my-4 border-gray-200">

                <h6 class="font-semibold mb-3">{% trans "Photos" %}</h6>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {% if profile.photo_1 %}
                        <div>
                            <img src="{{ profile.photo_1.url }}" class="w-full rounded-lg" alt="Photo 1" loading="lazy">
                        </div>
                    {% endif %}
                    {% if profile.photo_2 %}
                        <div>
                            <img src="{{ profile.photo_2.url }}" class="w-full rounded-lg" alt="Photo 2" loading="lazy">
                        </div>
                    {% endif %}
                    {% if profile.photo_3 %}
                        <div>
                            <img src="{{ profile.photo_3.url }}" class="w-full rounded-lg" alt="Photo 3" loading="lazy">
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div class="lg:col-span-1">
        <!-- Screening Call Status (HTMX-powered) -->
        {% include 'crush_lu/_screening_call_section.html' %}

        <!-- Review Decision -->
        <div class="bg-white rounded-xl shadow-lg mb-4 overflow-hidden">
            <div class="bg-gradient-to-r from-purple-600 to-pink-500 px-6 py-4">
                <h5 class="font-semibold text-white flex items-center gap-2">
                    {% include "shared/icons/clipboard-document-check.html" with class="w-5 h-5" %}
                    {% trans "Review Decision" %}
                </h5>
            </div>
            <div class="p-6">
                <form method="post">
                    {% csrf_token %}

                    <!-- Decision Status -->
                    <div class="mb-5">
                        <label for="{{ form.status.id_for_label }}" class="block text-sm font-semibold text-gray-800 mb-2">
                            {% trans "Decision" %} <span class="text-red-500">*</span>
                        </label>
                        {{ form.status }}
                        <p class="mt-1.5 text-xs text-gray-500">
                            {% trans "Select the appropriate review outcome" %}
                        </p>
                    </div>

                    <!-- Internal Notes -->
                    <div class="mb-5">
                        <label for="{{ form.coach_notes.id_for_label }}" class="block text-sm font-semibold text-gray-800 mb-2">
                            {% trans "Internal Notes" %}
                            <span class="ml-1 text-xs font-normal text-gray-500">({% trans "not visible to user" %})</span>
                        </label>
                        {{ form.coach_notes }}
                        <!-- Suggestion chips for internal notes -->
                        <div class="mt-2 flex flex-wrap gap-1.5">
                            <span class="text-xs text-gray-500 mr-1">{% trans "Quick notes:" %}</span>
                            <button type="button" class="coach-note-chip px-2 py-0.5 text-xs bg-gray-100 hover:bg-purple-100 text-gray-600 hover:text-purple-700 rounded-full transition-colors" data-note="‚úì Identity verified via call">
                                ‚úì {% trans "ID verified" %}
                            </button>
                            <button type="button" class="coach-note-chip px-2 py-0.5 text-xs bg-gray-100 hover:bg-purple-100 text-gray-600 hover:text-purple-700 rounded-full transition-colors" data-note="‚úì Photos match person on call">
                                ‚úì {% trans "Photos match" %}
                            </button>
                            <button type="button" class="coach-note-chip px-2 py-0.5 text-xs bg-gray-100 hover:bg-purple-100 text-gray-600 hover:text-purple-700 rounded-full transition-colors" data-note="‚úì Genuine dating interest">
                                ‚úì {% trans "Genuine" %}
                            </button>
                            <button type="button" class="coach-note-chip px-2 py-0.5 text-xs bg-gray-100 hover:bg-red-100 text-gray-600 hover:text-red-700 rounded-full transition-colors" data-note="‚ö† Suspicious behavior">
                                ‚ö† {% trans "Suspicious" %}
                            </button>
                            <button type="button" class="coach-note-chip px-2 py-0.5 text-xs bg-gray-100 hover:bg-red-100 text-gray-600 hover:text-red-700 rounded-full transition-colors" data-note="‚ö† Photos unclear/edited">
                                ‚ö† {% trans "Photo issues" %}
                            </button>
                        </div>
                    </div>

                    <!-- Feedback to User -->
                    <div class="mb-6">
                        <label for="{{ form.feedback_to_user.id_for_label }}" class="block text-sm font-semibold text-gray-800 mb-2">
                            {% trans "Feedback to User" %}
                            <span class="ml-1 text-xs font-normal text-gray-500">({% trans "visible if rejected/revision" %})</span>
                        </label>
                        {{ form.feedback_to_user }}
                        <!-- Suggestion chips for user feedback -->
                        <div class="mt-2 flex flex-wrap gap-1.5">
                            <span class="text-xs text-gray-500 mr-1">{% trans "Templates:" %}</span>
                            <button type="button" class="feedback-chip px-2 py-0.5 text-xs bg-green-50 hover:bg-green-100 text-green-700 rounded-full transition-colors" data-feedback="Welcome to Crush.lu! Your profile looks great and we're excited to have you join our community. See you at an upcoming event! üíú">
                                ‚úì {% trans "Welcome" %}
                            </button>
                            <button type="button" class="feedback-chip px-2 py-0.5 text-xs bg-amber-50 hover:bg-amber-100 text-amber-700 rounded-full transition-colors" data-feedback="Please upload a clearer profile photo where your face is clearly visible. This helps other members recognize you at events.">
                                üì∑ {% trans "Better photo" %}
                            </button>
                            <button type="button" class="feedback-chip px-2 py-0.5 text-xs bg-amber-50 hover:bg-amber-100 text-amber-700 rounded-full transition-colors" data-feedback="Please add more details to your bio - tell us about your interests, hobbies, or what you're looking for.">
                                ‚úèÔ∏è {% trans "More bio" %}
                            </button>
                        </div>
                    </div>

                    <button type="submit" class="w-full bg-gradient-to-r from-purple-600 to-pink-500 hover:from-purple-700 hover:to-pink-600 text-white font-semibold py-3 px-6 rounded-lg transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-2">
                        {% include "shared/icons/check-circle.html" with class="w-5 h-5" %}
                        {% trans "Submit Review" %}
                    </button>
                </form>
            </div>
        </div>

        <!-- Review Guidelines -->
        <div class="bg-white rounded-xl shadow-sm overflow-hidden">
            <div class="bg-blue-50 px-6 py-3 border-b border-blue-100">
                <h6 class="font-semibold text-blue-800 flex items-center gap-2">
                    {% include "shared/icons/information-circle.html" with class="w-4 h-4" %}
                    {% trans "Review Guidelines" %}
                </h6>
            </div>
            <div class="p-5">
                <ul class="text-sm text-gray-600 space-y-2">
                    <li class="flex items-start gap-2">
                        <span class="text-yellow-500 mt-0.5">{% include "shared/icons/exclamation-triangle.html" with class="w-4 h-4" %}</span>
                        <span><strong>{% trans "Complete screening call first!" %}</strong></span>
                    </li>
                    <li class="flex items-start gap-2">
                        <span class="text-green-500 mt-0.5">{% include "shared/icons/check.html" with class="w-4 h-4" %}</span>
                        <span>{% trans "Verify photos are clear and appropriate" %}</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <span class="text-green-500 mt-0.5">{% include "shared/icons/check.html" with class="w-4 h-4" %}</span>
                        <span>{% trans "Ensure bio is genuine and respectful" %}</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <span class="text-green-500 mt-0.5">{% include "shared/icons/check.html" with class="w-4 h-4" %}</span>
                        <span>{% trans "Confirm age verification (18+)" %}</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <span class="text-red-500 mt-0.5">{% include "shared/icons/x-mark.html" with class="w-4 h-4" %}</span>
                        <span>{% trans "Look for red flags or suspicious content" %}</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script nonce="{{ request.csp_nonce }}">
// Quick note chips - append to internal notes textarea
document.querySelectorAll('.coach-note-chip').forEach(function(chip) {
    chip.addEventListener('click', function() {
        var textarea = document.getElementById('id_coach_notes');
        var note = this.getAttribute('data-note');
        if (textarea.value && !textarea.value.endsWith('\n') && !textarea.value.endsWith(' ')) {
            textarea.value += '\n';
        }
        textarea.value += note + '\n';
        textarea.focus();
    });
});

// Feedback template chips - replace feedback textarea content
document.querySelectorAll('.feedback-chip').forEach(function(chip) {
    chip.addEventListener('click', function() {
        var textarea = document.getElementById('id_feedback_to_user');
        var feedback = this.getAttribute('data-feedback');
        textarea.value = feedback;
        textarea.focus();
    });
});
</script>
{% endblock %}
