{% extends 'crush_lu/base.html' %}

{% block title %}Review Profile - Crush.lu{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8">
        <a href="{% url 'crush_lu:coach_dashboard' %}" class="btn btn-outline-secondary mb-3">
            ‚Üê Back to Dashboard
        </a>

        <div class="card mb-4">
            <div class="card-header">
                <h4 class="mb-0">Profile Review</h4>
            </div>
            <div class="card-body">
                <h5>{{ profile.user.get_full_name }}</h5>
                <p class="text-muted">{{ profile.user.email }}</p>

                <hr>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <p><strong>Age:</strong> {{ profile.age }} ({{ profile.date_of_birth }})</p>
                        <p><strong>Gender:</strong> {{ profile.get_gender_display }}</p>
                        <p><strong>Location:</strong> {{ profile.location }}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Phone:</strong> {{ profile.phone_number|default:"Not provided" }}</p>
                        <p><strong>Looking for:</strong> {{ profile.get_looking_for_display }}</p>
                    </div>
                </div>

                <hr>

                <h6>Bio</h6>
                <p>{{ profile.bio }}</p>

                <h6>Interests</h6>
                <p>{{ profile.interests }}</p>

                <hr>

                <h6>Privacy Settings</h6>
                <ul>
                    <li>Show full name: {% if profile.show_full_name %}Yes{% else %}No{% endif %}</li>
                    <li>Show exact age: {% if profile.show_exact_age %}Yes{% else %}No{% endif %}</li>
                    <li>Blur photos: {% if profile.blur_photos %}Yes{% else %}No{% endif %}</li>
                </ul>

                <hr>

                <h6>Photos</h6>
                <div class="row">
                    {% if profile.photo_1 %}
                        <div class="col-md-4 mb-3">
                            <img src="{{ profile.photo_1.url }}" class="img-fluid rounded" alt="Photo 1">
                        </div>
                    {% endif %}
                    {% if profile.photo_2 %}
                        <div class="col-md-4 mb-3">
                            <img src="{{ profile.photo_2.url }}" class="img-fluid rounded" alt="Photo 2">
                        </div>
                    {% endif %}
                    {% if profile.photo_3 %}
                        <div class="col-md-4 mb-3">
                            <img src="{{ profile.photo_3.url }}" class="img-fluid rounded" alt="Photo 3">
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <!-- Screening Call Status -->
        <div class="card mb-3">
            <div class="card-header {% if submission.review_call_completed %}bg-success text-white{% else %}bg-warning text-dark{% endif %}">
                <h6 class="mb-0">
                    {% if submission.review_call_completed %}
                        ‚úÖ Screening Call Completed
                    {% else %}
                        ‚ö†Ô∏è Screening Call Required
                    {% endif %}
                </h6>
            </div>
            <div class="card-body">
                {% if submission.review_call_completed %}
                    <p class="small mb-2"><strong>Completed:</strong> {{ submission.review_call_date|date:"M d, Y g:i A" }}</p>
                    <p class="small mb-0"><strong>Notes:</strong> {{ submission.review_call_notes|default:"No notes recorded" }}</p>
                {% else %}
                    <p class="small mb-3">üìû You must complete a screening call with <strong>{{ profile.user.first_name }}</strong> before approving this profile.</p>
                    <p class="small mb-2"><strong>Phone:</strong> {{ profile.phone_number }}</p>
                    <form method="post" action="{% url 'crush_lu:coach_mark_review_call_complete' submission.id %}">
                        {% csrf_token %}
                        <div class="mb-3">
                            <label class="form-label small">Call Notes:</label>
                            <textarea name="call_notes" class="form-control form-control-sm" rows="3" placeholder="Notes from screening call..." required></textarea>
                        </div>
                        <button type="submit" class="btn btn-sm btn-success w-100">Mark Call Complete</button>
                    </form>
                {% endif %}
            </div>
        </div>

        <!-- Review Decision -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Review Decision</h5>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}

                    <div class="mb-3">
                        <label for="{{ form.status.id_for_label }}" class="form-label">Decision *</label>
                        {{ form.status }}
                    </div>

                    <div class="mb-3">
                        <label for="{{ form.coach_notes.id_for_label }}" class="form-label">
                            Internal Notes (not visible to user)
                        </label>
                        {{ form.coach_notes }}
                    </div>

                    <div class="mb-4">
                        <label for="{{ form.feedback_to_user.id_for_label }}" class="form-label">
                            Feedback to User (visible if rejected/revision)
                        </label>
                        {{ form.feedback_to_user }}
                    </div>

                    <button type="submit" class="btn btn-crush-primary w-100">
                        Submit Review
                    </button>
                </form>
            </div>
        </div>

        <div class="card mt-3">
            <div class="card-body">
                <h6>Review Guidelines</h6>
                <ul class="small mb-0">
                    <li><strong>Complete screening call first!</strong></li>
                    <li>Check for appropriate content</li>
                    <li>Verify photos are clear and appropriate</li>
                    <li>Ensure bio is genuine and respectful</li>
                    <li>Confirm age verification (18+)</li>
                    <li>Look for red flags or suspicious content</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<style>
    select, textarea {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid #ddd;
        border-radius: 5px;
    }
</style>
{% endblock %}
