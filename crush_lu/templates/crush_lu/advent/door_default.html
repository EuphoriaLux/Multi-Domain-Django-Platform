{% extends 'crush_lu/advent/advent_base.html' %}
{% load static i18n %}

{% block title %}{% blocktrans with num=door_number %}Door {{ num }}{% endblocktrans %} - {{ calendar.calendar_title }}{% endblock %}

{% block advent_content %}
<div class="advent-header">
    <a href="{% url 'crush_lu:advent_calendar' %}" class="advent-back-btn">
        {% include "shared/icons/arrow-left.html" with class="w-5 h-5" %} {% trans "Back to Calendar" %}
    </a>
</div>

<div class="advent-content">
    <div class="container">
        <div class="door-content-card">
            <!-- Door number badge -->
            <div class="door-badge mb-4">
                <span class="badge bg-danger fs-4 px-4 py-2">{% blocktrans with num=door_number %}Day {{ num }}{% endblocktrans %}</span>
            </div>

            {% if was_newly_opened %}
                <div class="newly-opened-message text-center mb-4">
                    <span style="font-size: 3rem;">‚ú®</span>
                    <h3 class="text-success">{% trans "Congratulations!" %}</h3>
                    <p class="text-muted">{% blocktrans with num=door_number %}You've opened Door {{ num }}!{% endblocktrans %}</p>
                </div>
            {% endif %}

            {% if content %}
                <h2 class="text-center mb-4">{{ content.title }}</h2>

                {% if content.message %}
                    <div class="door-message">
                        {{ content.message|linebreaks }}
                    </div>
                {% endif %}

                {% if content.photo %}
                    <div class="door-photo text-center my-4">
                        <img src="{{ content.photo.url }}" alt="{{ content.title }}"
                             class="img-fluid rounded shadow" style="max-height: 400px;">
                    </div>
                {% endif %}

                {% if content.video_file %}
                    <div class="door-video my-4">
                        <video controls class="w-100 rounded shadow">
                            <source src="{{ content.video_file.url }}" type="video/mp4">
                            {% trans "Your browser does not support the video tag." %}
                        </video>
                    </div>
                {% endif %}

                {% if content.audio_file %}
                    <div class="door-audio my-4 text-center">
                        <audio controls class="w-100">
                            <source src="{{ content.audio_file.url }}" type="audio/mpeg">
                            {% trans "Your browser does not support the audio element." %}
                        </audio>
                    </div>
                {% endif %}

                <!-- Bonus content (if QR scanned) -->
                {% if show_bonus and content.has_bonus_content %}
                    <div class="bonus-content">
                        {% if content.bonus_title %}
                            <h4>{{ content.bonus_title }}</h4>
                        {% else %}
                            <h4>{% trans "Bonus Unlocked!" %}</h4>
                        {% endif %}

                        {% if content.bonus_content %}
                            <div class="bonus-message">
                                {{ content.bonus_content|linebreaks }}
                            </div>
                        {% endif %}

                        {% if content.bonus_photo %}
                            <div class="bonus-photo text-center mt-3">
                                <img src="{{ content.bonus_photo.url }}" alt="{% trans "Bonus" %}"
                                     class="img-fluid rounded" style="max-height: 300px;">
                            </div>
                        {% endif %}
                    </div>
                {% elif has_qr_bonus and not show_bonus %}
                    <!-- Show hint about bonus content -->
                    <div class="bonus-hint text-center mt-4 p-3 rounded-xl border-2 border-dashed border-yellow-400 dark:border-yellow-600 bg-yellow-50 dark:bg-yellow-900/20">
                        <span style="font-size: 2rem;">üéÅ</span>
                        <p class="mb-0 mt-2">
                            <strong>{% trans "Bonus content available!" %}</strong><br>
                            <small class="text-muted">{% trans "Scan the QR code on your physical gift to unlock!" %}</small>
                        </p>
                    </div>
                {% endif %}

            {% else %}
                <div class="no-content text-center py-5">
                    <span style="font-size: 3rem;">üéÅ</span>
                    <h3 class="mt-3">{% trans "Content Coming Soon!" %}</h3>
                    <p class="text-muted">{% trans "This door's content is being prepared..." %}</p>
                </div>
            {% endif %}

            <!-- Navigation buttons -->
            <div class="door-navigation flex justify-between mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                {% if door_number > 1 %}
                    <a href="{% url 'crush_lu:advent_door' door_number|add:'-1' %}" class="inline-flex items-center gap-1 px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 font-medium rounded-lg transition-colors">
                        {% include "shared/icons/arrow-left.html" with class="w-5 h-5" %} {% trans "Previous" %}
                    </a>
                {% else %}
                    <span></span>
                {% endif %}

                <a href="{% url 'crush_lu:advent_calendar' %}" class="btn-crush-primary inline-flex items-center gap-1 px-4 py-2">
                    {% include "shared/icons/squares-2x2.html" with class="w-5 h-5" %} {% trans "Calendar" %}
                </a>

                {% if door_number < 24 %}
                    <a href="{% url 'crush_lu:advent_door' door_number|add:'1' %}" class="inline-flex items-center gap-1 px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 font-medium rounded-lg transition-colors">
                        {% trans "Next" %} {% include "shared/icons/arrow-right.html" with class="w-5 h-5" %}
                    </a>
                {% else %}
                    <span></span>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<style>
    .door-badge {
        text-align: center;
    }

    .door-message {
        font-size: 1.1rem;
        line-height: 1.8;
        color: #333;
    }

    html.dark .door-message {
        color: #d1d5db;
    }

    .newly-opened-message {
        animation: fadeInUp 0.5s ease-out;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .bonus-hint {
        animation: pulse 2s infinite;
    }
</style>
{% endblock %}
