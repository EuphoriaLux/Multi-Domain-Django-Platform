{% extends 'crush_lu/base.html' %}
{% load static i18n %}

{% block title %}{% trans "Crush Sparks - Coach" %}{% endblock %}
{% block meta_robots %}noindex, nofollow{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="mb-6">
        <a href="{% url 'crush_lu:coach_dashboard' %}" class="text-purple-600 dark:text-purple-400 hover:underline text-sm">
            &larr; {% trans "Back to Dashboard" %}
        </a>
    </div>

    <div class="text-center mb-8">
        <h1 class="text-3xl font-bold mb-3">{% trans "Crush Spark Reviews" %}</h1>
        <p class="text-lg text-gray-500 dark:text-gray-400">{% trans "Review and approve spark requests" %}</p>
    </div>

    <!-- Pending Reviews -->
    <div class="mb-8">
        <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
            <span class="badge badge-warning">{{ pending_sparks|length }}</span>
            <span>{% trans "Pending Review" %}</span>
        </h2>

        {% if pending_sparks %}
            <div class="space-y-4">
                {% for spark in pending_sparks %}
                <div class="card card-bordered">
                    <div class="card-body">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="text-sm text-gray-500 dark:text-gray-400">{% trans "From:" %}</span>
                                    <span class="font-semibold">{{ spark.sender_display_name }}</span>
                                </div>
                                {% if spark.recipient %}
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="text-sm text-gray-500 dark:text-gray-400">{% trans "To:" %}</span>
                                    <span class="font-semibold">{{ spark.recipient_display_name }}</span>
                                </div>
                                {% endif %}
                                <div class="mb-2">
                                    <span class="text-sm text-gray-500 dark:text-gray-400">{% trans "Event:" %}</span>
                                    <span>{{ spark.event.title }} ({{ spark.event.date_time|date:"M d" }})</span>
                                </div>
                                {% if spark.sender_description %}
                                <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-3">
                                    <p class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">{% trans "Description:" %}</p>
                                    <p class="text-gray-600 dark:text-gray-400">{{ spark.sender_description }}</p>
                                </div>
                                {% endif %}
                            </div>
                            <div class="ml-4">
                                <a href="{% url 'crush_lu:coach_spark_assign' spark.id %}" class="btn btn-primary btn-sm">
                                    {% if spark.recipient %}
                                        {% trans "Review" %}
                                    {% else %}
                                        {% trans "Assign" %}
                                    {% endif %}
                                </a>
                            </div>
                        </div>
                        <p class="text-xs text-gray-400 dark:text-gray-500 mt-2">
                            {% trans "Submitted" %} {{ spark.created_at|timesince }} {% trans "ago" %}
                        </p>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="card">
                <div class="card-body text-center py-8">
                    <p class="text-gray-500 dark:text-gray-400">{% trans "No pending spark reviews." %}</p>
                </div>
            </div>
        {% endif %}
    </div>

    <!-- Recent Activity -->
    {% if recent_sparks %}
    <div>
        <h2 class="text-xl font-semibold mb-4">{% trans "Recent Activity" %}</h2>
        <div class="space-y-3">
            {% for spark in recent_sparks %}
            <div class="card">
                <div class="card-body py-3">
                    <div class="flex items-center justify-between text-sm">
                        <div>
                            <span class="font-semibold">{{ spark.sender_display_name }}</span>
                            <span class="text-gray-400 dark:text-gray-500 mx-1">&rarr;</span>
                            <span class="font-semibold">{{ spark.recipient_display_name }}</span>
                            <span class="text-gray-400 dark:text-gray-500 ml-2">{{ spark.event.title }}</span>
                        </div>
                        {% include 'crush_lu/_spark_status_badge.html' %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
