{% extends "base.html" %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'entreprinder/css/pages/finops.css' %}">
<style>
    :root {
        --primary-red: #dc3545;
        --dark-red: #b02a37;
        --light-red: #f8d7da;
        --grey: #666666;
        --dark-grey: #4a4a4a;
        --light-grey: #e8e8e8;
    }

    .faq-section {
        margin-bottom: 3rem;
    }

    /* Header styling */
    .breadcrumb-item a {
        color: var(--primary-red);
        text-decoration: none;
    }
    .breadcrumb-item a:hover {
        color: var(--dark-red);
        text-decoration: underline;
    }

    h1.h2 {
        color: var(--dark-grey);
    }

    /* Status banner */
    .alert-info {
        background: linear-gradient(135deg, var(--light-grey) 0%, #f5f5f5 100%);
        border: 2px solid var(--grey);
        border-left: 5px solid var(--primary-red);
        color: var(--dark-grey);
    }
    .alert-info strong {
        color: var(--primary-red);
    }

    /* Flow diagram */
    .flow-diagram {
        background: linear-gradient(135deg, var(--grey) 0%, var(--dark-grey) 100%);
        color: white;
        border-radius: 15px;
        padding: 2.5rem;
        margin: 2rem 0;
        box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    }

    .flow-diagram h3 {
        color: white;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .flow-step {
        background: rgba(255,255,255,0.12);
        border-radius: 10px;
        padding: 1.5rem;
        margin: 1rem 0;
        border-left: 5px solid var(--primary-red);
        transition: all 0.3s ease;
    }

    .flow-step:hover {
        background: rgba(255,255,255,0.18);
        transform: translateX(5px);
    }

    .flow-step h4 {
        color: white;
        font-weight: bold;
        margin-bottom: 1rem;
    }

    .flow-step i {
        color: var(--primary-red);
        margin-right: 0.5rem;
        font-size: 1.3rem;
    }

    .flow-step code {
        background: rgba(0,0,0,0.3);
        color: #ffc107;
        padding: 0.2rem 0.5rem;
        border-radius: 4px;
    }

    .flow-arrow {
        text-align: center;
        font-size: 2.5rem;
        color: var(--primary-red);
        margin: 0.5rem 0;
        text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    /* Accordion styling */
    .accordion-button {
        background-color: var(--light-grey);
        color: var(--dark-grey);
        font-weight: 600;
    }

    .accordion-button:not(.collapsed) {
        background-color: var(--primary-red);
        color: white;
        box-shadow: inset 0 -1px 0 rgba(0,0,0,0.125);
    }

    .accordion-button:focus {
        border-color: var(--primary-red);
        box-shadow: 0 0 0 0.25rem rgba(220, 53, 69, 0.25);
    }

    .accordion-button::after {
        filter: brightness(0) saturate(100%);
    }

    .accordion-button:not(.collapsed)::after {
        filter: brightness(0) invert(1);
    }

    .accordion-item {
        border: 1px solid var(--grey);
        margin-bottom: 0.5rem;
        border-radius: 8px !important;
        overflow: hidden;
    }

    .accordion-body h5 {
        color: var(--primary-red);
        font-weight: bold;
        margin-top: 1.5rem;
    }

    /* Alert boxes in accordion */
    .accordion-body .alert-warning {
        background-color: #fff3cd;
        border-left: 4px solid #ffc107;
        color: var(--dark-grey);
    }

    .accordion-body .alert-info {
        background-color: var(--light-grey);
        border-left: 4px solid var(--primary-red);
        color: var(--dark-grey);
    }

    .accordion-body .alert-primary {
        background-color: var(--light-red);
        border-left: 4px solid var(--primary-red);
        color: var(--dark-grey);
    }

    .accordion-body .alert-success {
        background: linear-gradient(135deg, var(--light-grey) 0%, #f5f5f5 100%);
        border: 2px solid var(--grey);
        border-left: 5px solid var(--primary-red);
        color: var(--dark-grey);
    }

    /* Tables */
    .table {
        color: var(--dark-grey);
    }

    .table thead {
        background-color: var(--grey);
        color: white;
    }

    .table-success {
        background-color: var(--light-red) !important;
    }

    /* CTA Box */
    .cta-box {
        background: linear-gradient(135deg, var(--primary-red) 0%, var(--dark-red) 100%);
        color: white;
        border-radius: 20px;
        padding: 3rem;
        text-align: center;
        box-shadow: 0 15px 50px rgba(220, 53, 69, 0.4);
        position: relative;
        overflow: hidden;
    }

    .cta-box::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        animation: pulse 4s ease-in-out infinite;
    }

    @keyframes pulse {
        0%, 100% { transform: scale(1); opacity: 0.5; }
        50% { transform: scale(1.1); opacity: 0.3; }
    }

    .cta-box h3 {
        font-size: 2rem;
        font-weight: bold;
        margin-bottom: 1rem;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        position: relative;
        z-index: 1;
    }

    .cta-box p {
        position: relative;
        z-index: 1;
        font-size: 1.1rem;
    }

    .cta-box .btn {
        font-size: 1.3rem;
        padding: 1rem 2.5rem;
        border-radius: 50px;
        font-weight: bold;
        background: white;
        color: var(--primary-red);
        border: none;
        box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        transition: all 0.3s ease;
        position: relative;
        z-index: 1;
    }

    .cta-box .btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 30px rgba(0,0,0,0.3);
        background: var(--light-grey);
        color: var(--dark-red);
    }

    /* Joke Box */
    .joke-box {
        background: linear-gradient(135deg, #fff3cd 0%, #ffe8a1 100%);
        border-left: 6px solid #ffc107;
        border-radius: 12px;
        padding: 2rem;
        margin: 2rem 0;
        box-shadow: 0 5px 20px rgba(255, 193, 7, 0.2);
    }

    .joke-box h4 {
        color: var(--dark-grey);
        font-weight: bold;
    }

    .joke-box p {
        color: var(--dark-grey);
    }

    /* Code blocks */
    .code-block {
        background: var(--dark-grey);
        color: #f8f9fa;
        border: 2px solid var(--grey);
        border-radius: 10px;
        padding: 1.5rem;
        font-family: 'Courier New', monospace;
        font-size: 0.9rem;
        overflow-x: auto;
        box-shadow: inset 0 2px 10px rgba(0,0,0,0.3);
    }

    /* Buttons */
    .btn-primary {
        background-color: var(--primary-red);
        border-color: var(--primary-red);
    }

    .btn-primary:hover {
        background-color: var(--dark-red);
        border-color: var(--dark-red);
    }

    /* Links */
    a {
        color: var(--primary-red);
    }

    a:hover {
        color: var(--dark-red);
    }

    /* Section headers */
    .faq-section h2 {
        color: var(--dark-grey);
        font-weight: bold;
        border-bottom: 3px solid var(--primary-red);
        padding-bottom: 0.5rem;
        margin-bottom: 1.5rem;
    }

    /* Icons in lists */
    .bi {
        color: var(--primary-red);
    }

    /* Back button */
    .btn-lg {
        padding: 0.8rem 2rem;
        border-radius: 50px;
        font-weight: bold;
        box-shadow: 0 5px 20px rgba(220, 53, 69, 0.3);
        transition: all 0.3s ease;
    }

    .btn-lg:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 30px rgba(220, 53, 69, 0.4);
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'finops_hub:dashboard' %}">Dashboard</a></li>
                    <li class="breadcrumb-item active" aria-current="page">FAQ & Data Flow</li>
                </ol>
            </nav>
            <h1 class="h2 mb-2">How Does FinOps Hub Work?</h1>
            <p class="text-muted">Understanding your Azure cost data journey from export to dashboard</p>
        </div>
    </div>

    <!-- Current Status Banner -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="alert alert-info d-flex align-items-center" role="alert">
                <i class="bi bi-info-circle-fill me-3" style="font-size: 1.5rem;"></i>
                <div>
                    <strong>Current Status:</strong>
                    {% if latest_export %}
                        Latest data imported from <strong>{{ latest_export.billing_period_start|date:"M d, Y" }}</strong> to
                        <strong>{{ latest_export.billing_period_end|date:"M d, Y" }}</strong>
                        <br>
                        <small class="text-muted">Tracking {{ subscriptions_count }} subscription(s)</small>
                    {% else %}
                        No data imported yet. Please configure your Azure Cost Export first.
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Data Flow Diagram -->
    <section class="faq-section">
        <h2 class="h3 mb-4">The Complete Data Journey</h2>
        <div class="flow-diagram">
            <h3 class="mb-4 text-center">From Azure to Your Dashboard</h3>

            <div class="flow-step">
                <h4><i class="bi bi-cloud"></i> Step 1: Azure Cost Management Export</h4>
                <p class="mb-2">Azure automatically generates your cost data in <strong>FOCUS format</strong> (FinOps Open Cost and Usage Specification)</p>
                <ul class="mb-0">
                    <li>Exports run on <strong>your configured schedule</strong> (daily, weekly, or monthly)</li>
                    <li>Data is stored as compressed CSV files (.csv.gz) in Azure Blob Storage</li>
                    <li>Container: <code>msexports</code></li>
                    <li>Path patterns supported:
                        <ul>
                            <li><code>partnerled/[Subscription]/[DateRange]/[GUID]/part_*.csv.gz</code></li>
                            <li><code>[Subscription]/[ExportName]/[DateRange]/[GUID]/part_*.csv.gz</code></li>
                        </ul>
                    </li>
                </ul>
            </div>

            <div class="flow-arrow">â†“</div>

            <div class="flow-step">
                <h4><i class="bi bi-download"></i> Step 2: Automatic Import (Daily Sync)</h4>
                <p class="mb-2">Our system checks for new exports and imports them automatically</p>
                <ul class="mb-0">
                    <li>Runs <strong>daily at 2:00 AM UTC</strong> via scheduled task</li>
                    <li>Scans the <code>msexports</code> container for new .csv.gz files</li>
                    <li>Downloads and decompresses files on-the-fly (no extra storage needed)</li>
                    <li>Smart detection: Only imports <strong>new or updated</strong> exports</li>
                    <li>Processes data in <strong>batches of 1,000 records</strong> for efficiency</li>
                </ul>
            </div>

            <div class="flow-arrow">â†“</div>

            <div class="flow-step">
                <h4><i class="bi bi-gear"></i> Step 3: Data Parsing & Validation</h4>
                <p class="mb-2">Raw CSV data is transformed into structured database records</p>
                <ul class="mb-0">
                    <li>Parses <strong>96 columns</strong> of FOCUS-formatted cost data</li>
                    <li>Extracts key fields: costs, dates, subscriptions, services, resources</li>
                    <li>Validates required fields: billed_cost, billing_currency, service_name, etc.</li>
                    <li>Handles multiple currencies and converts data types</li>
                    <li>Stores extended metadata as JSON for future analysis</li>
                </ul>
            </div>

            <div class="flow-arrow">â†“</div>

            <div class="flow-step">
                <h4><i class="bi bi-database"></i> Step 4: Database Storage & Indexing</h4>
                <p class="mb-2">Validated data is stored with optimized indexes for fast queries</p>
                <ul class="mb-0">
                    <li>Each cost line item becomes a <strong>CostRecord</strong> in the database</li>
                    <li>Indexed fields: dates, subscriptions, services, resource groups</li>
                    <li>Tracks import metadata: which file, when imported, status</li>
                    <li>Prevents duplicate imports using blob path tracking</li>
                </ul>
            </div>

            <div class="flow-arrow">â†“</div>

            <div class="flow-step">
                <h4><i class="bi bi-graph-up"></i> Step 5: Aggregation & Caching</h4>
                <p class="mb-2">Pre-computed summaries for lightning-fast dashboard performance</p>
                <ul class="mb-0">
                    <li>Calculates daily, weekly, and monthly cost aggregations</li>
                    <li>Groups by: subscription, service, resource group, region</li>
                    <li>Identifies top services and resources by cost</li>
                    <li>Updates aggregations after each import</li>
                </ul>
            </div>

            <div class="flow-arrow">â†“</div>

            <div class="flow-step">
                <h4><i class="bi bi-pie-chart"></i> Step 6: Dashboard Visualization</h4>
                <p class="mb-2">Real-time insights with interactive charts and filters</p>
                <ul class="mb-0">
                    <li>Displays costs across multiple time ranges (7, 30, 60, 90 days)</li>
                    <li>Breakdown by subscription, service, and resource</li>
                    <li>Cost trend analysis with daily/weekly views</li>
                    <li>Export capabilities to CSV for further analysis</li>
                </ul>
            </div>
        </div>
    </section>

    <!-- FAQ Accordian -->
    <section class="faq-section">
        <h2 class="h3 mb-4">Frequently Asked Questions</h2>

        <div class="accordion" id="faqAccordion">
            <!-- Q1 -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingOne">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                        <strong>When does the daily update run?</strong>
                    </button>
                </h2>
                <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#faqAccordion">
                    <div class="accordion-body">
                        <p>The daily sync runs at <strong>2:00 AM UTC</strong> every day. This timing is chosen to:</p>
                        <ul>
                            <li>Allow Azure Cost Management exports to complete (most run between midnight and 1 AM UTC)</li>
                            <li>Process data during low-traffic hours</li>
                            <li>Ensure fresh data is available when you start your workday</li>
                        </ul>
                        <p class="mb-2"><strong>What gets updated?</strong></p>
                        <ul class="mb-0">
                            <li>New cost export files from the last 24-48 hours</li>
                            <li>Cost aggregations and summaries</li>
                            <li>Dashboard statistics and charts</li>
                        </ul>
                        <div class="alert alert-warning mt-3 mb-0" role="alert">
                            <i class="bi bi-clock"></i> <strong>Note:</strong> Your dashboard shows data based on <em>your Azure export schedule</em>.
                            If your exports run weekly, you'll see weekly updates. If daily, you'll see daily updates.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Q2 -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingTwo">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                        <strong>How do I configure my Azure Cost Export?</strong>
                    </button>
                </h2>
                <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#faqAccordion">
                    <div class="accordion-body">
                        <p>Azure Cost Management Exports must be configured correctly for FinOps Hub to import your data.</p>

                        <h5 class="mt-3">Requirements:</h5>
                        <ul>
                            <li><strong>Export Type:</strong> Cost and usage (FOCUS format)</li>
                            <li><strong>Frequency:</strong> Daily (recommended), Weekly, or Monthly</li>
                            <li><strong>Storage Container:</strong> <code>msexports</code></li>
                            <li><strong>File Format:</strong> CSV (automatically compressed to .csv.gz)</li>
                            <li><strong>Date Range:</strong> Month-to-date or custom range</li>
                        </ul>

                        <h5 class="mt-3">Supported Path Patterns:</h5>
                        <div class="code-block mb-2">
Pattern 1: partnerled/[Subscription]/[YYYYMMDD-YYYYMMDD]/[GUID]/part_*.csv.gz
Pattern 2: [Subscription]/[ExportName]/[YYYYMMDD-YYYYMMDD]/[GUID]/part_*.csv.gz
                        </div>

                        <h5 class="mt-3">Step-by-Step Setup:</h5>
                        <ol>
                            <li>Go to <strong>Azure Portal</strong> â†’ Cost Management + Billing</li>
                            <li>Select <strong>Cost Management</strong> â†’ Exports</li>
                            <li>Click <strong>+ Add</strong> to create a new export</li>
                            <li>Configure:
                                <ul>
                                    <li>Export name: e.g., "CostFocus-Daily"</li>
                                    <li>Export type: <strong>Cost and usage (FOCUS)</strong></li>
                                    <li>Dataset version: FOCUS 1.0</li>
                                    <li>Frequency: Daily</li>
                                    <li>Storage account: Your configured storage account</li>
                                    <li>Container: <code>msexports</code></li>
                                </ul>
                            </li>
                            <li>Click <strong>Create</strong> and wait for the first export to run</li>
                        </ol>

                        <div class="alert alert-info mt-3 mb-0" role="alert">
                            <i class="bi bi-lightbulb"></i> <strong>Pro Tip:</strong> Set your export to run daily with "Month-to-date" range.
                            This gives you the most up-to-date cost data every day!
                        </div>
                    </div>
                </div>
            </div>

            <!-- Q3 -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingThree">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                        <strong>What is the FOCUS format?</strong>
                    </button>
                </h2>
                <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#faqAccordion">
                    <div class="accordion-body">
                        <p><strong>FOCUS</strong> (FinOps Open Cost and Usage Specification) is an open standard for cloud cost data, developed by the FinOps Foundation.</p>

                        <h5 class="mt-3">Why FOCUS?</h5>
                        <ul>
                            <li><strong>Standardized:</strong> Consistent format across cloud providers (Azure, AWS, GCP)</li>
                            <li><strong>Comprehensive:</strong> 96 columns covering all cost dimensions</li>
                            <li><strong>Detailed:</strong> Resource-level granularity with tags and metadata</li>
                            <li><strong>Industry-backed:</strong> Supported by Microsoft, AWS, Google, and FinOps Foundation</li>
                        </ul>

                        <h5 class="mt-3">Key Data Points:</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <ul>
                                    <li>Billed Cost, Effective Cost, List Cost</li>
                                    <li>Billing Period & Charge Period</li>
                                    <li>Subscription/Account details</li>
                                    <li>Resource ID, Name, Type</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <ul>
                                    <li>Service Name & Category</li>
                                    <li>Region & Availability Zone</li>
                                    <li>SKU details & pricing</li>
                                    <li>Tags & custom metadata</li>
                                </ul>
                            </div>
                        </div>

                        <p class="mb-0 mt-3">Learn more: <a href="https://focus.finops.org/" target="_blank">FOCUS Specification <i class="bi bi-box-arrow-up-right"></i></a></p>
                    </div>
                </div>
            </div>

            <!-- Q4 -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingFour">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                        <strong>Why is my data delayed by 24-48 hours?</strong>
                    </button>
                </h2>
                <div id="collapseFour" class="accordion-collapse collapse" aria-labelledby="headingFour" data-bs-parent="#faqAccordion">
                    <div class="accordion-body">
                        <p>Azure Cost Management data has an <strong>inherent 24-48 hour delay</strong>. This is a Microsoft limitation, not a FinOps Hub issue.</p>

                        <h5 class="mt-3">Why the delay?</h5>
                        <ul>
                            <li>Azure collects usage data from all resources globally</li>
                            <li>Data must be validated, processed, and reconciled across regions</li>
                            <li>Billing calculations include discounts, credits, and adjustments</li>
                            <li>Large-scale data aggregation takes time (millions of records)</li>
                        </ul>

                        <h5 class="mt-3">Timeline Example:</h5>
                        <table class="table table-sm table-bordered">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Event</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Monday, Oct 16</td>
                                    <td>You deploy a new VM</td>
                                </tr>
                                <tr>
                                    <td>Tuesday, Oct 17 (midnight)</td>
                                    <td>Azure processes usage data</td>
                                </tr>
                                <tr>
                                    <td>Wednesday, Oct 18 (1 AM)</td>
                                    <td>Cost export runs with Monday's data</td>
                                </tr>
                                <tr>
                                    <td>Wednesday, Oct 18 (2 AM)</td>
                                    <td>FinOps Hub imports the data</td>
                                </tr>
                                <tr class="table-success">
                                    <td>Wednesday, Oct 18 (morning)</td>
                                    <td><strong>You see Monday's costs in the dashboard</strong></td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="alert alert-primary mb-0" role="alert">
                            <i class="bi bi-info-circle"></i> <strong>Good news:</strong> Once data is imported, aggregations and charts update in real-time!
                        </div>
                    </div>
                </div>
            </div>

            <!-- Q5 -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingFive">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
                        <strong>Can I track multiple subscriptions?</strong>
                    </button>
                </h2>
                <div id="collapseFive" class="accordion-collapse collapse" aria-labelledby="headingFive" data-bs-parent="#faqAccordion">
                    <div class="accordion-body">
                        <p><strong>Yes!</strong> FinOps Hub automatically detects and imports data from <strong>all subscriptions</strong> in your <code>msexports</code> container.</p>

                        <h5 class="mt-3">Current Configuration:</h5>
                        <div class="alert alert-success">
                            <i class="bi bi-check-circle"></i> <strong>{{ subscriptions_count }} subscription(s)</strong> are currently being tracked:
                            <ul class="mb-0 mt-2">
                                {% for sub in subscriptions %}
                                <li><code>{{ sub }}</code></li>
                                {% empty %}
                                <li>No subscriptions configured yet</li>
                                {% endfor %}
                            </ul>
                        </div>

                        <h5 class="mt-3">How It Works:</h5>
                        <ul>
                            <li>Each subscription exports to a separate folder in <code>msexports</code></li>
                            <li>FinOps Hub scans for all .csv.gz files, regardless of folder structure</li>
                            <li>Data from all subscriptions is imported and stored together</li>
                            <li>Dashboard allows filtering by subscription for comparison</li>
                        </ul>

                        <h5 class="mt-3">Adding More Subscriptions:</h5>
                        <ol class="mb-0">
                            <li>Configure a Cost Export for the new subscription (see above)</li>
                            <li>Point it to the same <code>msexports</code> container</li>
                            <li>Wait for the export to run (or trigger manually)</li>
                            <li>FinOps Hub will auto-detect and import on next sync</li>
                        </ol>
                    </div>
                </div>
            </div>

            <!-- Q6 -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingSix">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSix" aria-expanded="false" aria-controls="collapseSix">
                        <strong>How can I manually trigger an import?</strong>
                    </button>
                </h2>
                <div id="collapseSix" class="accordion-collapse collapse" aria-labelledby="headingSix" data-bs-parent="#faqAccordion">
                    <div class="accordion-body">
                        <p>You can manually trigger a data import using Django management commands.</p>

                        <h5 class="mt-3">Commands:</h5>
                        <div class="code-block mb-3">
# Import all new exports
python manage.py import_cost_data

# Import specific subscription only
python manage.py import_cost_data --subscription "PartnerLed-power_up"

# Force re-import (ignores processed status)
python manage.py import_cost_data --force

# Run full daily sync (import + aggregations)
python manage.py sync_daily_costs
                        </div>

                        <h5 class="mt-3">Via Web Interface:</h5>
                        <p>Go to <a href="{% url 'finops_hub:import' %}">Import Data page</a> to view recent import history and get command instructions.</p>

                        <div class="alert alert-warning mb-0" role="alert">
                            <i class="bi bi-exclamation-triangle"></i> <strong>Note:</strong> Manual imports require server/console access.
                            Contact your administrator if you need help.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- CSP Joke Box -->
    <section class="faq-section">
        <div class="joke-box">
            <h4><i class="bi bi-emoji-laughing"></i> A Message to All CSPs (Cloud Service Providers)</h4>
            <p class="mb-2">We know configuring Azure Cost Exports can feel like navigating a maze blindfolded... while juggling... on a unicycle... during a thunderstorm.</p>
            <p class="mb-3"><strong>But hey, at least you're not still doing cost tracking in Excel spreadsheets, right?</strong> ...Right? ðŸ˜…</p>
            <p class="text-muted mb-0" style="font-style: italic;">
                "I spent 3 hours configuring my cost export. Then I realized I spelled 'msexports' as 'msexport'.
                I cried. Then I fixed it. Then I cried again because the data was 48 hours delayed.
                But now? Now I have beautiful dashboards. Worth it."
                <br>â€” Every CSP ever
            </p>
        </div>
    </section>

    <!-- CTA Box -->
    <section class="faq-section">
        <div class="cta-box">
            <h3>Need Help Configuring Your Azure Exports?</h3>
            <p class="mb-4">Our team can help you set up your Cost Management exports correctly, troubleshoot issues, and optimize your FinOps workflow.</p>
            <a href="mailto:support@yourcompany.com?subject=Azure%20Cost%20Export%20Configuration%20Help" class="btn btn-light btn-lg">
                <i class="bi bi-envelope-fill me-2"></i>Contact Us for Setup Assistance
            </a>
            <p class="mt-3 mb-0" style="font-size: 0.9rem; opacity: 0.9;">
                <i class="bi bi-clock"></i> Response time: Within 24 hours | <i class="bi bi-globe"></i> Support available worldwide
            </p>
        </div>
    </section>

    <!-- Back to Dashboard -->
    <div class="row mt-4">
        <div class="col-12 text-center">
            <a href="{% url 'finops_hub:dashboard' %}" class="btn btn-primary btn-lg">
                <i class="bi bi-arrow-left"></i> Back to Dashboard
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Auto-expand accordion based on URL hash
    document.addEventListener('DOMContentLoaded', function() {
        if (window.location.hash) {
            const target = document.querySelector(window.location.hash);
            if (target && target.classList.contains('accordion-collapse')) {
                const bsCollapse = new bootstrap.Collapse(target, {
                    toggle: true
                });
            }
        }
    });
</script>
{% endblock %}
