{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ page_title|default:"CRM" }}{% endblock %} | Schneider IT Management</title>
    <link rel="stylesheet" href="{% static 'power_up/css/tailwind.css' %}">
    <style>
        /* Plan tier colors */
        .tier-bronze  { --tier: #CD7F32; --tier-bg: #FDF4E8; --tier-ring: #CD7F3233; }
        .tier-silver  { --tier: #6B7280; --tier-bg: #F3F4F6; --tier-ring: #6B728033; }
        .tier-gold    { --tier: #D97706; --tier-bg: #FFFBEB; --tier-ring: #D9770633; }
        .tier-platinum{ --tier: #6366F1; --tier-bg: #EEF2FF; --tier-ring: #6366F133; }

        .tier-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            background: var(--tier-bg);
            color: var(--tier);
            border: 1px solid var(--tier-ring);
        }

        .tier-dot {
            width: 0.5rem;
            height: 0.5rem;
            border-radius: 9999px;
            background: var(--tier);
        }

        /* Contract health indicators */
        .health-good    { color: #059669; }
        .health-warning { color: #D97706; }
        .health-danger  { color: #DC2626; }

        /* Subtle card */
        .crm-card {
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 0.75rem;
            transition: box-shadow 0.2s, transform 0.2s;
        }
        .crm-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transform: translateY(-1px);
        }

        /* Stat ring */
        .stat-ring {
            width: 3rem;
            height: 3rem;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Role badges */
        .role-admin   { background: #FEE2E2; color: #991B1B; }
        .role-manager { background: #DBEAFE; color: #1E40AF; }
        .role-user    { background: #D1FAE5; color: #065F46; }
        .role-viewer  { background: #F3F4F6; color: #4B5563; }

        /* Severity badges */
        .sev-A { background: #FEE2E2; color: #991B1B; }
        .sev-B { background: #FEF3C7; color: #92400E; }
        .sev-C { background: #DBEAFE; color: #1E40AF; }

        /* Status badges */
        .status-new             { background: #EDE9FE; color: #5B21B6; }
        .status-in_progress     { background: #DBEAFE; color: #1E40AF; }
        .status-waiting_customer{ background: #FEF3C7; color: #92400E; }
        .status-waiting_vendor  { background: #FFEDD5; color: #9A3412; }
        .status-resolved        { background: #D1FAE5; color: #065F46; }
        .status-closed          { background: #F3F4F6; color: #4B5563; }

        /* Priority badges */
        .prio-critical { background: #FEE2E2; color: #991B1B; }
        .prio-high     { background: #FFEDD5; color: #9A3412; }
        .prio-medium   { background: #FEF3C7; color: #92400E; }
        .prio-low      { background: #D1FAE5; color: #065F46; }

        /* Product category badges */
        .prod-azure { background: #DBEAFE; color: #1E40AF; }
        .prod-m365  { background: #EDE9FE; color: #5B21B6; }
        .prod-d365  { background: #FCE7F3; color: #9D174D; }
        .prod-onprem{ background: #F3F4F6; color: #4B5563; }
        .prod-other { background: #F3F4F6; color: #6B7280; }
    </style>
    <script src="https://unpkg.com/htmx.org@2.0.4" defer></script>
    {% block extra_head %}{% endblock %}
</head>
<body class="bg-gray-50 text-gray-900 antialiased">
    <!-- Top Bar -->
    <header class="bg-white border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-14">
                <!-- Left: Brand + CRM Nav -->
                <div class="flex items-center space-x-8">
                    <a href="{% url 'crm:groups_overview' %}" class="flex items-center gap-2">
                        <span class="text-base font-bold text-gray-900">Schneider<span class="text-powerup-orange">IT</span></span>
                        <span class="text-xs font-medium text-gray-400 border-l border-gray-200 pl-2">CRM</span>
                    </a>
                    <nav class="hidden sm:flex space-x-6 overflow-x-auto min-w-0">
                        <a href="{% url 'crm:groups_overview' %}"
                           class="inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium whitespace-nowrap {% if request.resolver_match.url_name == 'groups_overview' or request.resolver_match.url_name == 'group_detail' %}border-powerup-orange text-gray-900{% else %}border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700{% endif %}">
                            Customer Groups
                        </a>
                        <a href="{% url 'crm:ticket_list' %}"
                           class="inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium whitespace-nowrap {% if 'ticket' in request.resolver_match.url_name %}border-powerup-orange text-gray-900{% else %}border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700{% endif %}">
                            Tickets
                        </a>
                        <a href="{% url 'onboarding:dashboard' %}"
                           class="inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium whitespace-nowrap {% if request.resolver_match.app_name == 'onboarding' %}border-powerup-orange text-gray-900{% else %}border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700{% endif %}">
                            Onboarding
                        </a>
                    </nav>
                </div>
                <!-- Right: Admin link -->
                <div class="flex items-center">
                    <a href="/power-admin/"
                       class="text-sm text-gray-500 hover:text-powerup-orange transition-colors">
                        Admin &rarr;
                    </a>
                </div>
            </div>
            <!-- Mobile nav -->
            <div class="sm:hidden flex space-x-4 pb-2 overflow-x-auto -mt-1">
                <a href="{% url 'crm:groups_overview' %}"
                   class="text-sm font-medium whitespace-nowrap px-2 py-1 rounded-md {% if request.resolver_match.url_name == 'groups_overview' or request.resolver_match.url_name == 'group_detail' %}bg-powerup-orange/10 text-powerup-orange{% else %}text-gray-500 hover:text-gray-700{% endif %}">
                    Groups
                </a>
                <a href="{% url 'crm:ticket_list' %}"
                   class="text-sm font-medium whitespace-nowrap px-2 py-1 rounded-md {% if 'ticket' in request.resolver_match.url_name %}bg-powerup-orange/10 text-powerup-orange{% else %}text-gray-500 hover:text-gray-700{% endif %}">
                    Tickets
                </a>
                <a href="{% url 'onboarding:dashboard' %}"
                   class="text-sm font-medium whitespace-nowrap px-2 py-1 rounded-md {% if request.resolver_match.app_name == 'onboarding' %}bg-powerup-orange/10 text-powerup-orange{% else %}text-gray-500 hover:text-gray-700{% endif %}">
                    Onboarding
                </a>
            </div>
        </div>
    </header>

    <!-- Page Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {% block crm_content %}{% endblock %}
    </main>
</body>
</html>
